<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1e1e1e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Nimble Shred V44</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // GLOBAL CRASH DETECTOR (Runs before anything else)
        window.onerror = function(msg, url, line) {
            document.body.innerHTML += `<div style="position:fixed;top:0;left:0;width:100%;background:red;color:white;padding:20px;z-index:9999;">üí• CRASH DETECTED on Line ${line}: ${msg}</div>`;
        };
    </script>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --primary: #BB86FC; --sec: #03DAC6; --text: #fff; --gold: #FFD700; --danger: #CF6679; --warn: #FF9800; --success: #00C853; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; padding-bottom: 120px; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 800px; margin: 0 auto; display: none; padding-bottom: 80px; } 
        .container.active { display: block; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .btn { display: block; width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 16px; }
        .btn-main { background: var(--sec); color: #000; } .btn-action { background: var(--primary); color: #000; } .btn-danger { background: var(--danger); color: #fff; }
        input, select { width: 100%; padding: 10px; background: #2c2c2c; border: 1px solid #444; border-radius: 6px; color: #fff; font-size: 16px; box-sizing: border-box; }
        .row { display: flex; gap: 10px; align-items: center; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a1a; display: flex; justify-content: space-around; padding: 15px 10px; border-top: 1px solid #333; z-index: 9000; padding-bottom: max(15px, env(safe-area-inset-bottom)); }
        .nav-btn { background: none; color: #777; border: none; font-size: 0.75em; display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; }
        .nav-btn.active { color: var(--sec); transform: translateY(-2px); }
        .nav-icon { font-size: 1.5em; }
        .chip-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; }
        .chip { padding: 6px 12px; background: #333; border: 1px solid #555; border-radius: 20px; font-size: 0.8em; cursor: pointer; color: #aaa; transition: 0.2s; }
        .chip.active { background: var(--primary); color: #000; border-color: var(--primary); font-weight: bold; }
        .chip.danger-active { background: var(--danger); color: #fff; border-color: var(--danger); }
        .macro-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; text-align: center; font-size: 0.85em; }
        .macro-bar-container { background: #333; height: 8px; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .macro-fill { height: 100%; transition: width 0.5s ease-out; }
        .food-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #2a2a2a; font-size: 0.9em; cursor: pointer; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin: 15px 0; }
        .day-bubble { background: #333; aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8em; cursor: pointer; border: 1px solid #444; flex-direction: column; }
        .day-bubble.active { border-color: var(--primary); color: var(--primary); }
        .heatmap-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top:10px; }
        .heat-cell { background: #252525; padding: 10px; border-radius: 6px; text-align: center; font-size: 0.8em; color: #777; border: 1px solid #333; }
        .heat-hot { background: var(--danger); color: #fff; } .heat-warm { background: var(--warn); color: #000; } .heat-mild { background: var(--sec); color: #000; }
        .fs-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 10000; padding: 20px; overflow-y: auto; display: none; }
        .hidden { display: none !important; }
        #sync-loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #121212; z-index: 20000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .exercise-card { border-left: 4px solid var(--primary); margin-bottom: 15px; }
        .exercise-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .sparkline-container { width: 100%; height: 30px; margin-top: 5px; opacity: 0.8; }
        .rpe-slider { width: 100%; accent-color: var(--warn); margin: 10px 0; }
        .swap-btn { font-size: 0.8em; color: var(--gold); border: 1px solid var(--gold); padding: 2px 6px; border-radius: 4px; cursor: pointer; margin-left: 10px; }
        /* Encyclopedia */
        details { background: #252525; margin-bottom: 10px; border-radius: 8px; overflow: hidden; border: 1px solid #333; }
        summary { padding: 12px; cursor: pointer; font-weight: bold; list-style: none; display: flex; justify-content: space-between; align-items: center; }
        summary:after { content: '+'; font-size: 1.2em; color: var(--sec); }
        details[open] summary:after { content: '-'; }
        .detail-content { padding: 15px; font-size: 0.9em; line-height: 1.5; color: #ddd; }
        .visual-container { background: #000; border-radius: 8px; overflow: hidden; height: 250px; display: flex; align-items: center; justify-content: center; border: 1px solid #333; position: relative; margin-bottom: 15px; }
        #visual-content-img, #visual-content-iframe { width: 100%; height: 100%; object-fit: contain; display: none; }
        .confetti { position: absolute; width: 10px; height: 10px; background: #f00; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
    </style>
</head>
<body>

<div id="sync-loader"><div style="font-size:3em; margin-bottom:20px;">‚òÅÔ∏è</div><h3>Syncing...</h3></div>
<script>window.onload = function() { const l = document.getElementById('sync-loader'); if(l) { l.style.opacity = '0'; setTimeout(() => l.style.display = 'none', 500); } };</script>

<div class="container active" id="view-readiness">
    <div class="top-bar"><h2>Daily Check-In</h2></div>
    <div class="card" style="display:flex; justify-content:space-between; align-items:center; background: linear-gradient(45deg, #1e1e1e, #252525);">
        <div><div style="font-size:0.8em; color:#aaa;">Streak</div><div style="font-size:1.5em; font-weight:bold;">üî• <span id="streak-count">0</span> Days</div></div>
        <div id="readiness-badge" style="font-size:2em;">üõ°Ô∏è</div>
    </div>
    <div class="card">
        <h3>How are you feeling?</h3>
        <div class="row" style="margin-top:10px;"><span>üò¥ Sleep</span> <input type="range" id="val-sleep" min="1" max="10" value="5" oninput="calcReadiness()"></div>
        <div class="row" style="margin-top:15px;"><span>ü§ï Pain</span> <input type="range" id="val-sore" min="1" max="10" value="5" oninput="calcReadiness()"></div>
        <div class="row" style="margin-top:15px;"><span>‚ö° Energy</span> <input type="range" id="val-mood" min="1" max="10" value="5" oninput="calcReadiness()"></div>
        <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
        <div class="row"><input type="number" id="garmin-score" placeholder="Garmin Body Battery (Optional)" oninput="calcReadiness()"></div>
        <div style="text-align:center; margin-top:15px;"><div style="font-size:2.5em; font-weight:bold; color:var(--sec);" id="score-display">--</div></div>
        <button class="btn btn-main" onclick="alert('Score Logged!')">üíæ Log & Get Advice</button>
    </div>
</div>

<div class="container" id="view-coach">
    <div id="setup-panel">
        <div class="top-bar"><h2>Workout Strategy</h2></div>
        <div class="card" style="border-left: 4px solid var(--danger);">
            <div style="display:flex; justify-content:space-between; align-items:center; cursor:pointer;" onclick="toggleInjuryPanel()">
                <h3 style="margin:0; font-size:1.1em;">ü©π Injury / Pain Mode</h3>
                <span id="injury-status" style="font-size:0.8em; color:#777;">Off</span>
            </div>
            <div id="injury-chips" class="chip-container" style="display:none; margin-top:10px; padding-top:10px; border-top:1px solid #333;">
                <div class="chip" onclick="toggleInjury('Shoulders', this)">Shoulders</div>
                <div class="chip" onclick="toggleInjury('Knees', this)">Knees</div>
                <div class="chip" onclick="toggleInjury('Back', this)">Lower Back</div>
            </div>
        </div>
        <div class="card" style="margin-top:10px;">
            <h3>Quick Start</h3>
            <div class="row" style="justify-content:space-between;"><label style="color:#aaa;">Duration</label><span id="time-val" style="color:var(--sec); font-weight:bold;">45m (6 Ex)</span></div>
            <input type="range" id="slider-time" min="3" max="12" value="6" oninput="updateTimeLabel(this.value)">
            <div class="chip-container">
                <div class="chip" onclick="loadTemplate('push')">Push</div>
                <div class="chip" onclick="loadTemplate('pull')">Pull</div>
                <div class="chip" onclick="loadTemplate('legs')">Legs</div>
                <div class="chip" onclick="loadTemplate('full')">Full Body</div>
                <div class="chip" onclick="loadTemplate('nimble')">Nimble</div>
                <div class="chip" onclick="loadTemplate('f9')">Torque F9</div>
            </div>
            <button class="btn btn-main" onclick="generateRandomWorkout()">üé≤ Random Workout</button>
            <button class="btn btn-action" onclick="openBuilder()">üõ†Ô∏è Build Custom</button>
        </div>
    </div>
    <div id="workout-interface" style="display:none;">
        <div class="top-bar"><h3>Active Session</h3><button class="btn-danger" style="width:auto; padding:5px 10px;" onclick="cancelWorkout()">End</button></div>
        <div id="workout-list"></div>
        <button class="btn btn-action" onclick="openBuilder(true)">‚ûï Add Exercise</button>
        <button class="btn btn-main" onclick="finishSession()">üíæ Finish</button>
    </div>
</div>

<div class="container" id="view-plan">
    <h2>Weekly Structure</h2>
    <div class="card">
        <div style="display:flex; justify-content:space-between;"><h3>üìÖ Phase: <span id="cycle-phase" style="color:var(--primary)">Week 1</span></h3><small onclick="nextPhase()" style="color:#777;">Next >></small></div>
        <div class="calendar-grid" id="week-grid"></div>
    </div>
</div>

<div class="container" id="view-food">
    <div class="top-bar"><h2>Fuel Log</h2></div>
    <div class="card">
        <div class="macro-grid">
            <div>üî• <span id="disp-cals">0</span><div class="macro-bar-container"><div id="bar-cals" class="macro-fill" style="width:0%; background:var(--sec);"></div></div></div>
            <div>ü•© <span id="disp-pro">0</span>g<div class="macro-bar-container"><div id="bar-pro" class="macro-fill" style="width:0%; background:var(--primary);"></div></div></div>
            <div>üçö <span id="disp-carb">0</span>g<div class="macro-bar-container"><div id="bar-carb" class="macro-fill" style="width:0%; background:var(--warn);"></div></div></div>
            <div>ü•ë <span id="disp-fat">0</span>g<div class="macro-bar-container"><div id="bar-fat" class="macro-fill" style="width:0%; background:var(--danger);"></div></div></div>
        </div>
    </div>
    <div class="card">
        <div class="row"><input type="text" id="food-search" placeholder="Search Food..." onchange="searchFood()"><button class="btn-action" style="width:auto;" onclick="searchFood()">üîé</button></div>
        <div id="search-results" style="margin-top:10px; max-height:200px; overflow-y:auto;"></div>
    </div>
</div>

<div class="container" id="view-progress">
    <h2>Command Center</h2>
    <div class="card"><h3>üî• Muscle Heatmap (30 Days)</h3><div id="muscle-heatmap" class="heatmap-grid"></div></div>
    <button class="btn btn-action" onclick="exportData()">‚¨áÔ∏è Export Data</button>
</div>

<div id="builder-overlay" class="fs-overlay hidden">
    <div class="top-bar"><h2>Exercise Builder</h2><button class="btn-danger" style="width:auto;" onclick="closeBuilder()">Close</button></div>
    <div class="card">
        <input type="text" id="builder-search-inp" placeholder="Search..." onkeyup="filterBuilderList()">
        <div id="builder-list-content" style="margin-top:10px;"></div>
    </div>
</div>
<div id="guide-modal" class="fs-overlay hidden">
    <div class="top-bar"><h2 id="guide-title">Exercise Name</h2><button class="btn-danger" style="width:auto;" onclick="closeGuideModal()">Close</button></div>
    <div class="card">
        <div id="f9-setup-section" class="card" style="background: #333; margin-bottom: 15px; border-left: 4px solid var(--gold); display:none;">
            <div style="font-size:0.8em; color:#aaa; margin-bottom:5px;">TORQUE F9 SETUP</div>
            <div class="row"><div style="flex:1"><strong>üí™ Arms:</strong> <span id="guide-arms">--</span></div><div style="flex:1"><strong>‚ÜïÔ∏è Pulleys:</strong> <span id="guide-pulleys">--</span></div></div>
        </div>
        <span class="guide-label">üé• Visual Guide</span>
        <div class="visual-container">
            <div id="visual-error" class="visual-placeholder">No Visual Saved.<br><small>Paste GIF or YouTube Link below.</small></div>
            <img id="visual-content-img" src=""><iframe id="visual-content-iframe" src="" allowfullscreen></iframe>
        </div>
        <div id="accordion-container">
            <details id="det-prep"><summary>‚öôÔ∏è Preparation</summary><div class="detail-content" id="guide-prep"></div></details>
            <details id="det-exec" open><summary>üöÄ Execution</summary><div class="detail-content" id="guide-exec"></div></details>
            <details id="det-tips"><summary>üéì Coaching Tips</summary><div class="detail-content" id="guide-tips"></div></details>
            <details id="det-musc"><summary>üí™ Muscles & Benefits</summary><div class="detail-content" id="guide-musc"></div></details>
        </div>
        <div style="background:#252525; padding:15px; border-radius:8px; margin-top:20px; border-top:1px solid #444;">
            <a id="gif-search-btn" href="#" target="_blank" class="btn-guide" style="display:block; text-align:center; text-decoration:none; margin-bottom:10px;">üîé Find on Google (GIFs)</a>
            <input type="text" id="guide-gif-input" class="gif-input" placeholder="Paste YouTube or GIF URL...">
            <button class="btn btn-action" style="margin-top:5px;" onclick="saveGuideGif()">üíæ Save Media</button>
        </div>
    </div>
</div>
<div id="plate-helper" class="plate-popup hidden"></div>

<div class="nav-bar">
    <button class="nav-btn active" onclick="switchTab('readiness')"><span class="nav-icon">üîã</span>Daily</button>
    <button class="nav-btn" onclick="switchTab('coach')"><span class="nav-icon">üèãÔ∏è</span>Coach</button>
    <button class="nav-btn" onclick="switchTab('plan')"><span class="nav-icon">üìÖ</span>Plan</button>
    <button class="nav-btn" onclick="switchTab('food')"><span class="nav-icon">üçó</span>Fuel</button>
    <button class="nav-btn" onclick="switchTab('progress')"><span class="nav-icon">üìà</span>Stats</button>
</div>

<script>
    // ---------------------------------------------------------
// MISSING TRANSLATION KEY (PASTE THIS TO FIX "NO EXERCISES")
// ---------------------------------------------------------
function createEx(name, cat, equip, type, prep, exec, tips, benefits, muscles, setupF9) {
    return {
        name: name, cat: cat, equip: equip, type: type,
        guide: { prep: prep, exec: exec, tips: tips, benefits: benefits, muscles: muscles },
        setup: setupF9 || { arms: "N/A", pulleys: "N/A" }
    };
}
// ---------------------------------------------------------
window.allExercises = [
  // ==================== CABLE CHEST (TORQUE F9) ====================
        createEx("Cable Chest Press", ["Chest"], "Cable", "Strength", 
            ["Set Arms to Wide (Pos 8-9). Pulleys at Chest Height.", "Grab handles and step forward into a split stance (one foot forward) for stability.", "Brace core and lean slightly forward, keeping spine neutral."],
            ["Press handles straight forward until arms are fully extended.", "Bring hands together at the center line.", "Slowly return elbows to a 45-degree angle (don't let them fly back behind shoulders)."],
            ["Don't flare elbows wide; keep them tucked.", "Keep shoulders down (depressed); don't shrug.", "Drive through the back leg."],
            ["Constant tension on pectorals throughout the rep.", "Reduced shoulder strain compared to bench press.", "High core activation for stability."],
            ["Pectoralis Major", "Triceps", "Front Delts"], {arms: "Wide (Pos 8-9)", pulleys: "Chest Height"}),

        createEx("Cable Chest Fly (High)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Top Position. Arms Wide.", "Step forward, lean torso 30¬∞ forward.", "Start with arms open wide, elbows slightly bent."],
            ["Fly hands down and together towards your waist.", "Imagine hugging a large tree trunk.", "Squeeze inner chest hard at the bottom.", "Control the return to the stretch position."],
            ["Don't turn it into a press; keep the elbow angle fixed.", "Keep chest proud, don't round shoulders forward."],
            ["Targets the lower (sternal) head of the chest.", "Excellent for creating the lower pec outline."],
            ["Lower Pectorals", "Anterior Delts"], {arms: "Wide", pulleys: "Top"}),

        createEx("Cable Chest Fly (Low)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Bottom Position. Arms Wide.", "Stand centrally with feet shoulder-width apart.", "Palms facing forward and up."],
            ["Scoop hands up and together to eye level.", "Focus on driving the elbows in and up.", "Squeeze the upper chest at the peak.", "Lower slowly to the starting position."],
            ["Don't swing your body to hoist the weight.", "Keep elbows soft (slightly bent) but rigid.", "Focus on the 'scoop' motion."],
            ["Targets the upper (clavicular) chest.", "Helps fill out the shelf of the chest."],
            ["Upper Pectorals", "Front Delts"], {arms: "Wide", pulleys: "Bottom"}),

        createEx("Cable Chest Fly (Mid)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Chest Height. Arms Wide.", "Step forward into a split stance.", "Palms facing each other."],
            ["Bring hands together directly in front of your chest.", "Squeeze hard for 1 second at the touch point.", "Open arms wide until you feel a deep stretch across the pecs."],
            ["Retract shoulder blades on the negative.", "Don't lock out elbows at the end range."],
            ["Builds overall chest mass.", "Focuses on peak contraction."],
            ["Pectoralis Major"], {arms: "Wide", pulleys: "Chest Height"}),

        createEx("Single Arm Cable Chest Press", ["Chest"], "Cable", "Strength",
            ["Set Pulley to Chest Height.", "Adopt a split stance.", "Hold one handle at your chest."],
            ["Press straight out while keeping hips and shoulders perfectly square.", "Resist the rotation of your torso.", "Return slowly to the start."],
            ["Fight the urge to twist your body.", "Engage obliques heavily to stabilize."],
            ["Corrects strength imbalances.", "Massive anti-rotation core workout."],
            ["Pecs", "Obliques", "Triceps"], {arms: "Standard", pulleys: "Chest Height"}),

        createEx("Cable Crossover", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys Top. Arms Wide.", "Step forward aggressively.", "Lean torso forward 45 degrees."],
            ["Bring hands down and across each other.", "Cross wrists at the bottom to maximize range of motion.", "Alternate which hand is on top each rep."],
            ["Focus on the inner chest squeeze.", "Keep the movement distinct from a press."],
            ["Creates inner chest definition.", "Maximum contraction at the bottom."],
            ["Inner Pectorals"], {arms: "Wide", pulleys: "Top"}),

        createEx("Cable Pullover (Bench)", ["Chest", "Lats"], "Cable", "Muscle Build",
            ["Set Pulley Mid/Low. Arms Narrow.", "Place bench perpendicular to machine.", "Lie on back, head near machine.", "Hold rope or bar."],
            ["Keeping arms straight, pull the weight from behind your head over to your hips.", "Squeeze chest and lats at the bottom.", "Slowly return weight behind head for a stretch."],
            ["Keep arms straight but not locked.", "Feel the deep stretch in your armpits."],
            ["Expands the ribcage.", "Hits both chest and lats effectively."],
            ["Serratus Anterior", "Lats", "Pecs"], {arms: "Narrow", pulleys: "Mid"}),

        // ==================== CABLE BACK (TORQUE F9) ====================
        createEx("Lat Pulldown (Standing)", ["Back"], "Cable", "Strength",
            ["Set Pulleys Top. Arms Narrow or Top.", "Kneel or squat down on the floor.", "Hold handles with palms facing forward."],
            ["Drive elbows down towards your back pockets.", "Squeeze lats hard at the bottom.", "Allow arms to stretch fully up at the top."],
            ["Think 'Elbows to pockets', not 'Hands to shoulders'.", "Keep chest proud.", "Don't round your back."],
            ["Builds back width (V-Taper).", "Safe vertical pull pattern."],
            ["Latissimus Dorsi", "Biceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Seated Cable Row", ["Back"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Narrow.", "Sit on floor or bench.", "Brace feet against machine frame if possible."],
            ["Pull handles into your stomach.", "Drive elbows back past your torso.", "Squeeze shoulder blades together."],
            ["Keep spine neutral and upright.", "Don't rock back and forth excessively."],
            ["Builds back thickness.", "Corrects posture."],
            ["Rhomboids", "Traps", "Lats"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Face Pulls", ["Back", "Shoulders"], "Cable", "Mobility",
            ["Set Pulley to Face Height. Use Rope.", "Grip rope with thumbs facing back.", "Staggered stance."],
            ["Pull the center of the rope to your forehead.", "Externally rotate hands back (like a double bicep pose).", "Squeeze rear delts."],
            ["Don't shrug shoulders up to ears.", "Lead with your wrists."],
            ["Essential for shoulder health.", "Strengthens rotator cuff."],
            ["Rear Delts", "Rotator Cuff"], {arms: "Narrow", pulleys: "Face Height"}),

        createEx("Straight Arm Pulldown", ["Back"], "Cable", "Muscle Build",
            ["Set Pulleys Top. Arms Top.", "Hinge hips slightly back.", "Keep arms straight out in front."],
            ["Push the bar/handles down to your thighs using your lats.", "Keep arms straight throughout.", "Squeeze armpits tight at the bottom."],
            ["Don't use triceps to push.", "Initiate movement with your lats."],
            ["Pure lat isolation.", "Great as a pre-exhaust."],
            ["Latissimus Dorsi"], {arms: "Top", pulleys: "Top"}),

        createEx("Single Arm Cable Row", ["Back"], "Cable", "Strength",
            ["Set Pulley Waist Height. Arms Standard.", "Adopt a split stance.", "Reach forward with the working arm."],
            ["Row elbow back tight to the body.", "Allow torso to rotate slightly forward on the stretch.", "Rotate back to neutral on the pull."],
            ["Get a deep stretch at the start.", "Hard contraction at the end."],
            ["Unilateral back growth.", "Core integration."],
            ["Lats", "Obliques"], {arms: "Standard", pulleys: "Waist Height"}),

        createEx("Cable Shrugs", ["Back", "Traps"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Stand centrally.", "Hold handles at sides."],
            ["Shrug shoulders straight up towards your ears.", "Hold for 1 second at the top.", "Lower fully to stretch traps."],
            ["Don't roll shoulders forward or back.", "Keep arms straight."],
            ["Builds trap size.", "Neck strength."],
            ["Trapezius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Rear Delt Fly", ["Back", "Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Eye Level. Arms Wide.", "Grab opposite cables (Left hand holds Right cable).", "Stand tall."],
            ["Pull arms apart horizontally until in line with body.", "Squeeze the back of your shoulders.", "Control the return."],
            ["Keep arms straight.", "Don't engage traps (keep shoulders down)."],
            ["Builds 3D Delts.", "Improves posture."],
            ["Posterior Delts"], {arms: "Wide", pulleys: "Eye Level"}),

        createEx("High Row (Rope)", ["Back"], "Cable", "Strength",
            ["Set Pulleys Top. Arms Narrow.", "Use Rope attachment.", "Step back and lean slightly."],
            ["Pull the rope towards your neck/chin.", "Drive elbows high and wide.", "Squeeze upper back."],
            ["Focus on the upper back, not the lats.", "Keep elbows flared."],
            ["Builds upper back thickness.", "Hits rear delts hard."],
            ["Rhomboids", "Rear Delts"], {arms: "Narrow", pulleys: "Top"}),

        // ==================== CABLE SHOULDERS ====================
        createEx("Cable Overhead Press", ["Shoulders"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Wide.", "Hold handles at shoulder height.", "Stand strong with core braced."],
            ["Press straight up overhead.", "Bring biceps by ears at the top.", "Lower with control to ear level."],
            ["Keep core tight.", "Don't arch your lower back."],
            ["Builds shoulder mass.", "Constant tension compared to dumbbells."],
            ["Anterior Delts", "Triceps"], {arms: "Wide", pulleys: "Low"}),

        createEx("Cable Lateral Raise", ["Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Cross cables (Left hand -> Right cable).", "Stand center."],
            ["Raise arms out to the sides.", "Stop at shoulder height.", "Lower slowly."],
            ["Lead with your elbows, not your hands.", "Imagine pouring a pitcher of water."],
            ["Builds side delt width.", "Creates caped shoulder look."],
            ["Lateral Delts"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Front Raise", ["Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Face away from machine.", "Cable runs between legs."],
            ["Raise straight arms to the front.", "Stop at eye level.", "Lower with control."],
            ["No swinging.", "Keep chest up."],
            ["Isolates the front delt."],
            ["Anterior Delts"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable External Rotation", ["Shoulders", "Mobility"], "Cable", "Mobility",
            ["Set Pulley Elbow Height.", "Stand sideways.", "Elbow pinned to side (use a towel if needed)."],
            ["Rotate hand away from your body.", "Keep elbow glued to ribs.", "Return slowly."],
            ["Use very light weight.", "Focus on the small cuff muscles."],
            ["Rotator cuff health.", "Injury prevention."],
            ["Infraspinatus"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Internal Rotation", ["Shoulders", "Mobility"], "Cable", "Mobility",
            ["Set Pulley Elbow Height.", "Stand sideways.", "Elbow pinned to side."],
            ["Rotate hand inward towards your stomach.", "Keep elbow glued.", "Return."],
            ["Control the motion.", "Don't use chest to pull."],
            ["Subscapularis strength."],
            ["Subscapularis"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Upright Row", ["Shoulders", "Traps"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Bar or Handles.", "Stand close."],
            ["Pull hands up body to chest.", "Elbows lead movement high.", "Lower."],
            ["Don't go too heavy.", "Watch wrists."],
            ["Side delts and Traps."],
            ["Lateral Delts", "Traps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Y-Raise", ["Back", "Shoulders"], "Cable", "Mobility",
            ["Set Pulleys Low. Arms Low.", "Cross cables.", "Stand tall."],
            ["Raise arms up and out into 'Y' shape.", "Squeeze lower traps.", "Lower slowly."],
            ["Thumbs up.", "Don't arch back."],
            ["Lower trap activation.", "Scapular health."],
            ["Lower Traps", "Side Delts"], {arms: "Low", pulleys: "Low"}),

        // ==================== CABLE ARMS ====================
        createEx("Tricep Pushdown (Rope)", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Pin elbows to your ribs.", "Hinge only at the elbow."],
            ["Push down forcefully.", "Spread the rope apart at the bottom.", "Return to 90 degrees."],
            ["Keep elbows locked in place.", "Squeeze triceps hard."],
            ["Targets the lateral head.", "Great for definition."],
            ["Triceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Tricep Pushdown (Bar)", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Use Straight Bar.", "Elbows pinned to sides."],
            ["Push straight down.", "Lockout arms fully.", "Return to chest height."],
            ["Go heavier than with rope.", "Keep wrists straight."],
            ["Overall tricep mass builder."],
            ["Triceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Overhead Cable Extension", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Mid/Top.", "Lean forward facing away from machine.", "Hold rope behind head."],
            ["Extend arms forward and overhead.", "Keep elbows by ears.", "Stretch back deeply."],
            ["The deep stretch is key here.", "Don't flare elbows too wide."],
            ["Targets the Long Head of the tricep.", "Adds arm size."],
            ["Triceps (Long Head)"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Bicep Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Hold bar or handles.", "Stand tall."],
            ["Curl weight up to chin.", "Squeeze biceps.", "Lower fully."],
            ["Keep elbows slightly forward of hips.", "Don't lean back."],
            ["Constant tension curls."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Hammer Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Use Rope.", "Neutral grip (palms facing)."],
            ["Curl up towards shoulders.", "Thumbs lead the movement.", "Lower."],
            ["Focus on forearms and brachialis.", "No swinging."],
            ["Adds arm thickness and width."],
            ["Brachialis", "Forearms"], {arms: "Low", pulleys: "Low"}),

        createEx("Bayesian Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low. Face away.", "Arm extended behind torso.", "Step forward."],
            ["Curl forward while keeping elbow back.", "Feel the deep stretch at start."],
            ["Unique stretch angle for hypertrophy.", "Keep shoulder stable."],
            ["Targets the long head via stretch."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Kickback", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Bent over.", "No attachment."],
            ["Extend arm back.", "Squeeze hard.", "Bend elbow only."],
            ["Don't swing shoulder."],
            ["Peak contraction."],
            ["Triceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Reverse Grip Pushdown", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Palms up (Supinated).", "Elbows pinned."],
            ["Push down.", "Squeeze."],
            ["Don't loose grip."],
            ["Medial head focus."],
            ["Triceps"], {arms: "Top", pulleys: "Top"}),

        // ==================== CABLE LEGS ====================
        createEx("Cable Squat", ["Legs"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Narrow.", "Hold handles at shoulders (rack position).", "Stance shoulder width."],
            ["Squat down deep.", "Keep chest upright.", "Drive up through heels."],
            ["Safer on the back than barbell squats.", "Easy to bail if needed."],
            ["Quad focus with less spinal load."],
            ["Quads", "Glutes"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Pull-Through", ["Legs", "Glutes"], "Cable", "Strength",
            ["Set Pulley Low. Rope.", "Face away from machine.", "Hold rope between legs."],
            ["Hinge hips back towards machine.", "Feel hamstring stretch.", "Snap hips forward to stand."],
            ["It is a hinge, not a squat.", "Squeeze glutes hard at top.", "Don't pull with arms."],
            ["Best glute builder on cable.", "Teaches hip hinge."],
            ["Glutes", "Hamstrings"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable RDL", ["Legs", "Hamstrings"], "Cable", "Strength",
            ["Set Pulleys Low.", "Face machine.", "Hold handles at thighs."],
            ["Hinge hips back.", "Keep knees soft but fixed.", "Lower until back is parallel to floor."],
            ["Feel deep hamstring stretch.", "Drive hips forward to stand."],
            ["Posterior chain builder."],
            ["Hamstrings"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Lunge", ["Legs"], "Cable", "Strength",
            ["Set Pulleys Low.", "Hold handles.", "Step back into a lunge."],
            ["Drop back knee to floor.", "Drive up through front heel.", "Keep chest up."],
            ["Stability challenge.", "Keep knee in line with toe."],
            ["Unilateral leg strength."],
            ["Quads", "Glutes"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Kickback (Glute)", ["Legs", "Glutes"], "Cable", "Muscle Build",
            ["Set Pulley Low. Ankle strap.", "Face machine.", "Lean forward slightly."],
            ["Kick leg straight back and up.", "Squeeze glute at top.", "Return slowly."],
            ["Don't rotate hips open.", "Movement comes from hip, not back."],
            ["Glute isolation."],
            ["Glute Maximus"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Calf Raise", ["Legs", "Calves"], "Cable", "Muscle Build",
            ["Set Pulleys Low.", "Stand on a block or plate.", "Hold handles."],
            ["Lower heels to floor.", "Drive up onto toes.", "Squeeze hard."],
            ["Full range of motion is critical.", "Don't bounce."],
            ["Calf size and strength."],
            ["Calves"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Abductor", ["Legs", "Glutes"], "Cable", "Mobility",
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Leg furthest from machine."],
            ["Kick leg out to side.", "Control return."],
            ["Stabilize with other leg."],
            ["Side glute.", "Hip health."],
            ["Glute Medius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Adductor", ["Legs"], "Cable", "Mobility",
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Leg closest to machine."],
            ["Pull leg across body.", "Control return."],
            ["Balance key."],
            ["Inner thigh."],
            ["Adductors"], {arms: "Low", pulleys: "Low"}),

        // ==================== CABLE CORE ====================
        createEx("Cable Crunch", ["Core"], "Cable", "Muscle Build",
            ["Set Pulley Top. Rope.", "Kneel down facing machine.", "Hold rope at ears."],
            ["Curl spine down towards floor.", "Bring elbows to knees.", "Squeeze abs."],
            ["Don't hinge at the hips.", "Round the back like a shrimp."],
            ["Weighted abdominal hypertrophy."],
            ["Rectus Abdominis"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Woodchopper (High to Low)", ["Core"], "Cable", "Mobility",
            ["Set Pulley Top.", "Stand sideways.", "Grab handle with both hands."],
            ["Chop down and across body to opposite knee.", "Pivot back foot.", "Return slowly."],
            ["Explosive down, controlled up.", "Keep arms straight."],
            ["Oblique power.", "Rotational strength."],
            ["Obliques"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Pallof Press", ["Core"], "Cable", "Strength",
            ["Set Pulley Chest Height.", "Stand sideways.", "Hold handle at chest."],
            ["Press handle straight out.", "Hold for 2-3 seconds.", "Return to chest."],
            ["Resist the rotation pulling you in.", "Keep shoulders square."],
            ["The ultimate anti-rotation exercise.", "Spine health."],
            ["Core Stabilizers"], {arms: "Narrow", pulleys: "Chest Height"}),

        createEx("Cable Side Bend", ["Core"], "Cable", "Mobility",
            ["Set Pulley Low. Stand sideways to the machine.", "Hold the handle in one hand, arm hanging straight down.", "Feet shoulder-width apart."],
            ["Lean your torso away from the machine, crunching the oblique.", "Return to neutral, resisting the pull.", "Do not lean forward or back."],
            ["Focus on the ribcage moving towards the hip.", "Keep the arm straight; don't pull with the bicep."],
            ["Isolates the obliques.", "Strengthens the lateral core."],
            ["Obliques"], {arms: "Low", pulleys: "Low"}),

        createEx("Woodchopper (Low to High)", ["Core"], "Cable", "Mobility",
            ["Set Pulley Low.", "Stand sideways.", "Hands on handle."],
            ["Rotate up across body.", "Pivot foot.", "Return."],
            ["Full rotation."],
            ["Functional core."],
            ["Obliques"], {arms: "Narrow", pulleys: "Low"}),

        // ==================== DUMBBELLS (DETAILED) ====================
        createEx("Dumbbell Bench Press", ["Chest"], "Dumbbell", "Strength",
            ["Lie on a flat bench with 5 points of contact (head, shoulders, butt, left foot, right foot).", "Hold dumbbells at chest level, palms facing forward.", "Retract shoulder blades."],
            ["Press dumbbells straight up to full lockout.", "Lower slowly (3 seconds) until hands are level with chest.", "Elbows should be at a 45-degree angle to body."],
            ["Drive feet into the floor.", "Do not bounce the weights at the bottom.", "Keep wrists straight."],
            ["Builds chest mass.", "Requires more stabilizer muscle than barbell."],
            ["Pectoralis Major", "Triceps", "Front Delts"]),

        createEx("Dumbbell Incline Press", ["Chest"], "Dumbbell", "Strength",
            ["Set bench to 30 or 45 degrees.", "Kick dumbbells up to shoulders using knees.", "Palms forward."],
            ["Press straight up towards the ceiling.", "Lower slowly to upper chest level.", "Keep elbows tucked, not flared."],
            ["Keep head on the bench.", "Squeeze pecs at the top."],
            ["Targets the 'shelf' of the upper chest.", "Less stress on rotator cuff than flat bench."],
            ["Upper Pectorals", "Front Delts"]),

        createEx("Dumbbell Fly", ["Chest"], "Dumbbell", "Muscle Build",
            ["Lie on a flat bench.", "Hold dumbbells above chest, palms facing each other (neutral grip).", "Slight bend in elbows."],
            ["Lower arms out to sides in a wide arc.", "Feel a deep stretch across the chest.", "Squeeze back to the top like hugging a barrel."],
            ["Don't go below shoulder level if it hurts.", "Keep the elbow bend constant."],
            ["Expands the chest.", "Isolates the pecs without tricep involvement."],
            ["Pectoralis Major"]),

        createEx("Dumbbell Shoulder Press", ["Shoulders"], "Dumbbell", "Strength",
            ["Sit on a bench with back support.", "Bring dumbbells to shoulder height, palms forward.", "Feet flat on floor."],
            ["Press straight up overhead until arms lock out.", "Lower slowly until thumbs touch ear level.", "Keep core tight."],
            ["Do not arch your lower back aggressively.", "Push head slightly forward at the top."],
            ["Primary mass builder for shoulders.", "Full range of motion."],
            ["Deltoids", "Triceps"]),

        createEx("Arnold Press", ["Shoulders"], "Dumbbell", "Strength",
            ["Sit upright.", "Start with dumbbells in front of face, palms facing you (supinated).", "Elbows tucked."],
            ["Press up while rotating palms outward.", "Finish at the top with palms facing forward.", "Reverse the rotation on the way down."],
            ["Smooth, controlled rotation is key.", "Don't rush the twist."],
            ["Hits all 3 heads of the deltoid.", "Increases time under tension."],
            ["Anterior Delts", "Lateral Delts", "Rear Delts"]),

        createEx("Lateral Raise", ["Shoulders"], "Dumbbell", "Muscle Build",
            ["Stand tall with dumbbells at sides.", "Slight bend in elbows.", "Lean forward 5 degrees."],
            ["Raise arms out to the sides until parallel with floor.", "Think about lifting with your elbows, not hands.", "Lower slowly."],
            ["Don't swing the body.", "Pinkies should be slightly higher than thumbs (pouring water)."],
            ["Creates shoulder width (the 'Cap').", "Isolates the side delt."],
            ["Lateral Delts"]),

        createEx("Front Raise", ["Shoulders"], "Dumbbell", "Muscle Build",
            ["Stand tall, dumbbells resting on thighs.", "Palms facing thighs (pronated)."],
            ["Raise dumbbells straight to the front until eye level.", "Lower with control.", "Keep arms straight."],
            ["Do not use hip drive to swing weight up.", "Keep chest proud."],
            ["Isolates the front of the shoulder.", "Improves pressing stability."],
            ["Anterior Delts"]),

        createEx("Dumbbell Row", ["Back"], "Dumbbell", "Strength",
            ["Place one knee and same-side hand on a bench.", "Back flat like a table.", "Hold dumbbell in free hand."],
            ["Row the dumbbell up towards your hip pocket.", "Drive elbow back past torso.", "Lower to a full stretch."],
            ["Don't rotate your spine to lift the weight.", "Pull with the elbow, not the bicep."],
            ["Builds back thickness.", "Corrects strength imbalances."],
            ["Latissimus Dorsi", "Rhomboids", "Biceps"]),

        createEx("Dumbbell Pullover", ["Back"], "Dumbbell", "Muscle Build",
            ["Lie perpendicular across a bench (upper back on bench).", "Hold one dumbbell with both hands overhead.", "Hips low."],
            ["Lower the weight behind your head with slight elbow bend.", "Feel a massive stretch in lats/ribs.", "Pull back over to chest."],
            ["Keep hips low to maximize stretch.", "Don't turn it into a tricep extension."],
            ["Expands the ribcage.", "Targets lats and serratus anterior."],
            ["Latissimus Dorsi", "Serratus Anterior"]),

        createEx("Goblet Squat", ["Legs"], "Dumbbell", "Strength",
            ["Hold one dumbbell vertically against your chest.", "Cup the top end in your palms.", "Stance shoulder-width."],
            ["Squat down deep, elbows tracking inside knees.", "Keep chest proud and upright.", "Drive up through heels."],
            ["Don't let the chest collapse forward.", "Keep heels glued to the floor."],
            ["Excellent for learning squat form.", "Builds legs and core."],
            ["Quadriceps", "Glutes", "Core"]),

        createEx("Dumbbell Lunge", ["Legs"], "Dumbbell", "Strength",
            ["Hold dumbbells at sides (suitcase carry).", "Stand tall."],
            ["Step forward with one leg.", "Drop back knee until it hovers 1 inch off floor.", "Push back to start position."],
            ["Keep torso upright.", "Ensure front knee doesn't cave inward."],
            ["Unilateral leg strength.", "Improves balance and hip stability."],
            ["Quadriceps", "Glutes", "Hamstrings"]),

        createEx("Bulgarian Split Squat", ["Legs"], "Dumbbell", "Strength",
            ["Place rear foot laces-down on a bench.", "Hop front foot out.", "Hold dumbbells at sides."],
            ["Squat down until rear knee is near floor.", "Drive up through the front heel.", "Keep torso slightly forward."],
            ["Keep the weight on the front leg.", "This exercise is painful but highly effective."],
            ["The king of single-leg builders.", "Fixes imbalances."],
            ["Glutes", "Quadriceps"]),

        createEx("Romanian Deadlift (DB)", ["Legs"], "Dumbbell", "Strength",
            ["Hold dumbbells in front of thighs.", "Feet hip-width apart.", "Knees slightly soft but fixed."],
            ["Hinge hips backward (close car door with butt).", "Slide dumbbells down legs.", "Feel hamstring stretch.", "Snap hips forward."],
            ["Keep back perfectly flat.", "Do not squat the weight down."],
            ["Builds the posterior chain.", "Hamstring mass."],
            ["Hamstrings", "Glutes", "Lower Back"]),

        createEx("Dumbbell Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Stand tall, dumbbells at sides, palms forward.", "Chest up."],
            ["Curl weight up to shoulders.", "Squeeze biceps hard.", "Lower all the way down."],
            ["Keep elbows fixed in space at your sides.", "Do not swing."],
            ["Classic bicep mass builder."],
            ["Biceps"]),

        createEx("Hammer Curl", ["Arms"], "Dumbbell", "Muscle Build",
            ["Stand tall, palms facing your body (Neutral Grip)."],
            ["Curl weight up, touching thumb to shoulder.", "Lower with control."],
            ["Do not use momentum.", "Keep elbows pinned."],
            ["Targets the side of the arm (brachialis) and forearm.", "Adds arm thickness."],
            ["Brachialis", "Forearms"]),

        createEx("Tricep Kickback", ["Arms"], "Dumbbell", "Muscle Build",
            ["Bent over on a bench (row position).", "Elbow high and pinned to side."],
            ["Extend arm straight back until locked out.", "Hold for 1s.", "Bend elbow back to 90 degrees."],
            ["Do not let the elbow drop during the set.", "Use light weight and focus on the squeeze."],
            ["Isolates the tricep long head.", "Good finishing move."],
            ["Triceps"]),

        createEx("Skull Crusher (DB)", ["Arms"], "Dumbbell", "Muscle Build",
            ["Lie on a bench.", "Arms extended straight up.", "Neutral grip."],
            ["Bend elbows to lower dumbbells beside your ears.", "Extend back up to ceiling.", "Keep elbows pointing up."],
            ["Don't move shoulders, only elbows.", "Feel the deep stretch."],
            ["Mass builder for triceps."],
            ["Triceps"]),

        createEx("Farmers Walk", ["Core", "Traps"], "Dumbbell", "Strength",
            ["Hold heavy dumbbells at sides.", "Stand tall, shoulders back."],
            ["Walk for distance or time.", "Prevent body from swaying.", "Grip the handles tight."],
            ["Keep head neutral.", "Steps should be controlled."],
            ["Total body stability.", "Grip strength and trap size."],
            ["Core", "Forearms", "Traps"]),

        createEx("Zottman Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Stand tall with DBs.", "Curl up with palms facing UP."],
            ["At the top, rotate wrists so palms face DOWN.", "Lower slowly with palms down."],
            ["Control the rotation.", "Keep elbows pinned."],
            ["Hits biceps on the way up, forearms on the way down."],
            ["Biceps", "Brachioradialis"]),

        createEx("Concentration Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Sit on bench, legs wide.", "Hold one DB.", "Rest elbow against inner thigh."],
            ["Curl weight up towards chest.", "Squeeze at peak.", "Lower slowly."],
            ["Do not swing the body.", "Pure isolation."],
            ["Builds the 'peak' of the bicep."],
            ["Biceps"]),

        createEx("DB Floor Press", ["Chest"], "Dumbbell", "Strength",
            ["Lie on the floor with DBs.", "Knees bent, feet flat."],
            ["Press DBs up.", "Lower until triceps lightly touch the floor.", "Pause for 1s."],
            ["Don't bounce elbows off the floor.", "Explode up."],
            ["Builds lockout strength.", "Shoulder-safe pressing option."],
            ["Triceps", "Pectorals"]),

        createEx("Renegade Row", ["Back", "Core"], "Dumbbell", "Strength",
            ["Get into high plank position holding DBs on floor.", "Feet wide for balance."],
            ["Row one DB to hip while balancing on the other.", "Alternate sides.", "Keep hips level."],
            ["Fight the rotation of the hips.", "Keep core super tight."],
            ["Full body tension.", "Anti-rotation strength."],
            ["Latissimus Dorsi", "Core", "Obliques"]),

        createEx("DB Step Up", ["Legs"], "Dumbbell", "Strength",
            ["Stand in front of a box or bench.", "Hold DBs at sides."],
            ["Step one foot entirely on the box.", "Drive through the heel to stand up.", "Control the descent."],
            ["Don't push off the bottom leg.", "Keep torso upright."],
            ["Unilateral leg strength.", "Glute focus."],
            ["Glutes", "Quadriceps"]),

        createEx("DB Shrugs", ["Back", "Traps"], "Dumbbell", "Muscle Build",
            ["Hold heavy DBs at sides.", "Stand tall."],
            ["Shrug shoulders straight up to ears.", "Hold for 1s.", "Lower fully."],
            ["Do not roll shoulders.", "Movement is vertical."],
            ["Upper trap size."],
            ["Upper Traps"]),

        createEx("Seated Calf Raise", ["Legs", "Calves"], "Dumbbell", "Muscle Build",
            ["Sit on a bench.", "Place toes on a block/plate.", "Hold heavy DBs vertically on knees."],
            ["Raise heels as high as possible.", "Lower heels to floor for a stretch.", "High reps."],
            ["Targets the soleus muscle.", "Adds width to the calf."],
            ["Soleus"]),

        // ==================== BODYWEIGHT (DETAILED) ====================
        createEx("Push-ups", ["Chest"], "Bodyweight", "Calisthenics",
            ["High plank position.", "Hands directly under shoulders.", "Glutes and core tight."],
            ["Lower chest to floor.", "Elbows at 45 degree angle.", "Push back up to lockout."],
            ["No sagging hips.", "Keep neck neutral."],
            ["Chest endurance.", "Core stability."],
            ["Pectoralis Major", "Triceps", "Core"]),

        createEx("Pull-ups", ["Back"], "Bodyweight", "Calisthenics",
            ["Overhand grip (palms away).", "Hands slightly wider than shoulders.", "Dead hang."],
            ["Pull chin over the bar.", "Drive elbows down.", "Lower under control."],
            ["No kipping/swinging.", "Engage lats first."],
            ["The king of back exercises.", "Builds width."],
            ["Latissimus Dorsi", "Biceps"]),

        createEx("Chin-ups", ["Back"], "Bodyweight", "Calisthenics",
            ["Underhand grip (palms to face).", "Hands shoulder width."],
            ["Pull chest to the bar.", "Squeeze biceps at top.", "Lower fully."],
            ["Easier than pullups.", "Hits biceps harder."],
            ["Arm size.", "Back strength."],
            ["Biceps", "Latissimus Dorsi"]),

        createEx("Dips", ["Chest", "Triceps"], "Bodyweight", "Calisthenics",
            ["Support yourself on parallel bars.", "Shoulders down and back."],
            ["Lower until shoulders are below elbows (90 deg).", "Push back up.", "Lean forward for chest, upright for triceps."],
            ["Don't shrug shoulders.", "Control the descent."],
            ["The squat of the upper body.", "Mass builder."],
            ["Pectoralis Major", "Triceps"]),

        createEx("Bodyweight Squat", ["Legs"], "Bodyweight", "Calisthenics",
            ["Feet shoulder width.", "Arms out for balance."],
            ["Squat deep, hips below knees.", "Keep knees out.", "Stand up."],
            ["Keep heels down.", "Chest up."],
            ["Leg endurance.", "Mobility."],
            ["Quadriceps", "Glutes"]),

        createEx("Lunge (BW)", ["Legs"], "Bodyweight", "Calisthenics",
            ["Step forward.", "Drop back knee to floor.", "Push back to start."],
            ["Keep torso upright.", "Don't let front knee cave in."],
            ["Balance training.", "Leg endurance."],
            ["Quadriceps", "Glutes"]),

        createEx("Glute Bridge", ["Legs", "Glutes"], "Bodyweight", "Calisthenics",
            ["Lie on back.", "Knees bent, feet flat near butt."],
            ["Drive hips to ceiling.", "Squeeze glutes hard at top.", "Lower."],
            ["Don't arch lower back.", "Drive through heels."],
            ["Glute activation.", "Fixes sitting posture."],
            ["Glute Maximus"]),

        createEx("Plank", ["Core"], "Bodyweight", "Calisthenics",
            ["Forearms on floor.", "Toes on floor.", "Body in straight line."],
            ["Hold.", "Squeeze glutes and abs maximally.", "Breathe."],
            ["Don't let hips sag.", "Don't pike butt up."],
            ["Total core stability."],
            ["Transverse Abdominis"]),

        createEx("Side Plank", ["Core"], "Bodyweight", "Calisthenics",
            ["Lie on side.", "Support on one elbow."],
            ["Lift hips off floor.", "Hold straight line.", "Switch sides."],
            ["Don't let hips rotate forward."],
            ["Oblique stability.", "Spine health."],
            ["Obliques", "Quadratus Lumborum"]),

        createEx("Mountain Climbers", ["Core"], "Bodyweight", "Calisthenics",
            ["Pushup position."],
            ["Drive knees to chest alternately.", "Run in place.", "Keep hips low."],
            ["Don't bounce hips up and down.", "Keep shoulders over hands."],
            ["Cardio core.", "Calorie burn."],
            ["Core", "Cardio"]),

        createEx("Burpees", ["Full Body"], "Bodyweight", "Calisthenics",
            ["Stand.", "Drop to chest on floor.", "Jump feet in.", "Jump up clap."],
            ["Explosive movement.", "Full range of motion."],
            ["Pace yourself.", "Land softly."],
            ["Conditioning.", "Metabolic hit."],
            ["Full Body"]),

        createEx("Hanging Leg Raise", ["Core"], "Bodyweight", "Calisthenics",
            ["Hang from bar.", "Body straight."],
            ["Lift legs to L shape (straight legs) or tuck knees.", "Lower slowly.", "Avoid swinging."],
            ["Compress abs.", "Don't use momentum."],
            ["Lower abs.", "Hip flexor strength."],
            ["Rectus Abdominis", "Hip Flexors"]),

        createEx("Pike Push-up", ["Shoulders"], "Bodyweight", "Calisthenics",
            ["Start in pushup position.", "Walk feet in until hips are high (V shape)."],
            ["Lower head towards floor.", "Push back up/back."],
            ["Mimics an overhead press.", "Keep elbows tucked."],
            ["Shoulder strength without weights."],
            ["Deltoids", "Triceps"]),

        createEx("Pistol Squat", ["Legs"], "Bodyweight", "Strength",
            ["Stand on one leg.", "Extend other leg forward.", "Arms out for balance."],
            ["Squat down on standing leg.", "Go as deep as possible.", "Drive back up."],
            ["Keep heel planted.", "Use a box/bench for regression if needed."],
            ["Mastery of leg strength.", "Balance."],
            ["Quadriceps", "Glutes", "Stabilizers"]),

        createEx("Nordic Curl", ["Legs", "Hamstrings"], "Bodyweight", "Strength",
            ["Kneel on pad.", "Anchor feet under something heavy (or partner)."],
            ["Lower torso forward slowly using hamstrings.", "Control the fall as long as possible.", "Catch yourself with hands."],
            ["Push back up to start.", "Keep hips extended (no hinge)."],
            ["Bulletproofs hamstrings.", "Prevents injury."],
            ["Hamstrings"]),

        createEx("Inverted Row", ["Back"], "Bodyweight", "Calisthenics",
            ["Set a bar at waist height.", "Lie under bar.", "Grab wide."],
            ["Pull chest to bar.", "Keep body in straight plank line.", "Lower slow."],
            ["Squeeze shoulder blades together.", "Don't sag hips."],
            ["Horizontal pull.", "Back thickness."],
            ["Latissimus Dorsi", "Rhomboids"]),

        createEx("Handstand Hold", ["Shoulders"], "Bodyweight", "Calisthenics",
            ["Place hands near wall.", "Kick up so heels touch wall.", "Arms locked."],
            ["Push floor away aggressively.", "Squeeze glutes and abs.", "Hold."],
            ["Look between hands.", "Breathe."],
            ["Overhead stability.", "Shoulder strength."],
            ["Deltoids", "Triceps"]),

        createEx("Calf Raise (BW)", ["Legs", "Calves"], "Bodyweight", "Calisthenics",
            ["Stand on edge of step.", "Heels hanging off.", "Hold wall for balance."],
            ["Drive up onto toes.", "Hold squeeze.", "Lower into deep stretch."],
            ["Full range of motion is key.", "Don't bounce."],
            ["Ankle strength.", "Calf size."],
            ["Gastrocnemius"]),

        // ==================== MOBILITY & WARMUP (DETAILED) ====================
        createEx("Cat-Cow", ["Core"], "Bodyweight", "Mobility",
            ["Start on hands and knees (Tabletop).", "Neutral spine."],
            ["Arch back up towards ceiling (Cat) and exhale.", "Sag belly down towards floor (Cow) and inhale.", "Look up."],
            ["Move with your breath.", "Articulate each vertebrae."],
            ["Spine health.", "Warmup."],
            ["Spine"]),

        createEx("Dead Bug", ["Core"], "Bodyweight", "Mobility",
            ["Lie on back.", "Arms and legs in air (90 degrees).", "Back flat on floor."],
            ["Lower opposite arm and leg towards floor.", "Keep lower back glued to floor.", "Return."],
            ["If back arches, don't go as low.", "Breathe out as you extend."],
            ["Core control.", "Anti-extension."],
            ["Core", "Hip Flexors"]),

        createEx("Thoracic Extension", ["Back"], "Bodyweight", "Mobility",
            ["Place foam roller on upper back.", "Hips on floor."],
            ["Lean back over roller.", "Hands behind head for support.", "Open chest."],
            ["Relax into the stretch.", "Move roller up/down spine."],
            ["Fixes desk posture.", "Shoulder mobility."],
            ["Thoracic Spine"]),

        createEx("World's Greatest Stretch", ["Full Body"], "Bodyweight", "Mobility", 
            ["Start in a high plank position.", "Step left foot outside left hand.", "Keep back leg straight and strong."],
            ["Rotate left arm up to ceiling, looking at hand.", "Bring elbow down toward floor inside foot.", "Switch sides."],
            ["Move slowly and deliberately.", "Breathe deep into the tight spots."],
            ["Opens hips, t-spine, and ankles.", "The ultimate warmup."],
            ["Hips", "Thoracic Spine", "Hamstrings"]),

        createEx("90/90 Hip Switch", ["Legs"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Front leg bent 90¬∞ in front, back leg 90¬∞ to side.", "Torso upright."],
            ["Rotate hips to switch leg positions to the other side.", "Keep heels driven into the floor.", "Try not to use hands for support."],
            ["Stay tall through the spine.", "Move from the hips, not the lower back."],
            ["Internal and external hip rotation.", "Unlocks tight hips."],
            ["Glutes", "Hip Rotators"]),

        createEx("Shoulder Dislocates", ["Shoulders"], "Bodyweight", "Mobility", 
            ["Hold a broomstick or band with a very wide grip.", "Arms straight."],
            ["Raise arms over head and behind back.", "Touch lower back/glutes.", "Return over head to front."],
            ["Do not bend elbows.", "Shrug shoulders at the top if needed."],
            ["Shoulder girdle mobility.", "Chest opener."],
            ["Shoulders", "Pecs"]),

        createEx("Wall Slides", ["Shoulders"], "Bodyweight", "Mobility", 
            ["Stand with back against a wall.", "Feet 6 inches away.", "Press lower back, head, elbows, and wrists into wall."],
            ["Slide arms up into a 'W' then 'Y' shape.", "Maintain contact with wall at all times.", "Slide back down."],
            ["Don't let lower back arch.", "Tuck chin."],
            ["Scapular control.", "Posture correction."],
            ["Lower Traps", "External Rotators"]),

        createEx("Deep Squat Hold", ["Legs"], "Bodyweight", "Mobility", 
            ["Stand shoulder width.", "Hold a weight plate for counterbalance if needed."],
            ["Squat as deep as anatomically possible.", "Keep heels flat.", "Chest up."],
            ["Hold for 30-60 seconds.", "Use elbows to push knees out."],
            ["Ankle mobility.", "Hip opening."],
            ["Hips", "Ankles"]),

        createEx("Couch Stretch", ["Legs"], "Bodyweight", "Mobility", 
            ["Place knee against base of a wall/couch.", "Shin vertical up the wall.", "Other foot lunges forward."],
            ["Squeeze glute of the back leg.", "Raise torso upright.", "Hold."],
            ["Don't hyperextend lower back.", "Squeeze abs."],
            ["Fixes tight hip flexors from sitting.", "Quad stretch."],
            ["Hip Flexors", "Quads"]),

        createEx("Bird Dog", ["Core"], "Bodyweight", "Mobility", 
            ["Start on hands and knees (Tabletop).", "Neutral spine."],
            ["Reach opposite arm and leg straight out.", "Hold for 3s.", "Switch sides."],
            ["Imagine balancing a glass of water on your back.", "Don't rotate hips."],
            ["Core stability.", "Anti-rotation."],
            ["Core", "Glutes", "Shoulders"]),

        // ==================== CABLE VARIATIONS (TORQUE F9 DETAILED) ====================
        createEx("Cable Front Squat", ["Legs"], "Cable", "Strength", 
            ["Set Pulleys Low. Arms Narrow.", "Hold bar/handles at collarbone (rack position).", "Elbows high."],
            ["Squat deep.", "Keep torso vertical.", "Drive up."],
            ["Core works hard to stay upright.", "Fight the pull forward."],
            ["Quad dominance.", "Core strength."],
            ["Quadriceps", "Core"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Zercher Squat", ["Legs"], "Cable", "Strength", 
            ["Set Pulleys Low. Arms Narrow.", "Hold straight bar in crooks of elbows.", "Hands clasped."],
            ["Squat down.", "Keep bar close to body.", "Drive up."],
            ["Brutal on core and upper back.", "Bicep isometric."],
            ["Upper back strength.", "Leg drive."],
            ["Quadriceps", "Upper Back"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Donkey Kick", ["Legs", "Glutes"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Ankle strap.", "Hands on machine for support.", "Bent over."],
            ["Keep knee bent 90¬∞.", "Drive heel up to ceiling.", "Squeeze."],
            ["Don't extend knee.", "Movement comes from hip."],
            ["Upper glute focus.", "Shelf builder."],
            ["Glute Maximus"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Standing Cable Row", ["Back"], "Cable", "Strength", 
            ["Set Pulleys Mid. Arms Mid.", "Squat stance.", "Reach forward."],
            ["Row handles to ribs.", "Stand up slightly as you pull (dynamic).", "Sink back on return."],
            ["Use legs to stabilize.", "Fluid motion."],
            ["Functional pulling.", "Athleticism."],
            ["Latissimus Dorsi", "Legs", "Core"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Lying Cable Curl", ["Arms", "Biceps"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short Bar.", "Lie on back.", "Feet braced on machine."],
            ["Curl bar to forehead/chin.", "Keep elbows fixed.", "Lower."],
            ["Strict isolation.", "No cheating."],
            ["Bicep peaks.", "Form strictness."],
            ["Biceps"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable French Press", ["Arms", "Triceps"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Rope/Bar.", "Bench/Kneel facing away.", "Arms overhead."],
            ["Bend elbows to lower weight behind head.", "Extend to ceiling.", "Keep elbows close."],
            ["Deep stretch.", "Long head focus."],
            ["Tricep size.", "Overhead strength."],
            ["Triceps (Long Head)"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Hip Abduction (Standing)", ["Legs"], "Cable", "Mobility", 
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Outer leg attached."],
            ["Lift leg out to side.", "Keep toes forward.", "Return."],
            ["Don't lean away.", "Use glute medius."],
            ["Hip stability.", "Glute shape."],
            ["Glute Medius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Hip Adduction (Standing)", ["Legs"], "Cable", "Mobility", 
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Inner leg attached."],
            ["Pull leg across body.", "Squeeze inner thigh.", "Return."],
            ["Balance on outer leg."],
            ["Adductor strength.", "Injury prevention."],
            ["Adductors"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Wrist Curl", ["Arms"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short bar.", "Sit on bench/floor.", "Forearms on knees."],
            ["Curl wrists up.", "Squeeze.", "Lower."],
            ["Range of motion is small."],
            ["Forearm size.", "Grip."],
            ["Flexors"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Reverse Wrist Curl", ["Arms"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short bar.", "Palms facing down."],
            ["Extend wrists up.", "Hold.", "Lower."],
            ["Burn is high."],
            ["Top of forearm.", "Elbow health."],
            ["Extensors"], {arms: "Narrow", pulleys: "Low"}),

        // ==================== PART 3: CARDIO, CORE & VARIATIONS (FINAL 40) ====================
        
        // --- ABS & CORE ---
        createEx("Russian Twist", ["Core"], "Bodyweight", "Calisthenics", 
            ["Sit on floor.", "Lean back 45 deg.", "Feet off floor."],
            ["Rotate torso left.", "Touch floor.", "Rotate right."],
            ["Control the twist.", "Oblique focus."],
            ["Rotational core strength."],
            ["Obliques"]),
        createEx("Bicycle Crunch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Hands behind head."],
            ["Elbow to opposite knee.", "Extend other leg."],
            ["Slow and controlled.", "Don't pull neck."],
            ["Full abdominal wall."],
            ["Rectus Abdominis", "Obliques"]),
        createEx("Flutter Kicks", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Hands under butt.", "Legs straight."],
            ["Kick legs up and down.", "Keep lower back pressed down."],
            ["Small range of motion."],
            ["Lower abs endurance."],
            ["Lower Abs"]),
        createEx("V-Ups", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Arms overhead."],
            ["Lift arms and legs to touch toes.", "Body forms V."],
            ["Explosive up.", "Control down."],
            ["Advanced core strength."],
            ["Rectus Abdominis"]),
        createEx("Reverse Crunch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "Knees bent 90 deg."],
            ["Curl hips off floor.", "Knees to chest.", "Lower."],
            ["Don't use momentum.", "Focus on hips curling."],
            ["Lower ab isolation."],
            ["Lower Abs"]),
        createEx("Plank Jack", ["Core", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Plank position."],
            ["Jump feet wide.", "Jump feet together."],
            ["Keep hips level."],
            ["Core conditioning."],
            ["Core"]),
        createEx("Toe Touch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "Legs straight up."],
            ["Crunch up to touch toes.", "Lower."],
            ["Keep legs vertical."],
            ["Upper abs."],
            ["Upper Abs"]),

        // --- PUSHUP VARIATIONS ---
        createEx("Diamond Push-up", ["Arms", "Chest"], "Bodyweight", "Calisthenics", 
            ["Hands form diamond shape.", "Under sternum."],
            ["Lower chest to hands.", "Push up."],
            ["Keep elbows tucked."],
            ["Tricep mass."],
            ["Triceps", "Inner Chest"]),
        createEx("Wide Grip Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Hands wider than shoulders."],
            ["Lower down.", "Push up."],
            ["Less tricep, more chest."],
            ["Outer chest."],
            ["Pectoralis Major"]),
        createEx("Decline Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Feet on bench/chair.", "Hands on floor."],
            ["Push up motion."],
            ["Harder variation."],
            ["Upper chest focus."],
            ["Upper Pecs"]),
        createEx("Incline Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Hands on bench.", "Feet on floor."],
            ["Push up motion."],
            ["Easier variation."],
            ["Lower chest."],
            ["Lower Pecs"]),
        createEx("Scapular Push-up", ["Back", "Shoulders"], "Bodyweight", "Mobility", 
            ["Plank position.", "Arms locked straight."],
            ["Squeeze shoulder blades together.", "Push them apart."],
            ["Tiny range of motion.", "Straight arms."],
            ["Shoulder health."],
            ["Serratus Anterior"]),

        // --- LEG VARIATIONS ---
        createEx("Sumo Squat (DB)", ["Legs"], "Dumbbell", "Strength", 
            ["Wide stance.", "Toes out.", "Hold DB between legs."],
            ["Squat deep.", "Knees track over toes."],
            ["Upright torso."],
            ["Inner thigh focus."],
            ["Adductors", "Quads"]),
        createEx("Curtsy Lunge", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Stand tall."],
            ["Step leg behind and across.", "Lunge down."],
            ["Hip stability."],
            ["Glute medius."],
            ["Glutes"]),
        createEx("Side Lunge", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Step wide to side.", "Keep other leg straight."],
            ["Sit hips back on bent leg.", "Return."],
            ["Inner thigh stretch."],
            ["Lateral movement."],
            ["Adductors", "Quads"]),
        createEx("Single Leg Glute Bridge", ["Legs", "Glutes"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "One leg up.", "One foot flat."],
            ["Drive hip up.", "Squeeze glute.", "Lower."],
            ["Don't twist hips."],
            ["Glute isolation."],
            ["Glutes"]),
        createEx("Good Morning (BW)", ["Legs"], "Bodyweight", "Mobility", 
            ["Hands behind head.", "Knees soft."],
            ["Hinge hips back.", "Back flat.", "Stand up."],
            ["Feel hamstring stretch."],
            ["Hinge pattern practice."],
            ["Hamstrings", "Lower Back"]),

        // --- CARDIO & PLYO ---
        createEx("Jumping Jacks", ["Cardio"], "Bodyweight", "Calisthenics", 
            ["Stand tall."],
            ["Jump feet wide, hands up.", "Jump back."],
            ["Rhythmic."],
            ["Warmup."],
            ["Full Body"]),
        createEx("High Knees", ["Cardio"], "Bodyweight", "Calisthenics", 
            ["Run in place."],
            ["Drive knees to waist height."],
            ["Fast pace."],
            ["Heart rate."],
            ["Legs", "Cardio"]),
        createEx("Jump Squat", ["Legs", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Squat down."],
            ["Explode up.", "Jump off floor.", "Land soft."],
            ["Power."],
            ["Leg power."],
            ["Quads"]),
        createEx("Skater Hops", ["Cardio", "Legs"], "Bodyweight", "Calisthenics", 
            ["Hop sideways to one foot.", "Swing other leg behind."],
            ["Explode back to other side."],
            ["Lateral power."],
            ["Athleticism."],
            ["Glutes", "Cardio"]),
        createEx("Jumping Lunge", ["Legs", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Lunge position."],
            ["Jump and switch legs in air.", "Land in lunge."],
            ["Advanced."],
            ["Leg burn."],
            ["Quads", "Cardio"]),
        createEx("Box Jump", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Stand before box."],
            ["Jump onto box.", "Stand tall.", "Step down."],
            ["Explosive hips."],
            ["Power."],
            ["Quads", "Glutes"]),

        // --- BACK & ARM VARIATIONS ---
        createEx("Superman", ["Back"], "Bodyweight", "Calisthenics", 
            ["Lie on stomach.", "Arms forward."],
            ["Lift arms and legs off floor.", "Hold.", "Lower."],
            ["Squeeze lower back."],
            ["Posterior chain."],
            ["Lower Back", "Glutes"]),
        createEx("Swimmers", ["Back"], "Bodyweight", "Calisthenics", 
            ["Lie on stomach."],
            ["Paddle opposite arm/leg up and down."],
            ["Keep off floor."],
            ["Endurance."],
            ["Lower Back"]),
        createEx("Bench Dip", ["Arms", "Triceps"], "Bodyweight", "Calisthenics", 
            ["Hands on bench behind you.", "Legs straight out."],
            ["Lower hips.", "Push up."],
            ["Don't go too deep."],
            ["Tricep burnout."],
            ["Triceps"]),
        createEx("Close Grip Push-up", ["Arms", "Triceps"], "Bodyweight", "Calisthenics", 
            ["Hands inside shoulder width."],
            ["Elbows rub ribs.", "Push up."],
            ["Tricep focus."],
            ["Arm size."],
            ["Triceps"]),
        createEx("Plate Pinch", ["Arms"], "Free Weight", "Strength", 
            ["Hold weight plates in fingertips."],
            ["Walk or hold for time."],
            ["Don't use thumbs if possible."],
            ["Forearm strength."],
            ["Forearms"]),
        createEx("Svend Press", ["Chest"], "Free Weight", "Strength", 
            ["Stand.", "Squeeze plate between palms at chest."],
            ["Press out.", "Keep squeezing hard.", "Return."],
            ["Inner chest activation."],
            ["Isometric squeeze."],
            ["Inner Pecs"]),
        
        // --- FINAL CABLE VARIATIONS ---
        createEx("Cable Curl (Behind Back)", ["Arms", "Biceps"], "Cable", "Muscle Build", 
            ["Set Low. Face away.", "One hand handle."],
            ["Arm behind body.", "Curl forward."],
            ["Stretch focus."],
            ["Bicep length."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),
        createEx("Cable Row (Wide Grip)", ["Back"], "Cable", "Strength", 
            ["Set Low. Wide bar.", "Sit."],
            ["Row to upper abs.", "Elbows wide."],
            ["Upper back focus."],
            ["Width."],
            ["Rear Delts", "Rhomboids"], {arms: "Narrow", pulleys: "Low"}),
        createEx("Standing Cable Crunch", ["Core"], "Cable", "Muscle Build", 
            ["Set High. Rope.", "Face away."],
            ["Crunch forward.", "Elbows to chest."],
            ["Standing abs."],
            ["Core."],
            ["Abs"], {arms: "Narrow", pulleys: "Top"}),
        // ==================== NIMBLE / LONGEVITY / FLOW (NEW 25) ====================
        
        // --- ANIMAL FLOW & GROUND ---
        createEx("Bear Crawl", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Hands and knees.", "Knees hover 1 inch off floor."], ["Crawl forward opposite hand/foot.", "Keep back flat."], ["Imagine a glass of water on your back."], ["Shoulder stability.", "Core."], ["Core", "Shoulders"]),
        createEx("Crab Walk", ["Nimble", "Shoulders"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Hands behind hips.", "Lift hips."], ["Walk backwards/forwards."], ["Open chest.", "Squeeze glutes."], ["Posterior chain.", "Shoulder mobility."], ["Triceps", "Glutes"]),
        createEx("Kick Through", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Bear crawl position."], ["Rotate hips.", "Kick leg through to side.", "Lift opposite hand."], ["Pivot on foot."], ["Rotational agility."], ["Obliques", "Hips"]),
        createEx("Beast Reach", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Loaded Beast (Child's pose but knees off floor)."], ["Wave forward into plank.", "Drive one knee to elbow.", "Return."], ["Flow smoothly."], ["Spine wave."], ["Spine", "Core"]),
        createEx("Duck Walk", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Deep squat position."], ["Walk forward staying low."], ["Keep chest up.", "Heels can lift."], ["Ankle mobility.", "Hip strength."], ["Quads", "Ankles"]),

        // --- JOINT BULLETPROOFING ---
        createEx("Tibialis Raise", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Lean butt against wall.", "Legs straight out."], ["Lift toes to shins.", "Lower."], ["Feel burn in shins."], ["Bulletproof knees.", "Shin splint help."], ["Tibialis Anterior"]),
        createEx("ATG Split Squat", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Long lunge stance."], ["Push front knee WAY over toe.", "Back leg straight."], ["Cover calf with hamstring."], ["Ankle/Hip mobility."], ["VMO", "Hip Flexors"]),
        createEx("Lu Raise", ["Nimble", "Shoulders"], "Dumbbell", "Mobility", 
            ["Light plates/DBs.", "Stand tall."], ["Lateral raise ALL the way overhead.", "Touch plates at top."], ["Control down."], ["Full scapular movement."], ["Side Delts", "Traps"]),
        createEx("Powell Raise", ["Nimble", "Shoulders"], "Dumbbell", "Strength", 
            ["Lie on side.", "Top arm holds DB."], ["Raise straight arm to vertical."], ["Control down across chest."], ["Scapular health."], ["Rear Delts", "Rhomboids"]),
        createEx("Wrist Rocks", ["Nimble", "Arms"], "Bodyweight", "Mobility", 
            ["Hands and knees.", "Fingers forward/back/side."], ["Rock weight gently over wrists."], ["Elbows locked."], ["Wrist prep for pushups."], ["Forearms"]),
        createEx("Dead Hang", ["Nimble", "Back"], "Bodyweight", "Strength", 
            ["Grab pullup bar."], ["Hang completely loose.", "Relax shoulders."], ["Deep breaths."], ["Spine decompression.", "Grip."], ["Lats", "Forearms"]),

        // --- DYNAMIC MOBILITY ---
        createEx("Cossack Squat", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Wide stance.", "Toes out."], ["Squat to ONE side.", "Other leg straight, toe up."], ["Stay low, switch sides."], ["Hip mobility.", "Groin."], ["Adductors", "Quads"]),
        createEx("Jefferson Curl", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Stand tall.", "Hold light weight (optional)."], ["Tuck chin.", "Roll down one vertebrae at a time.", "Reach floor."], ["Roll up slow."], ["Spine articulation."], ["Spine", "Hamstrings"]),
        createEx("Scorpion Stretch", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Lie on stomach.", "Arms wide."], ["Kick one leg up and over to opposite hand."], ["Touch floor."], ["Dynamic hip/spine twist."], ["Hips", "Spine"]),
        createEx("Inchworm", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Stand.", "Hinge to floor."], ["Walk hands out to plank.", "Walk feet to hands."], ["Keep legs straight."], ["Hamstring stretch."], ["Hamstrings", "Shoulders"]),
        createEx("Thoracic Bridge", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Hands behind."], ["Drive hips up.", "Reach one arm overhead and across."], ["Look at hand."], ["T-Spine opener."], ["Spine", "Glutes"]),

        // --- AGILITY & PROPRIOCEPTION ---
        createEx("Single Leg RDL (BW)", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Stand on one leg."], ["Hinge forward.", "Extend back leg straight."], ["Body creates 'T' shape.", "Return."], ["Balance.", "Hamstring."], ["Hamstrings", "Glutes"]),
        createEx("Lateral Bounds", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Stand on right leg."], ["Jump laterally to left leg.", "Stick the landing."], ["Pause.", "Jump back."], ["Lateral power.", "Stability."], ["Glutes", "Adductors"]),
        createEx("Dot Drill", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Imagine 5 dots (dice 5)."], ["Hop feet between dots fast."], ["pattern variations."], ["Fast feet."], ["Calves", "Coordination"]),
        createEx("Tuck Jumps", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Stand tall."], ["Jump high.", "Tuck knees to chest."], ["Land soft.", "Repeat fast."], ["Explosive power."], ["Quads", "Core"]),
        createEx("A-Skips", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Skip forward."], ["Drive knee high.", "Drive opposite arm."], ["Rhythm and bounce."], ["Sprinting mechanics."], ["Hip Flexors", "Calves"]),

        // --- ISOMETRIC & TENDON ---
        createEx("Horse Stance Hold", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Wide stance.", "Squat until thighs parallel."], ["Back vertical.", "Knees out."], ["Hold for time."], ["Mental toughness.", "Hips."], ["Quads", "Adductors"]),
        createEx("Reverse Plank", ["Nimble", "Core"], "Bodyweight", "Strength", 
            ["Sit legs straight.", "Hands behind hips."], ["Drive hips to ceiling.", "Straight line."], ["Squeeze glutes."], ["Posterior chain."], ["Lower Back", "Glutes"]),
        createEx("Copenhagen Plank", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Side plank.", "Top leg on bench.", "Bottom leg floating."], ["Hold."], ["Brutal inner thigh work."], ["Groin health."], ["Adductors"]),
        createEx("L-Sit (Tuck)", ["Nimble", "Core"], "Bodyweight", "Calisthenics", 
            ["Hands on floor/parallettes."], ["Press down.", "Lift butt and knees off floor."], ["Hold tuck."], ["Core compression."], ["Abs", "Hip Flexors"])

    ]; // END EXERCISE LIST

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// NIMBLE ENGINE V46 (UNIVERSAL TRANSLATOR)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// 1. DATABASE SAFETY CHECK
if (typeof window.allExercises === 'undefined') {
    // Try to recover if 'const' was used instead of 'window.'
    if (typeof allExercises !== 'undefined') window.allExercises = allExercises;
    else window.allExercises = [];
}

// 2. STATE & SETTINGS
let userSettings = JSON.parse(localStorage.getItem('nimbleSettings')) || { 
    hotelMode: false, currentPhase: 1, 
    schedule: { 0:'Rest', 1:'Push', 2:'Pull', 3:'Legs', 4:'Nimble', 5:'Rest', 6:'Full' },
    injuryMode: [] 
};
let activeRoutine = [];
let builderFilters = { muscle: [], equip: [] };
let dailyMacros = JSON.parse(localStorage.getItem('nimbleMacros')) || {c:0, p:0, ch:0, f:0, date: new Date().toDateString()};
let apiKey = "p61IM61sZf897clBskMhwLftfBccew4ZcgsatflX"; 

document.addEventListener('DOMContentLoaded', () => {
    // Boot up features
    switchTab('readiness'); 
    calculateStreak();
    updateMacroUI();
    if(document.getElementById('week-grid')) renderPlanner();
    if(document.getElementById('muscle-heatmap')) renderHeatmap();
    updateInjuryUI();
});

// 3. NAVIGATION
function switchTab(id) {
    document.querySelectorAll('.container').forEach(d => { d.classList.remove('active'); d.style.display = 'none'; });
    let target = document.getElementById('view-' + id);
    if(target) { target.classList.add('active'); target.style.display = 'block'; }
    
    document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
    // Smart button matching
    const btn = Array.from(document.querySelectorAll('.nav-btn')).find(b => {
        const attr = b.getAttribute('onclick');
        return attr && (attr.includes(`'${id}'`) || attr.includes(`"${id}"`));
    });
    if(btn) btn.classList.add('active');
    
    if(id === 'plan') renderPlanner();
    if(id === 'progress') renderHeatmap();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// 4. SMART WORKOUT GENERATOR (The Fix)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function generateRandomWorkout() { generateWorkoutByFilter(() => true, "Random"); }

function loadTemplate(type) {
    // THE TRANSLATION DICTIONARY
    // This teaches the app that "Push" includes Chest, Shoulders, etc.
    const muscleMap = {
        'push': ['Chest', 'Shoulders', 'Triceps', 'Push', 'Delts'],
        'pull': ['Back', 'Biceps', 'Traps', 'Pull', 'Lats', 'Rear Delts'],
        'legs': ['Legs', 'Quads', 'Hamstrings', 'Glutes', 'Calves', 'Lower Body'],
        'full': ['Full', 'Chest', 'Back', 'Legs', 'Shoulders'],
        'nimble': ['Nimble', 'Mobility', 'Core', 'Abs', 'Stretching'],
        'f9': ['Cable']
    };

    const targets = muscleMap[type.toLowerCase()] || [];
    
    generateWorkoutByFilter(e => {
        // Full Body: Accept almost anything
        if (type === 'full') return true; 
        
        // F9: Strict Cable check
        if (type === 'f9') return e.equip === 'Cable';

        // Standard: Check if exercise tags match ANY target
        // e.g. Does "Chest" match ["Chest", "Shoulders"]? YES.
        const exCats = Array.isArray(e.cat) ? e.cat : [e.cat];
        return exCats.some(c => targets.includes(c)) || targets.includes(e.type);
    }, type.toUpperCase()); // Pass name for error message
}

function generateWorkoutByFilter(filterFn, buttonName) {
    // Diagnostic 1: Is DB Empty?
    if(window.allExercises.length === 0) {
        return alert("CRITICAL: Database is empty. Your list has a syntax error or failed to load.");
    }

    let pool = window.allExercises.filter(filterFn);
    
    // Hotel Mode
    if(userSettings.hotelMode) pool = pool.filter(e => !e.name.includes('Barbell') && !e.name.includes('Cable') && !e.name.includes('Machine'));
    
    // Injury Filter
    if(userSettings.injuryMode.length > 0) {
        if(userSettings.injuryMode.includes('Shoulders')) pool = pool.filter(e => !e.cat.includes('Shoulders') && !e.name.includes('Overhead'));
        if(userSettings.injuryMode.includes('Knees')) pool = pool.filter(e => !e.cat.includes('Legs') && !e.name.includes('Squat'));
        if(userSettings.injuryMode.includes('Back')) pool = pool.filter(e => !e.name.includes('Deadlift') && !e.name.includes('Row'));
    }

    // Diagnostic 2: Did we filter everything out?
    if(pool.length === 0) {
        return alert(`No exercises found for '${buttonName}'.\n\n- Check if 'Hotel Mode' is too strict.\n- Check if 'Injury Mode' is blocking everything.\n- Verify your exercises have tags like 'Chest' or 'Back'.`);
    }
    
    activeRoutine = pool.sort(() => 0.5 - Math.random()).slice(0, 6);
    renderWorkout(activeRoutine);
    document.getElementById('setup-panel').style.display = 'none';
    document.getElementById('workout-interface').style.display = 'block';
}

function renderWorkout(exercises) {
    const list = document.getElementById('workout-list');
    list.innerHTML = '';
    const history = JSON.parse(localStorage.getItem('nimbleHistory')) || [];
    
    exercises.forEach((ex, i) => {
        // Sparklines
        const logs = history.filter(h => h.name === ex.name).sort((a,b) => new Date(a.date) - new Date(b.date)).slice(-5);
        let sparkHTML = '';
        if(logs.length > 1) {
             const points = logs.map((l, idx) => `${idx * 20},${30 - (l.weight/300)*30}`).join(' ');
             sparkHTML = `<div class="sparkline-container"><svg width="100%" height="100%"><polyline points="${points}" fill="none" stroke="var(--gold)" stroke-width="2"/></svg></div>`;
        }
        
        const div = document.createElement('div');
        div.className = `card exercise-card ${ex.type || 'Strength'}`;
        const tags = Array.isArray(ex.cat) ? ex.cat.join(', ') : ex.cat;
        
        div.innerHTML = `
            <div class="exercise-header">
                <div onclick="openGuide('${ex.name}')" style="cursor:pointer; text-decoration:underline;"><strong>${ex.name} ‚ÑπÔ∏è</strong></div>
                <span class="swap-btn" onclick="swapExercise(${i})">üîÑ Swap</span>
            </div>
            ${sparkHTML}
            <div style="font-size:0.8em; color:#777; margin-bottom:5px;">${ex.equip} | ${tags}</div>
            <div class="row">
                <input type="number" id="w-${i}" placeholder="Lbs" style="width:45%" oninput="showPlates(this.value)">
                <input type="number" id="r-${i}" placeholder="Reps" style="width:45%">
            </div>
            <button class="btn btn-action" onclick="logSet('${ex.name}', ${i})">‚úÖ Log Set</button>
        `;
        list.appendChild(div);
    });
}

function swapExercise(idx) {
    const current = activeRoutine[idx];
    const alts = window.allExercises.filter(e => {
        // Smart Swap: Find something with matching tags
        const currentTags = Array.isArray(current.cat) ? current.cat : [current.cat];
        const altTags = Array.isArray(e.cat) ? e.cat : [e.cat];
        return altTags.some(t => currentTags.includes(t)) && e.name !== current.name;
    });

    if(alts.length > 0) {
        activeRoutine[idx] = alts[Math.floor(Math.random()*alts.length)];
        renderWorkout(activeRoutine);
    } else { alert("No similar exercises found to swap with."); }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// 5. EXTRAS (Builder, Plan, Fuel)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function openBuilder(isAddMode) {
    document.getElementById('builder-overlay').classList.remove('hidden');
    document.getElementById('builder-overlay').style.display = 'block';
    renderBuilderList();
}
function closeBuilder() { document.getElementById('builder-overlay').style.display = 'none'; }

function renderBuilderList() {
    const list = document.getElementById('builder-list-content');
    const search = document.getElementById('builder-search-inp').value.toLowerCase();
    list.innerHTML = '';
    
    // Show first 50 matches
    const pool = window.allExercises.filter(ex => ex.name.toLowerCase().includes(search));

    pool.slice(0, 50).forEach(ex => {
        const div = document.createElement('div');
        div.className = 'food-item';
        div.innerHTML = `<div><b>${ex.name}</b><br><small>${ex.equip}</small></div><button class="btn-guide" onclick="openGuide('${ex.name}')">‚ÑπÔ∏è</button>`;
        div.onclick = (e) => { 
            if(e.target.tagName === 'BUTTON') return;
            activeRoutine.push(ex); renderWorkout(activeRoutine); closeBuilder(); 
            document.getElementById('setup-panel').style.display = 'none';
            document.getElementById('workout-interface').style.display = 'block';
        };
        list.appendChild(div);
    });
}
function filterBuilderList() { renderBuilderList(); }

function openGuide(exName) {
    const ex = window.allExercises.find(e => e.name === exName);
    if(!ex) return;
    document.getElementById('guide-modal').style.display = 'block';
    document.getElementById('guide-modal').classList.remove('hidden');
    document.getElementById('guide-title').innerText = ex.name;
    
    // Fill Accordions
    document.getElementById('guide-prep').innerHTML = formatGuide(ex.guide.prep || "No data.");
    document.getElementById('guide-exec').innerHTML = formatGuide(ex.guide.exec || "No data.");
    document.getElementById('guide-tips').innerHTML = formatGuide(ex.guide.tips || "No data.");
    
    // F9 Setup
    const f9 = document.getElementById('f9-setup-section');
    if(ex.equip === 'Cable' && ex.setup) {
        f9.style.display = 'block';
        document.getElementById('guide-arms').innerText = ex.setup.arms || '--';
        document.getElementById('guide-pulleys').innerText = ex.setup.pulleys || '--';
    } else { f9.style.display = 'none'; }
    
    // Setup GIF Search Link
    document.getElementById('gif-search-btn').href = `https://www.google.com/search?tbm=isch&q=${encodeURIComponent(ex.name + ' exercise gif')}`;
}
function closeGuideModal() { document.getElementById('guide-modal').style.display = 'none'; }
function formatGuide(arr) { return Array.isArray(arr) ? `<ul>${arr.map(i => `<li>${i}</li>`).join('')}</ul>` : arr; }

// Fuel, Plan, Stats Utils
function finishSession() {
    if(confirm("Finish Workout?")) {
        document.getElementById('setup-panel').style.display = 'block';
        document.getElementById('workout-interface').style.display = 'none';
        activeRoutine = [];
    }
}
function cancelWorkout() { finishSession(); }
function logSet(name, idx) {
    const w = document.getElementById(`w-${idx}`).value;
    const r = document.getElementById(`r-${idx}`).value;
    if(!w || !r) return;
    let h = JSON.parse(localStorage.getItem('nimbleHistory')) || [];
    h.push({date: new Date().toISOString(), name, weight: w, reps: r});
    localStorage.setItem('nimbleHistory', JSON.stringify(h));
    document.activeElement.innerText = "Saved!"; 
    document.activeElement.style.backgroundColor = "var(--success)";
    calculateStreak();
}
function calculateStreak() {
    const h = JSON.parse(localStorage.getItem('nimbleHistory')) || [];
    if(h.length === 0) return;
    const dates = [...new Set(h.map(l => l.date.split('T')[0]))].sort().reverse();
    let streak = 0;
    let today = new Date().toISOString().split('T')[0];
    let yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
    if(dates.includes(today) || dates.includes(yesterday)) {
        streak = 1;
        let checkDate = new Date(dates.includes(today) ? today : yesterday);
        for(let i=1; i<dates.length; i++) {
            checkDate.setDate(checkDate.getDate() - 1);
            if(dates.includes(checkDate.toISOString().split('T')[0])) streak++; else break;
        }
    }
    document.getElementById('streak-count').innerText = streak;
}
function updateMacroUI() {
    if(dailyMacros.date !== new Date().toDateString()) {
        dailyMacros = {c:0, p:0, ch:0, f:0, date: new Date().toDateString()};
        localStorage.setItem('nimbleMacros', JSON.stringify(dailyMacros));
    }
    document.getElementById('disp-cals').innerText = dailyMacros.c;
    document.getElementById('disp-pro').innerText = dailyMacros.p;
    document.getElementById('bar-cals').style.width = Math.min((dailyMacros.c / 2500)*100, 100) + "%";
    document.getElementById('bar-pro').style.width = Math.min((dailyMacros.p / 180)*100, 100) + "%";
}
async function searchFood() {
    const query = document.getElementById('food-search').value;
    const resDiv = document.getElementById('search-results');
    if(!query) return;
    resDiv.innerHTML = '<div style="padding:10px; color:#aaa;">Scanning...</div>';
    try {
        const res = await fetch(`https://api.nal.usda.gov/fdc/v1/foods/search?query=${query}&pageSize=5&api_key=${apiKey}`);
        const data = await res.json();
        resDiv.innerHTML = '';
        if(!data.foods) return resDiv.innerHTML = 'No results.';
        data.foods.forEach(f => {
            const getNut = (id) => (f.foodNutrients.find(x => x.nutrientId === id) || {}).value || 0;
            const c=Math.round(getNut(1008)), p=Math.round(getNut(1003));
            const div = document.createElement('div');
            div.className = 'food-item';
            div.innerHTML = `<div><b>${f.description}</b><br><small>${c}cal P:${p}</small></div><button class="btn-action" style="width:auto;">+</button>`;
            div.onclick = () => {
                dailyMacros.c += c; dailyMacros.p += p; 
                localStorage.setItem('nimbleMacros', JSON.stringify(dailyMacros));
                updateMacroUI();
                alert("Added!");
                resDiv.innerHTML = '';
            };
            resDiv.appendChild(div);
        });
    } catch(e) { resDiv.innerHTML = 'Error searching.'; }
}
function renderPlanner() {
    const grid = document.getElementById('week-grid');
    if(!grid) return;
    grid.innerHTML = '';
    const days = ['S','M','T','W','T','F','S'];
    days.forEach((d, i) => {
        const type = userSettings.schedule[i] || 'Rest';
        grid.innerHTML += `<div class="day-bubble" onclick="setSchedule(${i})"><b>${d}</b><span style="font-size:0.5em">${type.substring(0,3)}</span></div>`;
    });
}
function setSchedule(i) {
    const types = ['Rest','Push','Pull','Legs','Nimble','Full'];
    const cur = userSettings.schedule[i] || 'Rest';
    const next = types[(types.indexOf(cur)+1)%types.length];
    userSettings.schedule[i] = next;
    localStorage.setItem('nimbleSettings', JSON.stringify(userSettings));
    renderPlanner();
}
function renderHeatmap() {
    const h = JSON.parse(localStorage.getItem('nimbleHistory')) || [];
    const counts = {};
    h.forEach(l => { const ex = window.allExercises.find(e => e.name === l.name); if(ex) {
        const cats = Array.isArray(ex.cat) ? ex.cat : [ex.cat];
        cats.forEach(c => counts[c] = (counts[c]||0)+1); 
    }});
    const container = document.getElementById('muscle-heatmap');
    if(!container) return;
    container.innerHTML = '';
    ['Chest','Back','Legs','Shoulders','Arms','Core'].forEach(m => {
        const val = counts[m] || 0;
        let cls = 'heat-cell';
        if(val > 10) cls += ' heat-hot'; else if(val > 5) cls += ' heat-warm'; else if(val > 0) cls += ' heat-mild';
        container.innerHTML += `<div class="${cls}">${m}<br>${val}</div>`;
    });
}
function toggleInjuryPanel() { document.getElementById('injury-chips').style.display = document.getElementById('injury-chips').style.display === 'none' ? 'flex' : 'none'; }
function toggleInjury(part, btn) {
    const idx = userSettings.injuryMode.indexOf(part);
    if(idx > -1) { userSettings.injuryMode.splice(idx, 1); btn.classList.remove('danger-active'); } 
    else { userSettings.injuryMode.push(part); btn.classList.add('danger-active'); }
    localStorage.setItem('nimbleSettings', JSON.stringify(userSettings));
    document.getElementById('injury-status').innerText = userSettings.injuryMode.join(', ') || 'None';
}
function calcReadiness() { document.getElementById('score-display').innerText = (parseInt(document.getElementById('val-sleep').value)*10) + "%"; }
function showPlates(val) { document.getElementById('plate-helper').innerHTML = val >= 135 ? `<div class="plate p-45"></div>`.repeat(Math.floor((val-45)/90)) : ''; }
function updateTimeLabel(val) { document.getElementById('time-val').innerText = (val * 7) + "m (" + val + " Ex)"; }
function nextPhase() { userSettings.currentPhase = (userSettings.currentPhase % 4) + 1; localStorage.setItem('nimbleSettings', JSON.stringify(userSettings)); renderPlanner(); }
function startBreathWork() { document.getElementById('breath-modal').style.display = 'flex'; }
function openTimerOverlay() { document.getElementById('timer-overlay').style.display = 'flex'; }
function closeTimer() { document.getElementById('timer-overlay').style.display = 'none'; }
function saveBodyStat() { alert("Weight Saved!"); }
function exportData() { alert("Data Copied!"); }
function setTheme(n) { alert("Theme: " + n); }
</script>
</body>
</html>
