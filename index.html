<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1e1e1e">
   <meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Nimble Shred v41.0</title>
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiTmltYmxlIFNocmVkIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxMjEyMTIiLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsInRoZW1lX2NvbG9yIjoiIzFlMWUxZSIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2ltZy5pY29uczguY29tL2ZsdWVuY3kvOTYvbnVsbC9kdW1iYmVsbC5wbmciLCJzaXplcyI6Ijk2eDk2IiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/96/null/dumbbell.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --primary: #BB86FC; --sec: #03DAC6; --text: #fff; --gold: #FFD700; --danger: #CF6679; --success: #00C853; --warn: #FF9800; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; padding-bottom: 120px; -webkit-tap-highlight-color: transparent; }
        
        /* Layout */
        .container { max-width: 800px; margin: 0 auto; display: none; padding-bottom: 80px; } 
        .container.active { display: block; }
        h1, h2 { text-align: center; margin: 10px 0; }
        
        /* Nav */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a1a; display: flex; justify-content: space-around; padding: 15px 10px; border-top: 1px solid #333; z-index: 9000; padding-bottom: max(15px, env(safe-area-inset-bottom)); box-shadow: 0 -5px 10px rgba(0,0,0,0.5); }
        .nav-btn { background: none; color: #777; border: none; font-size: 0.75em; display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; }
        .nav-btn.active { color: var(--sec); }
        .nav-icon { font-size: 1.5em; }
        
        /* UI Elements */
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); position: relative; }
        .btn { display: block; width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 16px; transition: 0.1s; }
        .btn:active { transform: scale(0.98); }
        .btn-main { background: var(--sec); color: #000; }
        .btn-action { background: var(--primary); color: #000; }
        .btn-danger { background: var(--danger); color: #fff; }
        input, select, textarea { width: 100%; padding: 10px; background: #2c2c2c; border: 1px solid #444; border-radius: 6px; color: #fff; font-size: 16px; box-sizing: border-box; }
        .row { display: flex; gap: 10px; align-items: center; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .unit-toggle { background: #333; padding: 5px 12px; border-radius: 20px; font-size: 0.8em; border: 1px solid #555; color: #aaa; cursor: pointer; }
        
        /* Filter Chips */
        .chip-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; }
        .chip { padding: 6px 12px; background: #333; border: 1px solid #555; border-radius: 20px; font-size: 0.8em; cursor: pointer; color: #aaa; transition: 0.2s; }
        .chip.active { background: var(--primary); color: #000; border-color: var(--primary); font-weight: bold; }
        
        /* Exercise Cards */
        .exercise-card { border-left: 4px solid var(--primary); margin-bottom: 15px; }
        .exercise-card.Mobility { border-left-color: var(--sec); }
        .exercise-card.Strength { border-left-color: var(--danger); }
        .exercise-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .suggestion-text { color: var(--success); font-size: 0.85em; margin: 5px 0; font-style: italic; display: flex; align-items: center; gap: 5px; }
        
        /* Accordion Styles (The Encyclopedia) */
        details { background: #252525; margin-bottom: 10px; border-radius: 8px; overflow: hidden; border: 1px solid #333; }
        summary { padding: 12px; cursor: pointer; font-weight: bold; list-style: none; display: flex; justify-content: space-between; align-items: center; }
        summary::-webkit-details-marker { display: none; }
        summary:after { content: '+'; font-size: 1.2em; color: var(--sec); }
        details[open] summary:after { content: '-'; }
        details[open] summary { border-bottom: 1px solid #333; background: rgba(255,255,255,0.05); }
        .detail-content { padding: 15px; font-size: 0.9em; line-height: 1.5; color: #ddd; }
        .detail-content ul { padding-left: 20px; margin: 0; }
        .detail-content li { margin-bottom: 5px; }
        
        /* Smart Viewer */
        .visual-container { background: #000; border-radius: 8px; overflow: hidden; height: 250px; display: flex; align-items: center; justify-content: center; border: 1px solid #333; position: relative; margin-bottom: 15px; }
        #visual-content-img { width: 100%; height: 100%; object-fit: contain; display: none; }
        #visual-content-iframe { width: 100%; height: 100%; border: none; display: none; }
        .visual-placeholder { color: #555; text-align: center; padding: 20px; font-size: 0.9em; position: absolute; }
        
        /* Overlays & Macros */
        .fs-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 10000; padding: 20px; overflow-y: auto; box-sizing: border-box; display: none; }
        .fs-overlay.flex-center { display: none; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.95); }
        .hidden { display: none !important; }
        #sync-loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #121212; z-index: 20000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s; }
        
        .macro-bar-container { background: #333; height: 12px; border-radius: 6px; margin-top: 5px; overflow: hidden; position: relative; }
        .macro-fill { height: 100%; transition: width 0.5s; }
        .macro-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; text-align: center; font-size: 0.85em; }
        .gif-input { width: 100%; padding: 10px; background: #111; border: 1px solid #444; color: #fff; border-radius: 4px; margin-top: 5px; margin-bottom: 5px; font-size: 0.8em; }
        .btn-guide { background: #333; color: #aaa; border: 1px solid #444; padding: 5px 10px; border-radius: 5px; font-size: 0.8em; cursor: pointer; }
        .mic-btn { background: #333; border: 1px solid #555; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2em; cursor: pointer; }
        .meal-section { border-top: 1px solid #333; margin-top: 15px; padding-top: 10px; }
        .meal-header { font-weight: bold; color: var(--gold); display: flex; justify-content: space-between; margin-bottom: 5px; }
        .food-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #2a2a2a; font-size: 0.9em; cursor: pointer; }
        .source-switch { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; font-size: 0.9em; }
        .source-opt { cursor: pointer; padding: 5px 10px; border-radius: 5px; border: 1px solid #333; color: #777; }
        .source-opt.active { background: var(--primary); color: #000; border-color: var(--primary); font-weight: bold; }
        
        .timer-badge { position: fixed; bottom: 80px; right: 20px; background: var(--danger); color: #fff; padding: 15px; border-radius: 50%; width: 60px; height: 60px; display: none; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2em; box-shadow: 0 4px 8px rgba(0,0,0,0.5); z-index: 8000; cursor: pointer; }
        .timer-badge.active { display: flex; animation: timerPulse 1s infinite; }
        @keyframes timerPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        /* --- V42 UPGRADES: PLANNER & COACHING --- */
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin: 15px 0; }
.day-bubble { background: #333; aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8em; cursor: pointer; border: 1px solid #444; flex-direction: column; }
.day-bubble.active { border-color: var(--primary); color: var(--primary); }
.day-bubble.done { background: var(--sec); color: #000; border-color: var(--sec); }
.sparkline-container { width: 100%; height: 30px; margin-top: 5px; }
.rpe-slider { width: 100%; accent-color: var(--warn); margin: 10px 0; }
.swap-btn { font-size: 0.8em; color: var(--gold); border: 1px solid var(--gold); padding: 2px 6px; border-radius: 4px; cursor: pointer; margin-left: 10px; }
.confetti { position: absolute; width: 10px; height: 10px; background: #f00; animation: fall linear forwards; }
@keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
.breath-circle { width: 100px; height: 100px; border-radius: 50%; background: var(--sec); margin: 0 auto; animation: breathe 8s infinite ease-in-out; opacity: 0.6; }
@keyframes breathe { 0%, 100% { transform: scale(0.8); } 50% { transform: scale(1.5); } }
.plate-popup { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #222; padding: 10px; border: 1px solid #555; border-radius: 8px; z-index: 1000; display: flex; gap: 5px; }
.plate { height: 40px; width: 10px; border-radius: 2px; border: 1px solid #000; }
.p-45 { background: #0048BA; width: 15px; } .p-35 { background: #FCN; } .p-25 { background: #006B3C; } .p-10 { background: #eee; }
.checklist-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; display:none; flex-direction:column; justify-content:center; align-items:center; }
    </style>
</head>
<body>

<div id="sync-loader">
    <div style="font-size:3em; margin-bottom:20px;">‚òÅÔ∏è</div>
    <h3>Syncing with Cloud...</h3>
    <small style="color:#777; margin-top:10px;">Checking History, Foods & GIFs</small>
</div>
<script>
    // This runs instantly to ensure you are never stuck
    window.onload = function() {
        const loader = document.getElementById('sync-loader');
        if(loader) {
            loader.style.opacity = '0';
            setTimeout(() => loader.style.display = 'none', 500);
        }
    };
    // Backup Timer in case window.onload fails
    setTimeout(() => {
        const loader = document.getElementById('sync-loader');
        if(loader) loader.style.display = 'none';
    }, 2000);
</script>
<div id="timer-badge" class="timer-badge" onclick="openTimerOverlay()"></div>

<div class="container active" id="view-readiness">
    <div class="top-bar"><h2>Daily Check-In</h2><button class="unit-toggle" onclick="toggleUnit()"><span id="unit-disp-1">LBS</span></button></div>
    <div class="card" style="display:flex; justify-content:space-between; align-items:center; background: linear-gradient(45deg, #1e1e1e, #252525);">
        <div><div style="font-size:0.8em; color:#aaa;">Current Streak</div><div style="font-size:1.5em; font-weight:bold;">üî• <span id="streak-count">0</span> Days</div></div>
        <div id="readiness-badge" style="font-size:2em;">üõ°Ô∏è</div>
    </div>
    <div class="card">
        <h3>How are you feeling?</h3>
        <div class="row" style="margin-top:10px;"><span>üò¥ Sleep</span> <input type="range" id="val-sleep" min="1" max="10" value="5" oninput="calcReadiness()"></div>
        <div class="row" style="margin-top:15px;"><span>ü§ï Pain</span> <input type="range" id="val-sore" min="1" max="10" value="5" oninput="calcReadiness()"></div>
        <div class="row" style="margin-top:15px;"><span>‚ö° Energy</span> <input type="range" id="val-mood" min="1" max="10" value="5" oninput="calcReadiness()"></div>
        <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
        <div class="row"><input type="number" id="garmin-score" placeholder="Garmin Body Battery (Optional)" oninput="calcReadiness()"></div>
        <div style="text-align:center; margin-top:15px;"><div style="font-size:2.5em; font-weight:bold; color:var(--sec);" id="score-display">--</div><div style="color:#aaa; font-style:italic;" id="score-text">Move sliders to calculate</div></div>
        <button type="button" class="btn btn-main" onclick="handleReadinessLog()" style="margin-top:15px;">üíæ Log & Get Advice</button>
    </div>
</div>

<div class="container" id="view-coach">
    <div id="setup-panel">
        <div class="top-bar"><h2>Workout Strategy</h2><button class="unit-toggle" onclick="toggleUnit()"><span id="unit-disp-2">LBS</span></button></div>
       <div class="card" style="border-left: 4px solid var(--danger); margin-bottom:10px;">
            <div style="display:flex; justify-content:space-between; align-items:center; cursor:pointer;" onclick="toggleInjuryPanel()">
                <h3 style="margin:0; font-size:1.1em;">ü©π Injury / Pain Mode</h3>
                <span id="injury-status" style="font-size:0.8em; color:#777;">None</span>
            </div>
            <div id="injury-chips" class="chip-container" style="display:none; margin-top:10px; padding-top:10px; border-top:1px solid #333;">
                <div class="chip" onclick="toggleInjury('Shoulders', this)">Shoulders</div>
                <div class="chip" onclick="toggleInjury('Knees', this)">Knees</div>
                <div class="chip" onclick="toggleInjury('Lower Back', this)">Lower Back</div>
                <div class="chip" onclick="toggleInjury('Wrists', this)">Wrists</div>
            </div>
        </div>
        <div class="card">
            <h3>Quick Start</h3>
            
            <div class="row" style="margin-bottom:10px; justify-content:space-between;">
                <label style="color:#aaa;">‚è±Ô∏è Duration</label>
                <span id="time-val" style="color:var(--sec); font-weight:bold;">45m (6 Ex)</span>
            </div>
            <input type="range" id="slider-time" min="3" max="12" value="6" step="1" style="margin-bottom:20px;" oninput="updateTimeLabel(this.value)">

           <div class="chip-container">
                <div class="chip" onclick="loadTemplate('push')">Push</div>
                <div class="chip" onclick="loadTemplate('pull')">Pull</div>
                <div class="chip" onclick="loadTemplate('legs')">Legs</div>
                <div class="chip" onclick="loadTemplate('full')">Full Body</div>
                <div class="chip" onclick="loadTemplate('nimble')">ü™∂ Nimble / Flow</div>
                <div class="chip" onclick="loadTemplate('f9')">‚öôÔ∏è Torque F9</div>
            </div>

          <button type="button" class="btn btn-main" onclick="generateRandomWorkout()">üé≤ Random Workout</button>
            <button type="button" class="btn btn-action" onclick="openBuilder()">üõ†Ô∏è Build Custom</button>
        </div>
    </div> <div id="active-workout" class="hidden">
        <div class="top-bar"><h3>Active Session</h3><button type="button" class="btn-danger" style="width:auto; padding:5px 10px;" onclick="cancelWorkout()">End</button></div>
        <div id="workout-list"></div>
        <button type="button" class="btn btn-action" onclick="openBuilder(true)">‚ûï Add Exercise</button>
        <button type="button" class="btn btn-main" onclick="finishSession()">üíæ Finish & Save</button>
    </div>
</div>

<div class="container" id="view-food">
    <div class="top-bar"><h2>Fuel Log</h2></div>
    <div class="card">
        <div class="macro-grid">
            <div>üî• <span id="disp-cals">0</span><div class="macro-bar-container"><div id="bar-cals" class="macro-fill" style="width:0%; background:var(--sec);"></div></div></div>
            <div>ü•© <span id="disp-pro">0</span>g<div class="macro-bar-container"><div id="bar-pro" class="macro-fill" style="width:0%; background:var(--primary);"></div></div></div>
            <div>üçö <span id="disp-carb">0</span>g<div class="macro-bar-container"><div id="bar-carb" class="macro-fill" style="width:0%; background:var(--warn);"></div></div></div>
            <div>ü•ë <span id="disp-fat">0</span>g<div class="macro-bar-container"><div id="bar-fat" class="macro-fill" style="width:0%; background:var(--danger);"></div></div></div>
        </div>
    </div>
    <div class="card">
    
        <div class="row"><input type="text" id="food-search" placeholder="Search Food..."><button class="btn-action" style="width:auto;" onclick="searchFood()">üîé</button></div>
        <div id="search-results" style="margin-top:10px; max-height:200px; overflow-y:auto;"></div>
    </div>
    <div class="card" id="meal-container"></div>
</div>

<div class="container" id="view-wellness">
    <h2>Wellness</h2>
    <div class="card"><h3>‚öñÔ∏è Body Weight</h3><div class="row"><input type="number" id="body-weight" placeholder="Lbs"><button class="btn-action" onclick="saveBodyStat()">Log</button></div></div>
</div>

<div class="container" id="view-progress">
    <h2>Command Center</h2>
    
    <div class="card">
        <h3>üé® App Theme</h3>
        <div class="chip-container">
            <div class="chip" onclick="setTheme('cyber')">Cyberpunk</div>
            <div class="chip" onclick="setTheme('tactical')">Tactical</div>
            <div class="chip" onclick="setTheme('zen')">Zen White</div>
            <div class="chip" onclick="setTheme('midnight')">Midnight</div>
        </div>
    </div>

    <div class="card">
        <h3>üî• Muscle Heatmap (Last 30 Days)</h3>
        <div id="muscle-heatmap" class="macro-grid" style="grid-template-columns: 1fr 1fr;">
            </div>
    </div>

    <div class="card">
        <h3>üìà Strength Progress</h3>
        <select id="chart-select" onchange="renderChart()"><option>Select Exercise...</option></select>
        <canvas id="progressChart"></canvas>
    </div>
    
    <button class="btn btn-action" onclick="exportData()">‚¨áÔ∏è Export Data</button>
</div>

<div class="nav-bar">
    <button class="nav-btn active" onclick="switchTab('readiness')">
        <span class="nav-icon">üîã</span>Daily
    </button>
    <button class="nav-btn" onclick="switchTab('plan')">
        <span class="nav-icon">üìÖ</span>Plan
    </button>
    <button class="nav-btn" onclick="switchTab('food')">
        <span class="nav-icon">üçó</span>Fuel
    </button>
    <button class="nav-btn" onclick="switchTab('wellness')">
        <span class="nav-icon">üßò</span>Body
    </button>
    <button class="nav-btn" onclick="switchTab('progress')">
        <span class="nav-icon">üìà</span>Stats
    </button>
</div>

<div id="readiness-modal" class="fs-overlay flex-center hidden">
    <div class="card" style="width:85%; max-width:350px; text-align:center;">
        <div id="readiness-icon" style="font-size:3em;">‚ö†Ô∏è</div>
        <h2 id="readiness-title">Recovery Mode</h2>
        <p id="readiness-desc" style="color:#aaa; margin-bottom:20px;">Low score detected.</p>
        <button class="btn btn-main" onclick="applyReadinessStrategy('modify')">üìâ Modify (Reduce Volume)</button>
        <button class="btn btn-action" onclick="applyReadinessStrategy('ignore')">üî• Ignore (Full Send)</button>
        <button class="btn btn-danger" style="margin-top:10px;" onclick="closeReadinessModal()">Cancel</button>
    </div>
</div>

<div id="guide-modal" class="fs-overlay hidden">
    <div class="top-bar"><h2 id="guide-title">Exercise Name</h2><button class="btn-danger" style="width:auto;" onclick="closeGuideModal()">Close</button></div>
    <div class="card">
        <div id="f9-setup-section" class="card" style="background: #333; margin-bottom: 15px; border-left: 4px solid var(--gold); display:none;">
            <div style="font-size:0.8em; color:#aaa; margin-bottom:5px;">TORQUE F9 SETUP</div>
            <div class="row">
                <div style="flex:1"><strong>üí™ Arms:</strong> <span id="guide-arms">--</span></div>
                <div style="flex:1"><strong>‚ÜïÔ∏è Pulleys:</strong> <span id="guide-pulleys">--</span></div>
            </div>
        </div>
        <span class="guide-label">üé• Visual Guide</span>
        <div class="visual-container">
            <div id="visual-error" class="visual-placeholder">
                No Visual Saved.<br>
                <small>Paste GIF or YouTube Link below.</small>
            </div>
            <img id="visual-content-img" src="">
            <iframe id="visual-content-iframe" src="" allowfullscreen></iframe>
        </div>
        
        <div id="accordion-container">
            <details id="det-prep">
                <summary>‚öôÔ∏è Preparation</summary>
                <div class="detail-content" id="guide-prep"></div>
            </details>
            
            <details id="det-exec" open>
                <summary>üöÄ Execution</summary>
                <div class="detail-content" id="guide-exec"></div>
            </details>
            
            <details id="det-tips">
                <summary>üéì Coaching Tips</summary>
                <div class="detail-content" id="guide-tips"></div>
            </details>
            
            <details id="det-musc">
                <summary>üí™ Muscles & Benefits</summary>
                <div class="detail-content" id="guide-musc"></div>
            </details>
        </div>

        <div style="background:#252525; padding:15px; border-radius:8px; margin-top:20px; border-top:1px solid #444;">
            <a id="gif-search-btn" href="#" target="_blank" class="btn-guide" style="display:block; text-align:center; text-decoration:none; margin-bottom:10px;">üîé Find on Google (GIFs)</a>
            <input type="text" id="guide-gif-input" class="gif-input" placeholder="Paste YouTube or GIF URL...">
            <button class="btn btn-action" style="margin-top:5px;" onclick="saveGuideGif()">üíæ Save Media</button>
        </div>
    </div>
</div>

<div id="food-modal" class="fs-overlay flex-center hidden">
    <div class="card" style="width:85%; max-width:350px;">
        <h3>Adjust Portion</h3>
        <h4 id="food-modal-name" style="color:var(--primary);">Food Name</h4>
        <div class="row" style="margin:15px 0;">
            <div style="flex:1"><label style="font-size:0.8em; color:#aaa;">Qty</label><input type="number" id="food-qty" value="1" step="0.25" oninput="updateFoodCalc()"></div>
            <div style="flex:2; text-align:right;"><div style="font-size:1.5em; font-weight:bold; color:var(--sec);"><span id="food-calc-cals">0</span> kcal</div><div style="font-size:0.9em; color:#aaa;"><span id="food-calc-pro">0</span>g Pro</div></div>
        </div>
        <div class="row">
            <button class="btn-guide" onclick="selectMeal('Breakfast', this)">Breakfast</button>
            <button class="btn-guide" onclick="selectMeal('Lunch', this)">Lunch</button>
            <button class="btn-guide" onclick="selectMeal('Dinner', this)">Dinner</button>
            <button class="btn-guide" onclick="selectMeal('Snacks', this)">Snack</button>
        </div>
        <button class="btn btn-main" style="margin-top:15px;" onclick="confirmAddFood()">‚úÖ Add to Log</button>
        <button class="btn btn-danger" style="margin-top:10px;" onclick="closeFoodModal()">Cancel</button>
    </div>
</div>

<div id="builder-overlay" class="fs-overlay hidden">
    <div class="top-bar"><h2>Exercise Builder</h2><button class="btn-danger" style="width:auto;" onclick="closeBuilder()">Close</button></div>
    <div class="card">
        <label style="font-size:0.8em; color:#777;">Filters</label>
        <div class="chip-container" id="filter-muscle">
            <div class="chip" onclick="toggleFilter('muscle', 'Chest', this)">Chest</div>
            <div class="chip" onclick="toggleFilter('muscle', 'Back', this)">Back</div>
            <div class="chip" onclick="toggleFilter('muscle', 'Legs', this)">Legs</div>
            <div class="chip" onclick="toggleFilter('muscle', 'Shoulders', this)">Shoulders</div>
            <div class="chip" onclick="toggleFilter('muscle', 'Arms', this)">Arms</div>
            <div class="chip" onclick="toggleFilter('muscle', 'Core', this)">Core</div>
        </div>
        <div class="chip-container" id="filter-equip">
            <div class="chip active" onclick="toggleFilter('equip', 'Cable', this)">F9 Cable</div>
            <div class="chip" onclick="toggleFilter('equip', 'Dumbbell', this)">Dumbbell</div>
            <div class="chip" onclick="toggleFilter('equip', 'Bodyweight', this)">Bodyweight</div>
        </div>
        <input type="text" id="builder-search-inp" placeholder="Search..." onkeyup="filterBuilderList()">
        <div id="builder-list-content" style="margin-top:10px;"></div>
    </div>
</div>
<div class="container hidden" id="view-plan">
    <h2>Weekly Structure</h2>
    
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>üìÖ Phase: <span id="cycle-phase" style="color:var(--primary)">Week 1</span></h3>
            <small onclick="nextPhase()" style="color:#777; cursor:pointer; border:1px solid #444; padding:2px 6px; border-radius:4px;">Next >></small>
        </div>
        <div class="calendar-grid" id="week-grid"></div>
        <div id="day-detail" style="margin-top:10px; font-style:italic; color:#aaa; font-size:0.9em; text-align:center;">Tap a day to schedule</div>
    </div>
    
    <div class="card">
        <h3>‚öîÔ∏è Active Challenge</h3>
        <p style="margin-bottom:5px;">30 Days of Nimble Hips</p>
        <div class="macro-bar-container"><div class="macro-fill" style="width: 45%; background: var(--gold);"></div></div>
        <small style="color:#aaa;">Day 14/30</small>
    </div>

    <div class="card" onclick="startBreathWork()">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>üßò Recovery Breath</h3>
            <span style="font-size:1.5em;">ü´Å</span>
        </div>
        <p style="color:#aaa; font-size:0.8em;">Box breathing to lower cortisol.</p>
    </div>
</div>

<div class="container hidden" id="view-food">
    <h2>Nutrition Log</h2>
    <div class="card">
        <input type="text" id="food-search" placeholder="Search Food (e.g. Chicken)" onchange="searchFood()">
        <button class="btn btn-action" onclick="searchFood()">Search</button>
        <div id="search-results" style="margin-top:10px;"></div>
    </div>
    <div id="meal-container"></div>
</div>

<div class="container hidden" id="view-progress">
    <h2>Command Center</h2>
    </div>

<div id="breath-modal" class="checklist-modal" onclick="this.style.display='none'">
    <div class="breath-circle"></div>
    <h2 style="margin-top:30px; color:#fff;">Breathe In...</h2>
</div>

<div id="plate-helper" class="plate-popup hidden"></div>
<div id="timer-overlay" class="fs-overlay flex-center hidden">
    <div id="timer-display" style="font-size:4em; font-weight:bold; color:var(--primary);">00:00</div>
    <div style="margin-top:20px;">
        <button class="btn-danger" onclick="closeTimer()">Stop</button>
        <button class="btn-action" onclick="addTime(10)">+10s</button>
        <button class="btn-action" onclick="addTime(30)">+30s</button>
    </div>
</div>
 
<script>
 
   // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// GLOBALS + MACRO GOALS + HELPER
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrJx09CB_N0PO8FDTNbugokJK7CEHqJ4Zk3197Agcew_QNkMBZZ2C61vb53ctcna80dQ/exec";
let state = { unit: 'lbs', history: [], food: [], wellness: [], readiness: [], routine: [] };
let apiKey = "p61IM61sZf897clBskMhwLftfBccew4ZcgsatflX";
let searchSource = "usda";
let activeRoutine = [];
let activeFilters = { muscle: [], equip: ['Cable'] };
let pendingFood = null;
let selectedMeal = 'Snacks';
let gifOverrides = {};
let timerInterval = null;
let timerSeconds = 0;
let myChart = null;
let currentGuideExercise = null;
let modifyVolume = false;

// Default macro goals ‚Äî edit these if you want different targets
let macroGoals = { cals: 2500, pro: 180, carb: 300, fat: 80 };

function createEx(name, cat, equip, type, prep, exec, tips, benefits, muscles, setupF9) {
    return {
        name: name, cat: cat, equip: equip, type: type,
        guide: { prep: prep, exec: exec, tips: tips, benefits: benefits, muscles: muscles },
        setup: setupF9 || { arms: "N/A", pulleys: "N/A" }
    };
}

    // --- EXERCISE DATABASE (PLACEHOLDER - PASTE STEP 2 HERE) ---
    const allExercises = [
       // ==================== CABLE CHEST (TORQUE F9) ====================
        createEx("Cable Chest Press", ["Chest"], "Cable", "Strength", 
            ["Set Arms to Wide (Pos 8-9). Pulleys at Chest Height.", "Grab handles and step forward into a split stance (one foot forward) for stability.", "Brace core and lean slightly forward, keeping spine neutral."],
            ["Press handles straight forward until arms are fully extended.", "Bring hands together at the center line.", "Slowly return elbows to a 45-degree angle (don't let them fly back behind shoulders)."],
            ["Don't flare elbows wide; keep them tucked.", "Keep shoulders down (depressed); don't shrug.", "Drive through the back leg."],
            ["Constant tension on pectorals throughout the rep.", "Reduced shoulder strain compared to bench press.", "High core activation for stability."],
            ["Pectoralis Major", "Triceps", "Front Delts"], {arms: "Wide (Pos 8-9)", pulleys: "Chest Height"}),

        createEx("Cable Chest Fly (High)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Top Position. Arms Wide.", "Step forward, lean torso 30¬∞ forward.", "Start with arms open wide, elbows slightly bent."],
            ["Fly hands down and together towards your waist.", "Imagine hugging a large tree trunk.", "Squeeze inner chest hard at the bottom.", "Control the return to the stretch position."],
            ["Don't turn it into a press; keep the elbow angle fixed.", "Keep chest proud, don't round shoulders forward."],
            ["Targets the lower (sternal) head of the chest.", "Excellent for creating the lower pec outline."],
            ["Lower Pectorals", "Anterior Delts"], {arms: "Wide", pulleys: "Top"}),

        createEx("Cable Chest Fly (Low)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Bottom Position. Arms Wide.", "Stand centrally with feet shoulder-width apart.", "Palms facing forward and up."],
            ["Scoop hands up and together to eye level.", "Focus on driving the elbows in and up.", "Squeeze the upper chest at the peak.", "Lower slowly to the starting position."],
            ["Don't swing your body to hoist the weight.", "Keep elbows soft (slightly bent) but rigid.", "Focus on the 'scoop' motion."],
            ["Targets the upper (clavicular) chest.", "Helps fill out the shelf of the chest."],
            ["Upper Pectorals", "Front Delts"], {arms: "Wide", pulleys: "Bottom"}),

        createEx("Cable Chest Fly (Mid)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Chest Height. Arms Wide.", "Step forward into a split stance.", "Palms facing each other."],
            ["Bring hands together directly in front of your chest.", "Squeeze hard for 1 second at the touch point.", "Open arms wide until you feel a deep stretch across the pecs."],
            ["Retract shoulder blades on the negative.", "Don't lock out elbows at the end range."],
            ["Builds overall chest mass.", "Focuses on peak contraction."],
            ["Pectoralis Major"], {arms: "Wide", pulleys: "Chest Height"}),

        createEx("Single Arm Cable Chest Press", ["Chest"], "Cable", "Strength",
            ["Set Pulley to Chest Height.", "Adopt a split stance.", "Hold one handle at your chest."],
            ["Press straight out while keeping hips and shoulders perfectly square.", "Resist the rotation of your torso.", "Return slowly to the start."],
            ["Fight the urge to twist your body.", "Engage obliques heavily to stabilize."],
            ["Corrects strength imbalances.", "Massive anti-rotation core workout."],
            ["Pecs", "Obliques", "Triceps"], {arms: "Standard", pulleys: "Chest Height"}),

        createEx("Cable Crossover", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys Top. Arms Wide.", "Step forward aggressively.", "Lean torso forward 45 degrees."],
            ["Bring hands down and across each other.", "Cross wrists at the bottom to maximize range of motion.", "Alternate which hand is on top each rep."],
            ["Focus on the inner chest squeeze.", "Keep the movement distinct from a press."],
            ["Creates inner chest definition.", "Maximum contraction at the bottom."],
            ["Inner Pectorals"], {arms: "Wide", pulleys: "Top"}),

        createEx("Cable Pullover (Bench)", ["Chest", "Lats"], "Cable", "Muscle Build",
            ["Set Pulley Mid/Low. Arms Narrow.", "Place bench perpendicular to machine.", "Lie on back, head near machine.", "Hold rope or bar."],
            ["Keeping arms straight, pull the weight from behind your head over to your hips.", "Squeeze chest and lats at the bottom.", "Slowly return weight behind head for a stretch."],
            ["Keep arms straight but not locked.", "Feel the deep stretch in your armpits."],
            ["Expands the ribcage.", "Hits both chest and lats effectively."],
            ["Serratus Anterior", "Lats", "Pecs"], {arms: "Narrow", pulleys: "Mid"}),

        // ==================== CABLE BACK (TORQUE F9) ====================
        createEx("Lat Pulldown (Standing)", ["Back"], "Cable", "Strength",
            ["Set Pulleys Top. Arms Narrow or Top.", "Kneel or squat down on the floor.", "Hold handles with palms facing forward."],
            ["Drive elbows down towards your back pockets.", "Squeeze lats hard at the bottom.", "Allow arms to stretch fully up at the top."],
            ["Think 'Elbows to pockets', not 'Hands to shoulders'.", "Keep chest proud.", "Don't round your back."],
            ["Builds back width (V-Taper).", "Safe vertical pull pattern."],
            ["Latissimus Dorsi", "Biceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Seated Cable Row", ["Back"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Narrow.", "Sit on floor or bench.", "Brace feet against machine frame if possible."],
            ["Pull handles into your stomach.", "Drive elbows back past your torso.", "Squeeze shoulder blades together."],
            ["Keep spine neutral and upright.", "Don't rock back and forth excessively."],
            ["Builds back thickness.", "Corrects posture."],
            ["Rhomboids", "Traps", "Lats"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Face Pulls", ["Back", "Shoulders"], "Cable", "Mobility",
            ["Set Pulley to Face Height. Use Rope.", "Grip rope with thumbs facing back.", "Staggered stance."],
            ["Pull the center of the rope to your forehead.", "Externally rotate hands back (like a double bicep pose).", "Squeeze rear delts."],
            ["Don't shrug shoulders up to ears.", "Lead with your wrists."],
            ["Essential for shoulder health.", "Strengthens rotator cuff."],
            ["Rear Delts", "Rotator Cuff"], {arms: "Narrow", pulleys: "Face Height"}),

        createEx("Straight Arm Pulldown", ["Back"], "Cable", "Muscle Build",
            ["Set Pulleys Top. Arms Top.", "Hinge hips slightly back.", "Keep arms straight out in front."],
            ["Push the bar/handles down to your thighs using your lats.", "Keep arms straight throughout.", "Squeeze armpits tight at the bottom."],
            ["Don't use triceps to push.", "Initiate movement with your lats."],
            ["Pure lat isolation.", "Great as a pre-exhaust."],
            ["Latissimus Dorsi"], {arms: "Top", pulleys: "Top"}),

        createEx("Single Arm Cable Row", ["Back"], "Cable", "Strength",
            ["Set Pulley Waist Height. Arms Standard.", "Adopt a split stance.", "Reach forward with the working arm."],
            ["Row elbow back tight to the body.", "Allow torso to rotate slightly forward on the stretch.", "Rotate back to neutral on the pull."],
            ["Get a deep stretch at the start.", "Hard contraction at the end."],
            ["Unilateral back growth.", "Core integration."],
            ["Lats", "Obliques"], {arms: "Standard", pulleys: "Waist Height"}),

        createEx("Cable Shrugs", ["Back", "Traps"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Stand centrally.", "Hold handles at sides."],
            ["Shrug shoulders straight up towards your ears.", "Hold for 1 second at the top.", "Lower fully to stretch traps."],
            ["Don't roll shoulders forward or back.", "Keep arms straight."],
            ["Builds trap size.", "Neck strength."],
            ["Trapezius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Rear Delt Fly", ["Back", "Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Eye Level. Arms Wide.", "Grab opposite cables (Left hand holds Right cable).", "Stand tall."],
            ["Pull arms apart horizontally until in line with body.", "Squeeze the back of your shoulders.", "Control the return."],
            ["Keep arms straight.", "Don't engage traps (keep shoulders down)."],
            ["Builds 3D Delts.", "Improves posture."],
            ["Posterior Delts"], {arms: "Wide", pulleys: "Eye Level"}),

        createEx("High Row (Rope)", ["Back"], "Cable", "Strength",
            ["Set Pulleys Top. Arms Narrow.", "Use Rope attachment.", "Step back and lean slightly."],
            ["Pull the rope towards your neck/chin.", "Drive elbows high and wide.", "Squeeze upper back."],
            ["Focus on the upper back, not the lats.", "Keep elbows flared."],
            ["Builds upper back thickness.", "Hits rear delts hard."],
            ["Rhomboids", "Rear Delts"], {arms: "Narrow", pulleys: "Top"}),

        // ==================== CABLE SHOULDERS ====================
        createEx("Cable Overhead Press", ["Shoulders"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Wide.", "Hold handles at shoulder height.", "Stand strong with core braced."],
            ["Press straight up overhead.", "Bring biceps by ears at the top.", "Lower with control to ear level."],
            ["Keep core tight.", "Don't arch your lower back."],
            ["Builds shoulder mass.", "Constant tension compared to dumbbells."],
            ["Anterior Delts", "Triceps"], {arms: "Wide", pulleys: "Low"}),

        createEx("Cable Lateral Raise", ["Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Cross cables (Left hand -> Right cable).", "Stand center."],
            ["Raise arms out to the sides.", "Stop at shoulder height.", "Lower slowly."],
            ["Lead with your elbows, not your hands.", "Imagine pouring a pitcher of water."],
            ["Builds side delt width.", "Creates caped shoulder look."],
            ["Lateral Delts"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Front Raise", ["Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Face away from machine.", "Cable runs between legs."],
            ["Raise straight arms to the front.", "Stop at eye level.", "Lower with control."],
            ["No swinging.", "Keep chest up."],
            ["Isolates the front delt."],
            ["Anterior Delts"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable External Rotation", ["Shoulders", "Mobility"], "Cable", "Mobility",
            ["Set Pulley Elbow Height.", "Stand sideways.", "Elbow pinned to side (use a towel if needed)."],
            ["Rotate hand away from your body.", "Keep elbow glued to ribs.", "Return slowly."],
            ["Use very light weight.", "Focus on the small cuff muscles."],
            ["Rotator cuff health.", "Injury prevention."],
            ["Infraspinatus"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Internal Rotation", ["Shoulders", "Mobility"], "Cable", "Mobility",
            ["Set Pulley Elbow Height.", "Stand sideways.", "Elbow pinned to side."],
            ["Rotate hand inward towards your stomach.", "Keep elbow glued.", "Return."],
            ["Control the motion.", "Don't use chest to pull."],
            ["Subscapularis strength."],
            ["Subscapularis"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Upright Row", ["Shoulders", "Traps"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Bar or Handles.", "Stand close."],
            ["Pull hands up body to chest.", "Elbows lead movement high.", "Lower."],
            ["Don't go too heavy.", "Watch wrists."],
            ["Side delts and Traps."],
            ["Lateral Delts", "Traps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Y-Raise", ["Back", "Shoulders"], "Cable", "Mobility",
            ["Set Pulleys Low. Arms Low.", "Cross cables.", "Stand tall."],
            ["Raise arms up and out into 'Y' shape.", "Squeeze lower traps.", "Lower slowly."],
            ["Thumbs up.", "Don't arch back."],
            ["Lower trap activation.", "Scapular health."],
            ["Lower Traps", "Side Delts"], {arms: "Low", pulleys: "Low"}),

        // ==================== CABLE ARMS ====================
        createEx("Tricep Pushdown (Rope)", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Pin elbows to your ribs.", "Hinge only at the elbow."],
            ["Push down forcefully.", "Spread the rope apart at the bottom.", "Return to 90 degrees."],
            ["Keep elbows locked in place.", "Squeeze triceps hard."],
            ["Targets the lateral head.", "Great for definition."],
            ["Triceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Tricep Pushdown (Bar)", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Use Straight Bar.", "Elbows pinned to sides."],
            ["Push straight down.", "Lockout arms fully.", "Return to chest height."],
            ["Go heavier than with rope.", "Keep wrists straight."],
            ["Overall tricep mass builder."],
            ["Triceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Overhead Cable Extension", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Mid/Top.", "Lean forward facing away from machine.", "Hold rope behind head."],
            ["Extend arms forward and overhead.", "Keep elbows by ears.", "Stretch back deeply."],
            ["The deep stretch is key here.", "Don't flare elbows too wide."],
            ["Targets the Long Head of the tricep.", "Adds arm size."],
            ["Triceps (Long Head)"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Bicep Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Hold bar or handles.", "Stand tall."],
            ["Curl weight up to chin.", "Squeeze biceps.", "Lower fully."],
            ["Keep elbows slightly forward of hips.", "Don't lean back."],
            ["Constant tension curls."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Hammer Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Use Rope.", "Neutral grip (palms facing)."],
            ["Curl up towards shoulders.", "Thumbs lead the movement.", "Lower."],
            ["Focus on forearms and brachialis.", "No swinging."],
            ["Adds arm thickness and width."],
            ["Brachialis", "Forearms"], {arms: "Low", pulleys: "Low"}),

        createEx("Bayesian Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low. Face away.", "Arm extended behind torso.", "Step forward."],
            ["Curl forward while keeping elbow back.", "Feel the deep stretch at start."],
            ["Unique stretch angle for hypertrophy.", "Keep shoulder stable."],
            ["Targets the long head via stretch."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Kickback", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Bent over.", "No attachment."],
            ["Extend arm back.", "Squeeze hard.", "Bend elbow only."],
            ["Don't swing shoulder."],
            ["Peak contraction."],
            ["Triceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Reverse Grip Pushdown", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Palms up (Supinated).", "Elbows pinned."],
            ["Push down.", "Squeeze."],
            ["Don't loose grip."],
            ["Medial head focus."],
            ["Triceps"], {arms: "Top", pulleys: "Top"}),

        // ==================== CABLE LEGS ====================
        createEx("Cable Squat", ["Legs"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Narrow.", "Hold handles at shoulders (rack position).", "Stance shoulder width."],
            ["Squat down deep.", "Keep chest upright.", "Drive up through heels."],
            ["Safer on the back than barbell squats.", "Easy to bail if needed."],
            ["Quad focus with less spinal load."],
            ["Quads", "Glutes"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Pull-Through", ["Legs", "Glutes"], "Cable", "Strength",
            ["Set Pulley Low. Rope.", "Face away from machine.", "Hold rope between legs."],
            ["Hinge hips back towards machine.", "Feel hamstring stretch.", "Snap hips forward to stand."],
            ["It is a hinge, not a squat.", "Squeeze glutes hard at top.", "Don't pull with arms."],
            ["Best glute builder on cable.", "Teaches hip hinge."],
            ["Glutes", "Hamstrings"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable RDL", ["Legs", "Hamstrings"], "Cable", "Strength",
            ["Set Pulleys Low.", "Face machine.", "Hold handles at thighs."],
            ["Hinge hips back.", "Keep knees soft but fixed.", "Lower until back is parallel to floor."],
            ["Feel deep hamstring stretch.", "Drive hips forward to stand."],
            ["Posterior chain builder."],
            ["Hamstrings"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Lunge", ["Legs"], "Cable", "Strength",
            ["Set Pulleys Low.", "Hold handles.", "Step back into a lunge."],
            ["Drop back knee to floor.", "Drive up through front heel.", "Keep chest up."],
            ["Stability challenge.", "Keep knee in line with toe."],
            ["Unilateral leg strength."],
            ["Quads", "Glutes"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Kickback (Glute)", ["Legs", "Glutes"], "Cable", "Muscle Build",
            ["Set Pulley Low. Ankle strap.", "Face machine.", "Lean forward slightly."],
            ["Kick leg straight back and up.", "Squeeze glute at top.", "Return slowly."],
            ["Don't rotate hips open.", "Movement comes from hip, not back."],
            ["Glute isolation."],
            ["Glute Maximus"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Calf Raise", ["Legs", "Calves"], "Cable", "Muscle Build",
            ["Set Pulleys Low.", "Stand on a block or plate.", "Hold handles."],
            ["Lower heels to floor.", "Drive up onto toes.", "Squeeze hard."],
            ["Full range of motion is critical.", "Don't bounce."],
            ["Calf size and strength."],
            ["Calves"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Abductor", ["Legs", "Glutes"], "Cable", "Mobility",
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Leg furthest from machine."],
            ["Kick leg out to side.", "Control return."],
            ["Stabilize with other leg."],
            ["Side glute.", "Hip health."],
            ["Glute Medius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Adductor", ["Legs"], "Cable", "Mobility",
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Leg closest to machine."],
            ["Pull leg across body.", "Control return."],
            ["Balance key."],
            ["Inner thigh."],
            ["Adductors"], {arms: "Low", pulleys: "Low"}),

        // ==================== CABLE CORE ====================
        createEx("Cable Crunch", ["Core"], "Cable", "Muscle Build",
            ["Set Pulley Top. Rope.", "Kneel down facing machine.", "Hold rope at ears."],
            ["Curl spine down towards floor.", "Bring elbows to knees.", "Squeeze abs."],
            ["Don't hinge at the hips.", "Round the back like a shrimp."],
            ["Weighted abdominal hypertrophy."],
            ["Rectus Abdominis"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Woodchopper (High to Low)", ["Core"], "Cable", "Mobility",
            ["Set Pulley Top.", "Stand sideways.", "Grab handle with both hands."],
            ["Chop down and across body to opposite knee.", "Pivot back foot.", "Return slowly."],
            ["Explosive down, controlled up.", "Keep arms straight."],
            ["Oblique power.", "Rotational strength."],
            ["Obliques"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Pallof Press", ["Core"], "Cable", "Strength",
            ["Set Pulley Chest Height.", "Stand sideways.", "Hold handle at chest."],
            ["Press handle straight out.", "Hold for 2-3 seconds.", "Return to chest."],
            ["Resist the rotation pulling you in.", "Keep shoulders square."],
            ["The ultimate anti-rotation exercise.", "Spine health."],
            ["Core Stabilizers"], {arms: "Narrow", pulleys: "Chest Height"}),

        createEx("Cable Side Bend", ["Core"], "Cable", "Mobility",
            ["Set Pulley Low. Stand sideways to the machine.", "Hold the handle in one hand, arm hanging straight down.", "Feet shoulder-width apart."],
            ["Lean your torso away from the machine, crunching the oblique.", "Return to neutral, resisting the pull.", "Do not lean forward or back."],
            ["Focus on the ribcage moving towards the hip.", "Keep the arm straight; don't pull with the bicep."],
            ["Isolates the obliques.", "Strengthens the lateral core."],
            ["Obliques"], {arms: "Low", pulleys: "Low"}),

        createEx("Woodchopper (Low to High)", ["Core"], "Cable", "Mobility",
            ["Set Pulley Low.", "Stand sideways.", "Hands on handle."],
            ["Rotate up across body.", "Pivot foot.", "Return."],
            ["Full rotation."],
            ["Functional core."],
            ["Obliques"], {arms: "Narrow", pulleys: "Low"}),

        // ==================== DUMBBELLS (DETAILED) ====================
        createEx("Dumbbell Bench Press", ["Chest"], "Dumbbell", "Strength",
            ["Lie on a flat bench with 5 points of contact (head, shoulders, butt, left foot, right foot).", "Hold dumbbells at chest level, palms facing forward.", "Retract shoulder blades."],
            ["Press dumbbells straight up to full lockout.", "Lower slowly (3 seconds) until hands are level with chest.", "Elbows should be at a 45-degree angle to body."],
            ["Drive feet into the floor.", "Do not bounce the weights at the bottom.", "Keep wrists straight."],
            ["Builds chest mass.", "Requires more stabilizer muscle than barbell."],
            ["Pectoralis Major", "Triceps", "Front Delts"]),

        createEx("Dumbbell Incline Press", ["Chest"], "Dumbbell", "Strength",
            ["Set bench to 30 or 45 degrees.", "Kick dumbbells up to shoulders using knees.", "Palms forward."],
            ["Press straight up towards the ceiling.", "Lower slowly to upper chest level.", "Keep elbows tucked, not flared."],
            ["Keep head on the bench.", "Squeeze pecs at the top."],
            ["Targets the 'shelf' of the upper chest.", "Less stress on rotator cuff than flat bench."],
            ["Upper Pectorals", "Front Delts"]),

        createEx("Dumbbell Fly", ["Chest"], "Dumbbell", "Muscle Build",
            ["Lie on a flat bench.", "Hold dumbbells above chest, palms facing each other (neutral grip).", "Slight bend in elbows."],
            ["Lower arms out to sides in a wide arc.", "Feel a deep stretch across the chest.", "Squeeze back to the top like hugging a barrel."],
            ["Don't go below shoulder level if it hurts.", "Keep the elbow bend constant."],
            ["Expands the chest.", "Isolates the pecs without tricep involvement."],
            ["Pectoralis Major"]),

        createEx("Dumbbell Shoulder Press", ["Shoulders"], "Dumbbell", "Strength",
            ["Sit on a bench with back support.", "Bring dumbbells to shoulder height, palms forward.", "Feet flat on floor."],
            ["Press straight up overhead until arms lock out.", "Lower slowly until thumbs touch ear level.", "Keep core tight."],
            ["Do not arch your lower back aggressively.", "Push head slightly forward at the top."],
            ["Primary mass builder for shoulders.", "Full range of motion."],
            ["Deltoids", "Triceps"]),

        createEx("Arnold Press", ["Shoulders"], "Dumbbell", "Strength",
            ["Sit upright.", "Start with dumbbells in front of face, palms facing you (supinated).", "Elbows tucked."],
            ["Press up while rotating palms outward.", "Finish at the top with palms facing forward.", "Reverse the rotation on the way down."],
            ["Smooth, controlled rotation is key.", "Don't rush the twist."],
            ["Hits all 3 heads of the deltoid.", "Increases time under tension."],
            ["Anterior Delts", "Lateral Delts", "Rear Delts"]),

        createEx("Lateral Raise", ["Shoulders"], "Dumbbell", "Muscle Build",
            ["Stand tall with dumbbells at sides.", "Slight bend in elbows.", "Lean forward 5 degrees."],
            ["Raise arms out to the sides until parallel with floor.", "Think about lifting with your elbows, not hands.", "Lower slowly."],
            ["Don't swing the body.", "Pinkies should be slightly higher than thumbs (pouring water)."],
            ["Creates shoulder width (the 'Cap').", "Isolates the side delt."],
            ["Lateral Delts"]),

        createEx("Front Raise", ["Shoulders"], "Dumbbell", "Muscle Build",
            ["Stand tall, dumbbells resting on thighs.", "Palms facing thighs (pronated)."],
            ["Raise dumbbells straight to the front until eye level.", "Lower with control.", "Keep arms straight."],
            ["Do not use hip drive to swing weight up.", "Keep chest proud."],
            ["Isolates the front of the shoulder.", "Improves pressing stability."],
            ["Anterior Delts"]),

        createEx("Dumbbell Row", ["Back"], "Dumbbell", "Strength",
            ["Place one knee and same-side hand on a bench.", "Back flat like a table.", "Hold dumbbell in free hand."],
            ["Row the dumbbell up towards your hip pocket.", "Drive elbow back past torso.", "Lower to a full stretch."],
            ["Don't rotate your spine to lift the weight.", "Pull with the elbow, not the bicep."],
            ["Builds back thickness.", "Corrects strength imbalances."],
            ["Latissimus Dorsi", "Rhomboids", "Biceps"]),

        createEx("Dumbbell Pullover", ["Back"], "Dumbbell", "Muscle Build",
            ["Lie perpendicular across a bench (upper back on bench).", "Hold one dumbbell with both hands overhead.", "Hips low."],
            ["Lower the weight behind your head with slight elbow bend.", "Feel a massive stretch in lats/ribs.", "Pull back over to chest."],
            ["Keep hips low to maximize stretch.", "Don't turn it into a tricep extension."],
            ["Expands the ribcage.", "Targets lats and serratus anterior."],
            ["Latissimus Dorsi", "Serratus Anterior"]),

        createEx("Goblet Squat", ["Legs"], "Dumbbell", "Strength",
            ["Hold one dumbbell vertically against your chest.", "Cup the top end in your palms.", "Stance shoulder-width."],
            ["Squat down deep, elbows tracking inside knees.", "Keep chest proud and upright.", "Drive up through heels."],
            ["Don't let the chest collapse forward.", "Keep heels glued to the floor."],
            ["Excellent for learning squat form.", "Builds legs and core."],
            ["Quadriceps", "Glutes", "Core"]),

        createEx("Dumbbell Lunge", ["Legs"], "Dumbbell", "Strength",
            ["Hold dumbbells at sides (suitcase carry).", "Stand tall."],
            ["Step forward with one leg.", "Drop back knee until it hovers 1 inch off floor.", "Push back to start position."],
            ["Keep torso upright.", "Ensure front knee doesn't cave inward."],
            ["Unilateral leg strength.", "Improves balance and hip stability."],
            ["Quadriceps", "Glutes", "Hamstrings"]),

        createEx("Bulgarian Split Squat", ["Legs"], "Dumbbell", "Strength",
            ["Place rear foot laces-down on a bench.", "Hop front foot out.", "Hold dumbbells at sides."],
            ["Squat down until rear knee is near floor.", "Drive up through the front heel.", "Keep torso slightly forward."],
            ["Keep the weight on the front leg.", "This exercise is painful but highly effective."],
            ["The king of single-leg builders.", "Fixes imbalances."],
            ["Glutes", "Quadriceps"]),

        createEx("Romanian Deadlift (DB)", ["Legs"], "Dumbbell", "Strength",
            ["Hold dumbbells in front of thighs.", "Feet hip-width apart.", "Knees slightly soft but fixed."],
            ["Hinge hips backward (close car door with butt).", "Slide dumbbells down legs.", "Feel hamstring stretch.", "Snap hips forward."],
            ["Keep back perfectly flat.", "Do not squat the weight down."],
            ["Builds the posterior chain.", "Hamstring mass."],
            ["Hamstrings", "Glutes", "Lower Back"]),

        createEx("Dumbbell Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Stand tall, dumbbells at sides, palms forward.", "Chest up."],
            ["Curl weight up to shoulders.", "Squeeze biceps hard.", "Lower all the way down."],
            ["Keep elbows fixed in space at your sides.", "Do not swing."],
            ["Classic bicep mass builder."],
            ["Biceps"]),

        createEx("Hammer Curl", ["Arms"], "Dumbbell", "Muscle Build",
            ["Stand tall, palms facing your body (Neutral Grip)."],
            ["Curl weight up, touching thumb to shoulder.", "Lower with control."],
            ["Do not use momentum.", "Keep elbows pinned."],
            ["Targets the side of the arm (brachialis) and forearm.", "Adds arm thickness."],
            ["Brachialis", "Forearms"]),

        createEx("Tricep Kickback", ["Arms"], "Dumbbell", "Muscle Build",
            ["Bent over on a bench (row position).", "Elbow high and pinned to side."],
            ["Extend arm straight back until locked out.", "Hold for 1s.", "Bend elbow back to 90 degrees."],
            ["Do not let the elbow drop during the set.", "Use light weight and focus on the squeeze."],
            ["Isolates the tricep long head.", "Good finishing move."],
            ["Triceps"]),

        createEx("Skull Crusher (DB)", ["Arms"], "Dumbbell", "Muscle Build",
            ["Lie on a bench.", "Arms extended straight up.", "Neutral grip."],
            ["Bend elbows to lower dumbbells beside your ears.", "Extend back up to ceiling.", "Keep elbows pointing up."],
            ["Don't move shoulders, only elbows.", "Feel the deep stretch."],
            ["Mass builder for triceps."],
            ["Triceps"]),

        createEx("Farmers Walk", ["Core", "Traps"], "Dumbbell", "Strength",
            ["Hold heavy dumbbells at sides.", "Stand tall, shoulders back."],
            ["Walk for distance or time.", "Prevent body from swaying.", "Grip the handles tight."],
            ["Keep head neutral.", "Steps should be controlled."],
            ["Total body stability.", "Grip strength and trap size."],
            ["Core", "Forearms", "Traps"]),

        createEx("Zottman Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Stand tall with DBs.", "Curl up with palms facing UP."],
            ["At the top, rotate wrists so palms face DOWN.", "Lower slowly with palms down."],
            ["Control the rotation.", "Keep elbows pinned."],
            ["Hits biceps on the way up, forearms on the way down."],
            ["Biceps", "Brachioradialis"]),

        createEx("Concentration Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Sit on bench, legs wide.", "Hold one DB.", "Rest elbow against inner thigh."],
            ["Curl weight up towards chest.", "Squeeze at peak.", "Lower slowly."],
            ["Do not swing the body.", "Pure isolation."],
            ["Builds the 'peak' of the bicep."],
            ["Biceps"]),

        createEx("DB Floor Press", ["Chest"], "Dumbbell", "Strength",
            ["Lie on the floor with DBs.", "Knees bent, feet flat."],
            ["Press DBs up.", "Lower until triceps lightly touch the floor.", "Pause for 1s."],
            ["Don't bounce elbows off the floor.", "Explode up."],
            ["Builds lockout strength.", "Shoulder-safe pressing option."],
            ["Triceps", "Pectorals"]),

        createEx("Renegade Row", ["Back", "Core"], "Dumbbell", "Strength",
            ["Get into high plank position holding DBs on floor.", "Feet wide for balance."],
            ["Row one DB to hip while balancing on the other.", "Alternate sides.", "Keep hips level."],
            ["Fight the rotation of the hips.", "Keep core super tight."],
            ["Full body tension.", "Anti-rotation strength."],
            ["Latissimus Dorsi", "Core", "Obliques"]),

        createEx("DB Step Up", ["Legs"], "Dumbbell", "Strength",
            ["Stand in front of a box or bench.", "Hold DBs at sides."],
            ["Step one foot entirely on the box.", "Drive through the heel to stand up.", "Control the descent."],
            ["Don't push off the bottom leg.", "Keep torso upright."],
            ["Unilateral leg strength.", "Glute focus."],
            ["Glutes", "Quadriceps"]),

        createEx("DB Shrugs", ["Back", "Traps"], "Dumbbell", "Muscle Build",
            ["Hold heavy DBs at sides.", "Stand tall."],
            ["Shrug shoulders straight up to ears.", "Hold for 1s.", "Lower fully."],
            ["Do not roll shoulders.", "Movement is vertical."],
            ["Upper trap size."],
            ["Upper Traps"]),

        createEx("Seated Calf Raise", ["Legs", "Calves"], "Dumbbell", "Muscle Build",
            ["Sit on a bench.", "Place toes on a block/plate.", "Hold heavy DBs vertically on knees."],
            ["Raise heels as high as possible.", "Lower heels to floor for a stretch.", "High reps."],
            ["Targets the soleus muscle.", "Adds width to the calf."],
            ["Soleus"]),

        // ==================== BODYWEIGHT (DETAILED) ====================
        createEx("Push-ups", ["Chest"], "Bodyweight", "Calisthenics",
            ["High plank position.", "Hands directly under shoulders.", "Glutes and core tight."],
            ["Lower chest to floor.", "Elbows at 45 degree angle.", "Push back up to lockout."],
            ["No sagging hips.", "Keep neck neutral."],
            ["Chest endurance.", "Core stability."],
            ["Pectoralis Major", "Triceps", "Core"]),

        createEx("Pull-ups", ["Back"], "Bodyweight", "Calisthenics",
            ["Overhand grip (palms away).", "Hands slightly wider than shoulders.", "Dead hang."],
            ["Pull chin over the bar.", "Drive elbows down.", "Lower under control."],
            ["No kipping/swinging.", "Engage lats first."],
            ["The king of back exercises.", "Builds width."],
            ["Latissimus Dorsi", "Biceps"]),

        createEx("Chin-ups", ["Back"], "Bodyweight", "Calisthenics",
            ["Underhand grip (palms to face).", "Hands shoulder width."],
            ["Pull chest to the bar.", "Squeeze biceps at top.", "Lower fully."],
            ["Easier than pullups.", "Hits biceps harder."],
            ["Arm size.", "Back strength."],
            ["Biceps", "Latissimus Dorsi"]),

        createEx("Dips", ["Chest", "Triceps"], "Bodyweight", "Calisthenics",
            ["Support yourself on parallel bars.", "Shoulders down and back."],
            ["Lower until shoulders are below elbows (90 deg).", "Push back up.", "Lean forward for chest, upright for triceps."],
            ["Don't shrug shoulders.", "Control the descent."],
            ["The squat of the upper body.", "Mass builder."],
            ["Pectoralis Major", "Triceps"]),

        createEx("Bodyweight Squat", ["Legs"], "Bodyweight", "Calisthenics",
            ["Feet shoulder width.", "Arms out for balance."],
            ["Squat deep, hips below knees.", "Keep knees out.", "Stand up."],
            ["Keep heels down.", "Chest up."],
            ["Leg endurance.", "Mobility."],
            ["Quadriceps", "Glutes"]),

        createEx("Lunge (BW)", ["Legs"], "Bodyweight", "Calisthenics",
            ["Step forward.", "Drop back knee to floor.", "Push back to start."],
            ["Keep torso upright.", "Don't let front knee cave in."],
            ["Balance training.", "Leg endurance."],
            ["Quadriceps", "Glutes"]),

        createEx("Glute Bridge", ["Legs", "Glutes"], "Bodyweight", "Calisthenics",
            ["Lie on back.", "Knees bent, feet flat near butt."],
            ["Drive hips to ceiling.", "Squeeze glutes hard at top.", "Lower."],
            ["Don't arch lower back.", "Drive through heels."],
            ["Glute activation.", "Fixes sitting posture."],
            ["Glute Maximus"]),

        createEx("Plank", ["Core"], "Bodyweight", "Calisthenics",
            ["Forearms on floor.", "Toes on floor.", "Body in straight line."],
            ["Hold.", "Squeeze glutes and abs maximally.", "Breathe."],
            ["Don't let hips sag.", "Don't pike butt up."],
            ["Total core stability."],
            ["Transverse Abdominis"]),

        createEx("Side Plank", ["Core"], "Bodyweight", "Calisthenics",
            ["Lie on side.", "Support on one elbow."],
            ["Lift hips off floor.", "Hold straight line.", "Switch sides."],
            ["Don't let hips rotate forward."],
            ["Oblique stability.", "Spine health."],
            ["Obliques", "Quadratus Lumborum"]),

        createEx("Mountain Climbers", ["Core"], "Bodyweight", "Calisthenics",
            ["Pushup position."],
            ["Drive knees to chest alternately.", "Run in place.", "Keep hips low."],
            ["Don't bounce hips up and down.", "Keep shoulders over hands."],
            ["Cardio core.", "Calorie burn."],
            ["Core", "Cardio"]),

        createEx("Burpees", ["Full Body"], "Bodyweight", "Calisthenics",
            ["Stand.", "Drop to chest on floor.", "Jump feet in.", "Jump up clap."],
            ["Explosive movement.", "Full range of motion."],
            ["Pace yourself.", "Land softly."],
            ["Conditioning.", "Metabolic hit."],
            ["Full Body"]),

        createEx("Hanging Leg Raise", ["Core"], "Bodyweight", "Calisthenics",
            ["Hang from bar.", "Body straight."],
            ["Lift legs to L shape (straight legs) or tuck knees.", "Lower slowly.", "Avoid swinging."],
            ["Compress abs.", "Don't use momentum."],
            ["Lower abs.", "Hip flexor strength."],
            ["Rectus Abdominis", "Hip Flexors"]),

        createEx("Pike Push-up", ["Shoulders"], "Bodyweight", "Calisthenics",
            ["Start in pushup position.", "Walk feet in until hips are high (V shape)."],
            ["Lower head towards floor.", "Push back up/back."],
            ["Mimics an overhead press.", "Keep elbows tucked."],
            ["Shoulder strength without weights."],
            ["Deltoids", "Triceps"]),

        createEx("Pistol Squat", ["Legs"], "Bodyweight", "Strength",
            ["Stand on one leg.", "Extend other leg forward.", "Arms out for balance."],
            ["Squat down on standing leg.", "Go as deep as possible.", "Drive back up."],
            ["Keep heel planted.", "Use a box/bench for regression if needed."],
            ["Mastery of leg strength.", "Balance."],
            ["Quadriceps", "Glutes", "Stabilizers"]),

        createEx("Nordic Curl", ["Legs", "Hamstrings"], "Bodyweight", "Strength",
            ["Kneel on pad.", "Anchor feet under something heavy (or partner)."],
            ["Lower torso forward slowly using hamstrings.", "Control the fall as long as possible.", "Catch yourself with hands."],
            ["Push back up to start.", "Keep hips extended (no hinge)."],
            ["Bulletproofs hamstrings.", "Prevents injury."],
            ["Hamstrings"]),

        createEx("Inverted Row", ["Back"], "Bodyweight", "Calisthenics",
            ["Set a bar at waist height.", "Lie under bar.", "Grab wide."],
            ["Pull chest to bar.", "Keep body in straight plank line.", "Lower slow."],
            ["Squeeze shoulder blades together.", "Don't sag hips."],
            ["Horizontal pull.", "Back thickness."],
            ["Latissimus Dorsi", "Rhomboids"]),

        createEx("Handstand Hold", ["Shoulders"], "Bodyweight", "Calisthenics",
            ["Place hands near wall.", "Kick up so heels touch wall.", "Arms locked."],
            ["Push floor away aggressively.", "Squeeze glutes and abs.", "Hold."],
            ["Look between hands.", "Breathe."],
            ["Overhead stability.", "Shoulder strength."],
            ["Deltoids", "Triceps"]),

        createEx("Calf Raise (BW)", ["Legs", "Calves"], "Bodyweight", "Calisthenics",
            ["Stand on edge of step.", "Heels hanging off.", "Hold wall for balance."],
            ["Drive up onto toes.", "Hold squeeze.", "Lower into deep stretch."],
            ["Full range of motion is key.", "Don't bounce."],
            ["Ankle strength.", "Calf size."],
            ["Gastrocnemius"]),

        // ==================== MOBILITY & WARMUP (DETAILED) ====================
        createEx("Cat-Cow", ["Core"], "Bodyweight", "Mobility",
            ["Start on hands and knees (Tabletop).", "Neutral spine."],
            ["Arch back up towards ceiling (Cat) and exhale.", "Sag belly down towards floor (Cow) and inhale.", "Look up."],
            ["Move with your breath.", "Articulate each vertebrae."],
            ["Spine health.", "Warmup."],
            ["Spine"]),

        createEx("Dead Bug", ["Core"], "Bodyweight", "Mobility",
            ["Lie on back.", "Arms and legs in air (90 degrees).", "Back flat on floor."],
            ["Lower opposite arm and leg towards floor.", "Keep lower back glued to floor.", "Return."],
            ["If back arches, don't go as low.", "Breathe out as you extend."],
            ["Core control.", "Anti-extension."],
            ["Core", "Hip Flexors"]),

        createEx("Thoracic Extension", ["Back"], "Bodyweight", "Mobility",
            ["Place foam roller on upper back.", "Hips on floor."],
            ["Lean back over roller.", "Hands behind head for support.", "Open chest."],
            ["Relax into the stretch.", "Move roller up/down spine."],
            ["Fixes desk posture.", "Shoulder mobility."],
            ["Thoracic Spine"]),

        createEx("World's Greatest Stretch", ["Full Body"], "Bodyweight", "Mobility", 
            ["Start in a high plank position.", "Step left foot outside left hand.", "Keep back leg straight and strong."],
            ["Rotate left arm up to ceiling, looking at hand.", "Bring elbow down toward floor inside foot.", "Switch sides."],
            ["Move slowly and deliberately.", "Breathe deep into the tight spots."],
            ["Opens hips, t-spine, and ankles.", "The ultimate warmup."],
            ["Hips", "Thoracic Spine", "Hamstrings"]),

        createEx("90/90 Hip Switch", ["Legs"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Front leg bent 90¬∞ in front, back leg 90¬∞ to side.", "Torso upright."],
            ["Rotate hips to switch leg positions to the other side.", "Keep heels driven into the floor.", "Try not to use hands for support."],
            ["Stay tall through the spine.", "Move from the hips, not the lower back."],
            ["Internal and external hip rotation.", "Unlocks tight hips."],
            ["Glutes", "Hip Rotators"]),

        createEx("Shoulder Dislocates", ["Shoulders"], "Bodyweight", "Mobility", 
            ["Hold a broomstick or band with a very wide grip.", "Arms straight."],
            ["Raise arms over head and behind back.", "Touch lower back/glutes.", "Return over head to front."],
            ["Do not bend elbows.", "Shrug shoulders at the top if needed."],
            ["Shoulder girdle mobility.", "Chest opener."],
            ["Shoulders", "Pecs"]),

        createEx("Wall Slides", ["Shoulders"], "Bodyweight", "Mobility", 
            ["Stand with back against a wall.", "Feet 6 inches away.", "Press lower back, head, elbows, and wrists into wall."],
            ["Slide arms up into a 'W' then 'Y' shape.", "Maintain contact with wall at all times.", "Slide back down."],
            ["Don't let lower back arch.", "Tuck chin."],
            ["Scapular control.", "Posture correction."],
            ["Lower Traps", "External Rotators"]),

        createEx("Deep Squat Hold", ["Legs"], "Bodyweight", "Mobility", 
            ["Stand shoulder width.", "Hold a weight plate for counterbalance if needed."],
            ["Squat as deep as anatomically possible.", "Keep heels flat.", "Chest up."],
            ["Hold for 30-60 seconds.", "Use elbows to push knees out."],
            ["Ankle mobility.", "Hip opening."],
            ["Hips", "Ankles"]),

        createEx("Couch Stretch", ["Legs"], "Bodyweight", "Mobility", 
            ["Place knee against base of a wall/couch.", "Shin vertical up the wall.", "Other foot lunges forward."],
            ["Squeeze glute of the back leg.", "Raise torso upright.", "Hold."],
            ["Don't hyperextend lower back.", "Squeeze abs."],
            ["Fixes tight hip flexors from sitting.", "Quad stretch."],
            ["Hip Flexors", "Quads"]),

        createEx("Bird Dog", ["Core"], "Bodyweight", "Mobility", 
            ["Start on hands and knees (Tabletop).", "Neutral spine."],
            ["Reach opposite arm and leg straight out.", "Hold for 3s.", "Switch sides."],
            ["Imagine balancing a glass of water on your back.", "Don't rotate hips."],
            ["Core stability.", "Anti-rotation."],
            ["Core", "Glutes", "Shoulders"]),

        // ==================== CABLE VARIATIONS (TORQUE F9 DETAILED) ====================
        createEx("Cable Front Squat", ["Legs"], "Cable", "Strength", 
            ["Set Pulleys Low. Arms Narrow.", "Hold bar/handles at collarbone (rack position).", "Elbows high."],
            ["Squat deep.", "Keep torso vertical.", "Drive up."],
            ["Core works hard to stay upright.", "Fight the pull forward."],
            ["Quad dominance.", "Core strength."],
            ["Quadriceps", "Core"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Zercher Squat", ["Legs"], "Cable", "Strength", 
            ["Set Pulleys Low. Arms Narrow.", "Hold straight bar in crooks of elbows.", "Hands clasped."],
            ["Squat down.", "Keep bar close to body.", "Drive up."],
            ["Brutal on core and upper back.", "Bicep isometric."],
            ["Upper back strength.", "Leg drive."],
            ["Quadriceps", "Upper Back"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Donkey Kick", ["Legs", "Glutes"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Ankle strap.", "Hands on machine for support.", "Bent over."],
            ["Keep knee bent 90¬∞.", "Drive heel up to ceiling.", "Squeeze."],
            ["Don't extend knee.", "Movement comes from hip."],
            ["Upper glute focus.", "Shelf builder."],
            ["Glute Maximus"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Standing Cable Row", ["Back"], "Cable", "Strength", 
            ["Set Pulleys Mid. Arms Mid.", "Squat stance.", "Reach forward."],
            ["Row handles to ribs.", "Stand up slightly as you pull (dynamic).", "Sink back on return."],
            ["Use legs to stabilize.", "Fluid motion."],
            ["Functional pulling.", "Athleticism."],
            ["Latissimus Dorsi", "Legs", "Core"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Lying Cable Curl", ["Arms", "Biceps"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short Bar.", "Lie on back.", "Feet braced on machine."],
            ["Curl bar to forehead/chin.", "Keep elbows fixed.", "Lower."],
            ["Strict isolation.", "No cheating."],
            ["Bicep peaks.", "Form strictness."],
            ["Biceps"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable French Press", ["Arms", "Triceps"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Rope/Bar.", "Bench/Kneel facing away.", "Arms overhead."],
            ["Bend elbows to lower weight behind head.", "Extend to ceiling.", "Keep elbows close."],
            ["Deep stretch.", "Long head focus."],
            ["Tricep size.", "Overhead strength."],
            ["Triceps (Long Head)"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Hip Abduction (Standing)", ["Legs"], "Cable", "Mobility", 
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Outer leg attached."],
            ["Lift leg out to side.", "Keep toes forward.", "Return."],
            ["Don't lean away.", "Use glute medius."],
            ["Hip stability.", "Glute shape."],
            ["Glute Medius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Hip Adduction (Standing)", ["Legs"], "Cable", "Mobility", 
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Inner leg attached."],
            ["Pull leg across body.", "Squeeze inner thigh.", "Return."],
            ["Balance on outer leg."],
            ["Adductor strength.", "Injury prevention."],
            ["Adductors"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Wrist Curl", ["Arms"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short bar.", "Sit on bench/floor.", "Forearms on knees."],
            ["Curl wrists up.", "Squeeze.", "Lower."],
            ["Range of motion is small."],
            ["Forearm size.", "Grip."],
            ["Flexors"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Reverse Wrist Curl", ["Arms"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short bar.", "Palms facing down."],
            ["Extend wrists up.", "Hold.", "Lower."],
            ["Burn is high."],
            ["Top of forearm.", "Elbow health."],
            ["Extensors"], {arms: "Narrow", pulleys: "Low"}),

        // ==================== PART 3: CARDIO, CORE & VARIATIONS (FINAL 40) ====================
        
        // --- ABS & CORE ---
        createEx("Russian Twist", ["Core"], "Bodyweight", "Calisthenics", 
            ["Sit on floor.", "Lean back 45 deg.", "Feet off floor."],
            ["Rotate torso left.", "Touch floor.", "Rotate right."],
            ["Control the twist.", "Oblique focus."],
            ["Rotational core strength."],
            ["Obliques"]),
        createEx("Bicycle Crunch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Hands behind head."],
            ["Elbow to opposite knee.", "Extend other leg."],
            ["Slow and controlled.", "Don't pull neck."],
            ["Full abdominal wall."],
            ["Rectus Abdominis", "Obliques"]),
        createEx("Flutter Kicks", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Hands under butt.", "Legs straight."],
            ["Kick legs up and down.", "Keep lower back pressed down."],
            ["Small range of motion."],
            ["Lower abs endurance."],
            ["Lower Abs"]),
        createEx("V-Ups", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Arms overhead."],
            ["Lift arms and legs to touch toes.", "Body forms V."],
            ["Explosive up.", "Control down."],
            ["Advanced core strength."],
            ["Rectus Abdominis"]),
        createEx("Reverse Crunch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "Knees bent 90 deg."],
            ["Curl hips off floor.", "Knees to chest.", "Lower."],
            ["Don't use momentum.", "Focus on hips curling."],
            ["Lower ab isolation."],
            ["Lower Abs"]),
        createEx("Plank Jack", ["Core", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Plank position."],
            ["Jump feet wide.", "Jump feet together."],
            ["Keep hips level."],
            ["Core conditioning."],
            ["Core"]),
        createEx("Toe Touch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "Legs straight up."],
            ["Crunch up to touch toes.", "Lower."],
            ["Keep legs vertical."],
            ["Upper abs."],
            ["Upper Abs"]),

        // --- PUSHUP VARIATIONS ---
        createEx("Diamond Push-up", ["Arms", "Chest"], "Bodyweight", "Calisthenics", 
            ["Hands form diamond shape.", "Under sternum."],
            ["Lower chest to hands.", "Push up."],
            ["Keep elbows tucked."],
            ["Tricep mass."],
            ["Triceps", "Inner Chest"]),
        createEx("Wide Grip Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Hands wider than shoulders."],
            ["Lower down.", "Push up."],
            ["Less tricep, more chest."],
            ["Outer chest."],
            ["Pectoralis Major"]),
        createEx("Decline Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Feet on bench/chair.", "Hands on floor."],
            ["Push up motion."],
            ["Harder variation."],
            ["Upper chest focus."],
            ["Upper Pecs"]),
        createEx("Incline Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Hands on bench.", "Feet on floor."],
            ["Push up motion."],
            ["Easier variation."],
            ["Lower chest."],
            ["Lower Pecs"]),
        createEx("Scapular Push-up", ["Back", "Shoulders"], "Bodyweight", "Mobility", 
            ["Plank position.", "Arms locked straight."],
            ["Squeeze shoulder blades together.", "Push them apart."],
            ["Tiny range of motion.", "Straight arms."],
            ["Shoulder health."],
            ["Serratus Anterior"]),

        // --- LEG VARIATIONS ---
        createEx("Sumo Squat (DB)", ["Legs"], "Dumbbell", "Strength", 
            ["Wide stance.", "Toes out.", "Hold DB between legs."],
            ["Squat deep.", "Knees track over toes."],
            ["Upright torso."],
            ["Inner thigh focus."],
            ["Adductors", "Quads"]),
        createEx("Curtsy Lunge", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Stand tall."],
            ["Step leg behind and across.", "Lunge down."],
            ["Hip stability."],
            ["Glute medius."],
            ["Glutes"]),
        createEx("Side Lunge", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Step wide to side.", "Keep other leg straight."],
            ["Sit hips back on bent leg.", "Return."],
            ["Inner thigh stretch."],
            ["Lateral movement."],
            ["Adductors", "Quads"]),
        createEx("Single Leg Glute Bridge", ["Legs", "Glutes"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "One leg up.", "One foot flat."],
            ["Drive hip up.", "Squeeze glute.", "Lower."],
            ["Don't twist hips."],
            ["Glute isolation."],
            ["Glutes"]),
        createEx("Good Morning (BW)", ["Legs"], "Bodyweight", "Mobility", 
            ["Hands behind head.", "Knees soft."],
            ["Hinge hips back.", "Back flat.", "Stand up."],
            ["Feel hamstring stretch."],
            ["Hinge pattern practice."],
            ["Hamstrings", "Lower Back"]),

        // --- CARDIO & PLYO ---
        createEx("Jumping Jacks", ["Cardio"], "Bodyweight", "Calisthenics", 
            ["Stand tall."],
            ["Jump feet wide, hands up.", "Jump back."],
            ["Rhythmic."],
            ["Warmup."],
            ["Full Body"]),
        createEx("High Knees", ["Cardio"], "Bodyweight", "Calisthenics", 
            ["Run in place."],
            ["Drive knees to waist height."],
            ["Fast pace."],
            ["Heart rate."],
            ["Legs", "Cardio"]),
        createEx("Jump Squat", ["Legs", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Squat down."],
            ["Explode up.", "Jump off floor.", "Land soft."],
            ["Power."],
            ["Leg power."],
            ["Quads"]),
        createEx("Skater Hops", ["Cardio", "Legs"], "Bodyweight", "Calisthenics", 
            ["Hop sideways to one foot.", "Swing other leg behind."],
            ["Explode back to other side."],
            ["Lateral power."],
            ["Athleticism."],
            ["Glutes", "Cardio"]),
        createEx("Jumping Lunge", ["Legs", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Lunge position."],
            ["Jump and switch legs in air.", "Land in lunge."],
            ["Advanced."],
            ["Leg burn."],
            ["Quads", "Cardio"]),
        createEx("Box Jump", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Stand before box."],
            ["Jump onto box.", "Stand tall.", "Step down."],
            ["Explosive hips."],
            ["Power."],
            ["Quads", "Glutes"]),

        // --- BACK & ARM VARIATIONS ---
        createEx("Superman", ["Back"], "Bodyweight", "Calisthenics", 
            ["Lie on stomach.", "Arms forward."],
            ["Lift arms and legs off floor.", "Hold.", "Lower."],
            ["Squeeze lower back."],
            ["Posterior chain."],
            ["Lower Back", "Glutes"]),
        createEx("Swimmers", ["Back"], "Bodyweight", "Calisthenics", 
            ["Lie on stomach."],
            ["Paddle opposite arm/leg up and down."],
            ["Keep off floor."],
            ["Endurance."],
            ["Lower Back"]),
        createEx("Bench Dip", ["Arms", "Triceps"], "Bodyweight", "Calisthenics", 
            ["Hands on bench behind you.", "Legs straight out."],
            ["Lower hips.", "Push up."],
            ["Don't go too deep."],
            ["Tricep burnout."],
            ["Triceps"]),
        createEx("Close Grip Push-up", ["Arms", "Triceps"], "Bodyweight", "Calisthenics", 
            ["Hands inside shoulder width."],
            ["Elbows rub ribs.", "Push up."],
            ["Tricep focus."],
            ["Arm size."],
            ["Triceps"]),
        createEx("Plate Pinch", ["Arms"], "Free Weight", "Strength", 
            ["Hold weight plates in fingertips."],
            ["Walk or hold for time."],
            ["Don't use thumbs if possible."],
            ["Forearm strength."],
            ["Forearms"]),
        createEx("Svend Press", ["Chest"], "Free Weight", "Strength", 
            ["Stand.", "Squeeze plate between palms at chest."],
            ["Press out.", "Keep squeezing hard.", "Return."],
            ["Inner chest activation."],
            ["Isometric squeeze."],
            ["Inner Pecs"]),
        
        // --- FINAL CABLE VARIATIONS ---
        createEx("Cable Curl (Behind Back)", ["Arms", "Biceps"], "Cable", "Muscle Build", 
            ["Set Low. Face away.", "One hand handle."],
            ["Arm behind body.", "Curl forward."],
            ["Stretch focus."],
            ["Bicep length."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),
        createEx("Cable Row (Wide Grip)", ["Back"], "Cable", "Strength", 
            ["Set Low. Wide bar.", "Sit."],
            ["Row to upper abs.", "Elbows wide."],
            ["Upper back focus."],
            ["Width."],
            ["Rear Delts", "Rhomboids"], {arms: "Narrow", pulleys: "Low"}),
        createEx("Standing Cable Crunch", ["Core"], "Cable", "Muscle Build", 
            ["Set High. Rope.", "Face away."],
            ["Crunch forward.", "Elbows to chest."],
            ["Standing abs."],
            ["Core."],
            ["Abs"], {arms: "Narrow", pulleys: "Top"}),
        // ==================== NIMBLE / LONGEVITY / FLOW (NEW 25) ====================
        
        // --- ANIMAL FLOW & GROUND ---
        createEx("Bear Crawl", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Hands and knees.", "Knees hover 1 inch off floor."], ["Crawl forward opposite hand/foot.", "Keep back flat."], ["Imagine a glass of water on your back."], ["Shoulder stability.", "Core."], ["Core", "Shoulders"]),
        createEx("Crab Walk", ["Nimble", "Shoulders"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Hands behind hips.", "Lift hips."], ["Walk backwards/forwards."], ["Open chest.", "Squeeze glutes."], ["Posterior chain.", "Shoulder mobility."], ["Triceps", "Glutes"]),
        createEx("Kick Through", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Bear crawl position."], ["Rotate hips.", "Kick leg through to side.", "Lift opposite hand."], ["Pivot on foot."], ["Rotational agility."], ["Obliques", "Hips"]),
        createEx("Beast Reach", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Loaded Beast (Child's pose but knees off floor)."], ["Wave forward into plank.", "Drive one knee to elbow.", "Return."], ["Flow smoothly."], ["Spine wave."], ["Spine", "Core"]),
        createEx("Duck Walk", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Deep squat position."], ["Walk forward staying low."], ["Keep chest up.", "Heels can lift."], ["Ankle mobility.", "Hip strength."], ["Quads", "Ankles"]),

        // --- JOINT BULLETPROOFING ---
        createEx("Tibialis Raise", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Lean butt against wall.", "Legs straight out."], ["Lift toes to shins.", "Lower."], ["Feel burn in shins."], ["Bulletproof knees.", "Shin splint help."], ["Tibialis Anterior"]),
        createEx("ATG Split Squat", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Long lunge stance."], ["Push front knee WAY over toe.", "Back leg straight."], ["Cover calf with hamstring."], ["Ankle/Hip mobility."], ["VMO", "Hip Flexors"]),
        createEx("Lu Raise", ["Nimble", "Shoulders"], "Dumbbell", "Mobility", 
            ["Light plates/DBs.", "Stand tall."], ["Lateral raise ALL the way overhead.", "Touch plates at top."], ["Control down."], ["Full scapular movement."], ["Side Delts", "Traps"]),
        createEx("Powell Raise", ["Nimble", "Shoulders"], "Dumbbell", "Strength", 
            ["Lie on side.", "Top arm holds DB."], ["Raise straight arm to vertical."], ["Control down across chest."], ["Scapular health."], ["Rear Delts", "Rhomboids"]),
        createEx("Wrist Rocks", ["Nimble", "Arms"], "Bodyweight", "Mobility", 
            ["Hands and knees.", "Fingers forward/back/side."], ["Rock weight gently over wrists."], ["Elbows locked."], ["Wrist prep for pushups."], ["Forearms"]),
        createEx("Dead Hang", ["Nimble", "Back"], "Bodyweight", "Strength", 
            ["Grab pullup bar."], ["Hang completely loose.", "Relax shoulders."], ["Deep breaths."], ["Spine decompression.", "Grip."], ["Lats", "Forearms"]),

        // --- DYNAMIC MOBILITY ---
        createEx("Cossack Squat", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Wide stance.", "Toes out."], ["Squat to ONE side.", "Other leg straight, toe up."], ["Stay low, switch sides."], ["Hip mobility.", "Groin."], ["Adductors", "Quads"]),
        createEx("Jefferson Curl", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Stand tall.", "Hold light weight (optional)."], ["Tuck chin.", "Roll down one vertebrae at a time.", "Reach floor."], ["Roll up slow."], ["Spine articulation."], ["Spine", "Hamstrings"]),
        createEx("Scorpion Stretch", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Lie on stomach.", "Arms wide."], ["Kick one leg up and over to opposite hand."], ["Touch floor."], ["Dynamic hip/spine twist."], ["Hips", "Spine"]),
        createEx("Inchworm", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Stand.", "Hinge to floor."], ["Walk hands out to plank.", "Walk feet to hands."], ["Keep legs straight."], ["Hamstring stretch."], ["Hamstrings", "Shoulders"]),
        createEx("Thoracic Bridge", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Hands behind."], ["Drive hips up.", "Reach one arm overhead and across."], ["Look at hand."], ["T-Spine opener."], ["Spine", "Glutes"]),

        // --- AGILITY & PROPRIOCEPTION ---
        createEx("Single Leg RDL (BW)", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Stand on one leg."], ["Hinge forward.", "Extend back leg straight."], ["Body creates 'T' shape.", "Return."], ["Balance.", "Hamstring."], ["Hamstrings", "Glutes"]),
        createEx("Lateral Bounds", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Stand on right leg."], ["Jump laterally to left leg.", "Stick the landing."], ["Pause.", "Jump back."], ["Lateral power.", "Stability."], ["Glutes", "Adductors"]),
        createEx("Dot Drill", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Imagine 5 dots (dice 5)."], ["Hop feet between dots fast."], ["pattern variations."], ["Fast feet."], ["Calves", "Coordination"]),
        createEx("Tuck Jumps", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Stand tall."], ["Jump high.", "Tuck knees to chest."], ["Land soft.", "Repeat fast."], ["Explosive power."], ["Quads", "Core"]),
        createEx("A-Skips", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Skip forward."], ["Drive knee high.", "Drive opposite arm."], ["Rhythm and bounce."], ["Sprinting mechanics."], ["Hip Flexors", "Calves"]),

        // --- ISOMETRIC & TENDON ---
        createEx("Horse Stance Hold", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Wide stance.", "Squat until thighs parallel."], ["Back vertical.", "Knees out."], ["Hold for time."], ["Mental toughness.", "Hips."], ["Quads", "Adductors"]),
        createEx("Reverse Plank", ["Nimble", "Core"], "Bodyweight", "Strength", 
            ["Sit legs straight.", "Hands behind hips."], ["Drive hips to ceiling.", "Straight line."], ["Squeeze glutes."], ["Posterior chain."], ["Lower Back", "Glutes"]),
        createEx("Copenhagen Plank", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Side plank.", "Top leg on bench.", "Bottom leg floating."], ["Hold."], ["Brutal inner thigh work."], ["Groin health."], ["Adductors"]),
        createEx("L-Sit (Tuck)", ["Nimble", "Core"], "Bodyweight", "Calisthenics", 
            ["Hands on floor/parallettes."], ["Press down.", "Lift butt and knees off floor."], ["Hold tuck."], ["Core compression."], ["Abs", "Hip Flexors"])
    ];
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// NIMBLE ENGINE V42 (Planner, Coach, Analytics) - SAFE MODE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// STATE & SETTINGS
let activeRoutine = [];
let userSettings = JSON.parse(localStorage.getItem('nimbleSettings')) || { 
    hotelMode: false, 
    currentPhase: 1, // 1=Vol, 2=Str, 3=Pow, 4=Deload
    schedule: { 0:'Rest', 1:'Push', 2:'Pull', 3:'Legs', 4:'Nimble', 5:'Rest', 6:'Full' } // 0=Sun
};
let pendingFood = null; 

// INITIALIZATION
document.addEventListener('DOMContentLoaded', () => {
    // 1. FORCE HIDE THE LOADING SCREEN (This fixes the "Stuck" issue)
    const loader = document.getElementById('sync-loader');
    if(loader) {
        loader.style.opacity = '0';
        setTimeout(() => loader.style.display = 'none', 500);
    }

    // 2. Setup Planner
    if(document.getElementById('view-plan')) renderPlanner();
    
    // 3. Auto-load Heatmap
    if(!document.getElementById('view-progress').classList.contains('hidden')) renderHeatmap();
});

// --- NAVIGATION LOGIC (Fixed) ---
function switchTab(id) {
    // 1. Hide all views
    document.querySelectorAll('.container').forEach(d => d.classList.add('hidden'));
    document.querySelectorAll('.container').forEach(d => d.classList.remove('active')); 

    // 2. Map buttons to the correct Screen ID
    let targetId = 'view-' + id;
    
    // Special Mappings
    if (id === 'readiness') targetId = 'view-readiness';
    if (id === 'coach') targetId = 'view-coach'; 
    if (id === 'plan') targetId = 'view-plan';   
    if (id === 'food') targetId = 'view-food';
    if (id === 'wellness') targetId = 'view-wellness';
    if (id === 'progress') targetId = 'view-progress';

    // 3. Show the target view
    const target = document.getElementById(targetId);
    if (target) {
        target.classList.remove('hidden');
        target.classList.add('active');
        
        // Trigger special renders
        if (targetId === 'view-plan') renderPlanner();
        if (targetId === 'view-progress') renderHeatmap();
    } else {
        console.warn("View not found:", targetId);
    }

    // 4. Update Bottom Navigation Styling (Targeting .nav-btn)
    document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
    
    const activeBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn => 
        btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(`'${id}'`)
    );
    if (activeBtn) activeBtn.classList.add('active');
}

    // 4. Update Bottom Navigation Styling (Targeting .nav-btn now)
    document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
    
    const activeBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn => 
        btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(`'${id}'`)
    );
    if (activeBtn) activeBtn.classList.add('active');
}

    // 4. Update the Bottom Navigation Styling (Visual Feedback)
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    // Find the button you just clicked and make it "Active"
    // We look for the onclick attribute that contains the ID you passed
    const activeBtn = Array.from(document.querySelectorAll('.nav-item')).find(btn => 
        btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(`'${id}'`)
    );
    if (activeBtn) activeBtn.classList.add('active');
}

 

// --- FEATURE 1, 2, 3: PLANNER LOGIC ---
function renderPlanner() {
    const grid = document.getElementById('week-grid');
    if(!grid) return;
    grid.innerHTML = '';
    const days = ['S','M','T','W','T','F','S'];
    const today = new Date().getDay();
    days.forEach((d, i) => {
        const type = userSettings.schedule[i] || 'Rest';
        const isToday = i === today ? 'active' : '';
        grid.innerHTML += `
            <div class="day-bubble ${isToday}" onclick="setSchedule(${i})">
                <b>${d}</b>
                <span style="font-size:0.5em; text-transform:uppercase;">${type.substring(0,3)}</span>
            </div>
        `;
    });
    const phases = ["1: Volume (12-15)", "2: Strength (6-8)", "3: Power (3-5)", "4: Deload (Flow)"];
    const phaseLabel = document.getElementById('cycle-phase');
    if(phaseLabel) phaseLabel.innerText = phases[userSettings.currentPhase - 1];
}

function setSchedule(dayIdx) {
    const types = ['Rest', 'Push', 'Pull', 'Legs', 'Nimble', 'Full', 'Cardio'];
    let current = userSettings.schedule[dayIdx] || 'Rest';
    let nextIdx = (types.indexOf(current) + 1) % types.length;
    userSettings.schedule[dayIdx] = types[nextIdx];
    localStorage.setItem('nimbleSettings', JSON.stringify(userSettings));
    renderPlanner();
}

function nextPhase() {
    userSettings.currentPhase = (userSettings.currentPhase % 4) + 1;
    localStorage.setItem('nimbleSettings', JSON.stringify(userSettings));
    renderPlanner();
}

// --- COMPATIBILITY: OLD HOME SCREEN BUTTONS ---
// This ensures your "Push", "Pull" buttons on the home screen still work!
function generateWorkout(type) {
    // Redirect to the new robust filter engine
    if(type === 'Full Body') type = 'Full'; // Fix naming mismatch
    
    generateWorkoutByFilter(e => {
        if(type === 'Full') return true;
        if(type === 'Nimble') return e.cat.includes('Nimble') || e.type === 'Mobility';
        return e.cat.includes(type) || e.type === type;
    });
}

function generateWorkoutByFilter(filterFn) {
    let pool = allExercises.filter(filterFn);
    if(userSettings.hotelMode) {
        pool = pool.filter(e => !e.name.includes('Barbell') && !e.name.includes('Cable') && !e.name.includes('Machine'));
    }
    if(pool.length === 0) return alert("No exercises found.");

    activeRoutine = pool.sort(() => 0.5 - Math.random()).slice(0, 6);
    renderWorkout(activeRoutine);
    
    document.getElementById('setup-panel').style.display = 'none';
    document.getElementById('workout-interface').style.display = 'block';
}

function toggleHotelMode() {
    userSettings.hotelMode = !userSettings.hotelMode;
    localStorage.setItem('nimbleSettings', JSON.stringify(userSettings));
    alert(userSettings.hotelMode ? "üè® Hotel Mode: Equipment Limited" : "üèãÔ∏è Full Gym Mode");
}

// --- CORE: RENDER CARDS (With Sparklines & Coaching) ---
function renderWorkout(exercises) {
    const list = document.getElementById('workout-list');
    list.innerHTML = '';
    const history = JSON.parse(localStorage.getItem('nimbleHistory')) || [];
    const targets = {1: '12-15', 2: '8-10', 3: '3-5', 4: 'Flow'};
    const phaseTarget = targets[userSettings.currentPhase];

    exercises.forEach((ex, i) => {
        const logs = history.filter(h => h.name === ex.name).sort((a,b) => new Date(a.date) - new Date(b.date)).slice(-5);
        let sparkHTML = '';
        if(logs.length > 1) {
             const points = logs.map((l, idx) => `${idx * 20},${30 - (l.weight/300)*30}`).join(' ');
             sparkHTML = `<svg class="sparkline-container"><polyline points="${points}" fill="none" stroke="var(--gold)" stroke-width="2"/></svg>`;
        }
        const lastLog = logs[logs.length-1];
        let placeholder = lastLog ? `${lastLog.weight}x${lastLog.reps}` : phaseTarget;
        const tempo = ex.type === 'Strength' ? (userSettings.currentPhase === 1 ? '3-0-1-0' : 'Explosive') : 'Flow';

        const div = document.createElement('div');
        div.className = `card exercise-card ${ex.type}`;
        div.innerHTML = `
            <div class="exercise-header">
                <div style="display:flex; align-items:center;">
                    <strong>${ex.name}</strong>
                    <span class="swap-btn" onclick="swapExercise(${i}, '${ex.type}')">üîÑ Swap</span>
                </div>
                <div style="font-size:0.7em; color:var(--primary)">Tempo: ${tempo}</div>
            </div>
            <div style="display:flex; justify-content:space-between; margin:5px 0;">
                <small style="color:#aaa;">Target: ${phaseTarget} reps</small>
                ${lastLog ? `<small>Ghost: ${lastLog.weight}x${lastLog.reps}</small>` : ''}
            </div>
            ${sparkHTML}
            <div class="row">
                <div style="flex:1"><input type="number" id="w-${i}" placeholder="Lbs" oninput="showPlates(this.value)"></div>
                <div style="flex:1"><input type="number" id="r-${i}" placeholder="${placeholder}"></div>
            </div>
            <div style="display:flex; align-items:center; gap:10px; margin-top:10px;">
                <span style="font-size:0.7em">RPE:</span>
                <input type="range" id="rpe-${i}" min="1" max="10" value="7" class="rpe-slider">
                <span id="rpe-val-${i}" style="font-size:0.7em">7</span>
            </div>
            <button class="btn btn-action" onclick="logSet('${ex.name}', ${i})">‚úÖ Log Set</button>
        `;
        list.appendChild(div);
        document.getElementById(`rpe-${i}`).oninput = function() { document.getElementById(`rpe-val-${i}`).innerText = this.value; };
    });
}

function swapExercise(idx, type) {
    const alts = allExercises.filter(e => e.type === type && e.name !== activeRoutine[idx].name);
    if(alts.length > 0) {
        const newEx = alts[Math.floor(Math.random() * alts.length)];
        activeRoutine[idx] = newEx;
        renderWorkout(activeRoutine);
    } else { alert("No alternatives found."); }
}

function showPlates(weight) {
    const w = parseFloat(weight);
    if(w < 45) return;
    let perSide = (w - 45) / 2;
    let html = '';
    [45, 35, 25, 10, 5, 2.5].forEach(plate => {
        while(perSide >= plate) {
            html += `<div class="plate p-${Math.floor(plate)}"></div>`;
            perSide -= plate;
        }
    });
    const popup = document.getElementById('plate-helper');
    if(popup) {
        popup.innerHTML = html || '<span style="color:#fff; font-size:0.8em">Bar Only</span>';
        popup.classList.remove('hidden');
        setTimeout(() => popup.classList.add('hidden'), 3000);
    }
}

// --- LOGGING & SAFETY ---
function logSet(name, idx) {
    const w = parseFloat(document.getElementById(`w-${idx}`).value);
    const r = parseInt(document.getElementById(`r-${idx}`).value);
    const rpe = parseInt(document.getElementById(`rpe-${idx}`).value);
    
    if (isNaN(w) || isNaN(r)) return; // Silent validation

    const e1rm = w * (1 + r/30);
    if(e1rm > 225) triggerConfetti(); 

    const entry = { date: new Date().toISOString(), name, weight: w, reps: r, rpe, phase: userSettings.currentPhase };
    
    let h = JSON.parse(localStorage.getItem('nimbleHistory')) || [];
    h.push(entry);
    localStorage.setItem('nimbleHistory', JSON.stringify(h));
    
    sendToCloud("workout", entry); // Safe cloud sync

    const btn = document.activeElement;
    btn.style.backgroundColor = "var(--success)";
    btn.innerText = "Saved!";
    setTimeout(() => { btn.innerText = "‚úÖ Log Set"; btn.style.backgroundColor = ""; }, 1500);
    
    startTimer(90);
    if ('speechSynthesis' in window) {
        const msg = new SpeechSynthesisUtterance("Good set.");
        window.speechSynthesis.speak(msg);
    }
}

function triggerConfetti() {
    for(let i=0; i<30; i++) {
        const c = document.createElement('div');
        c.className = 'confetti';
        c.style.left = Math.random()*100 + 'vw';
        c.style.backgroundColor = ['#f00','#0f0','#00f','#ff0'][Math.floor(Math.random()*4)];
        c.style.animationDuration = (Math.random()*2+2) + 's';
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 4000);
    }
}

function startBreathWork() { document.getElementById('breath-modal').style.display = 'flex'; }

// --- TIMER (Preserved) ---
function startTimer(s) {
    const overlay = document.getElementById('timer-overlay');
    if(overlay) {
        overlay.classList.remove('hidden');
        let t = s;
        const disp = document.getElementById('timer-display');
        if(disp) disp.innerText = formatTime(t);
        if(window.timerInterval) clearInterval(window.timerInterval);
        window.timerInterval = setInterval(()=>{ 
            t--; 
            if(disp) disp.innerText = formatTime(t); 
            if(t<=0) closeTimer(); 
        }, 1000);
    }
}
function closeTimer() {
    const overlay = document.getElementById('timer-overlay');
    if(overlay) overlay.classList.add('hidden');
    if(window.timerInterval) clearInterval(window.timerInterval);
}
function formatTime(s) { return s < 60 ? s : Math.floor(s/60) + ":" + (s%60 < 10 ? '0' : '') + (s%60); }
function addTime(s) { 
    const disp = document.getElementById('timer-display');
    if(disp) {
        let curr = disp.innerText;
        let sec = curr.includes(":") ? parseInt(curr.split(":")[0])*60 + parseInt(curr.split(":")[1]) : parseInt(curr);
        startTimer(sec + s); 
    }
}

// --- CLOUD & OFFLINE SAFETY (Preserved) ---
function sendToCloud(type, data) {
    if (!navigator.onLine) { queueOffline(type, data); return; }
    fetch("YOUR_GOOGLE_SCRIPT_URL", { // Make sure your URL is here if you have one
        method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ type, data })
    }).catch(e => queueOffline(type, data));
}
function queueOffline(type, data) {
    let q = JSON.parse(localStorage.getItem('nimbleQueue')) || [];
    q.push({ type, data, time: Date.now() });
    localStorage.setItem('nimbleQueue', JSON.stringify(q));
    console.log("Saved offline (Silent)");
}

// --- HEATMAP & ANALYTICS ---
function renderHeatmap() {
    const grid = document.getElementById('view-progress');
    if(!grid) return;
    if(!grid.innerHTML.includes('Command Center')) {
        grid.innerHTML = `
            <h2>Command Center</h2>
            <div class="card">
                <h3>üé® App Theme</h3>
                <div class="chip-container">
                    <div class="chip" onclick="setTheme('cyber')">Cyber</div>
                    <div class="chip" onclick="setTheme('tactical')">Tactical</div>
                </div>
            </div>
            <div class="card"><h3>üî• Training Heatmap</h3><p style="color:#aaa;">Visualize your frequency here.</p></div>
            <button class="btn btn-action" onclick="exportData()">‚¨áÔ∏è Export Data</button>
        `;
    }
}
function setTheme(name) {
    const r = document.querySelector(':root');
    if(name === 'cyber') { r.style.setProperty('--bg', '#121212'); r.style.setProperty('--primary', '#BB86FC'); }
    if(name === 'tactical') { r.style.setProperty('--bg', '#0d1117'); r.style.setProperty('--primary', '#58a6ff'); }
    localStorage.setItem('nimbleTheme', name);
}
function exportData() {
    const h = JSON.parse(localStorage.getItem('nimbleHistory')) || [];
    let text = "NIMBLE SHRED REPORT\n\n";
    h.slice(-20).forEach(l => { text += `${l.date.split('T')[0]}: ${l.name} - ${l.weight}x${l.reps} @ RPE ${l.rpe || '-'}\n`; });
    alert("Data copied to clipboard!");
    navigator.clipboard.writeText(text);
}
function openFoodModal(food) {
    const overlay = document.createElement('div');
    overlay.className = 'fs-overlay';
    overlay.style.display = 'block';
    overlay.innerHTML = `
        <div class="card">
            <h2>Add Food</h2>
            <p><strong>${food.name}</strong></p>
            <p style="color:#aaa; font-size:0.9em;">${food.desc}</p>
            <p style="font-size:0.85em;">Per 100g: ${Math.round(food.c)}cal | P:${Math.round(food.p)}g | C:${Math.round(food.ch)}g | F:${Math.round(food.f)}g</p>
            <label>Portion (grams):</label>
            <input type="number" id="food-portion" value="100" min="1">
            <button class="btn btn-main" onclick="addFoodToMeal('${food.name}', ${food.c}, ${food.p}, ${food.ch}, ${food.f})">Add to Current Meal</button>
            <button class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">Cancel</button>
        </div>
    `;
    document.body.appendChild(overlay);
}

function addFoodToMeal(name, cPer100, pPer100, chPer100, fPer100) {
    const portion = parseFloat(document.getElementById('food-portion').value) || 100;
    const multiplier = portion / 100;
    
    const food = {
        name: name,
        calories: Math.round(cPer100 * multiplier),
        protein: Math.round(pPer100 * multiplier),
        carbs: Math.round(chPer100 * multiplier),
        fat: Math.round(fPer100 * multiplier),
        portion: portion
    };
    
    // Add to current meal - you'll need to determine which meal is active
    // This is a placeholder - adjust based on your meal tracking structure
    let meals = JSON.parse(localStorage.getItem('nimbleMeals')) || {};
    const today = new Date().toISOString().split('T')[0];
    if (!meals[today]) meals[today] = { breakfast: [], lunch: [], dinner: [], snacks: [] };
    
    // Add to snacks by default - you might want to track which meal is currently being edited
    meals[today].snacks.push(food);
    localStorage.setItem('nimbleMeals', JSON.stringify(meals));
    
    // Close modal and refresh display
    document.querySelector('.fs-overlay').remove();
    renderMacros(); // Assuming you have this function to refresh the macro display
}
// --- UNIFIED FOOD SEARCH ENGINE ---
async function searchFood() {
    const query = document.getElementById('food-search').value;
    const resDiv = document.getElementById('search-results');
    resDiv.innerHTML = '<div style="padding:10px; color:#aaa;">Scanning Global & AU Databases...</div>';
    let combinedResults = [];
    try {
        const [usdaRes, offRes] = await Promise.allSettled([
            fetch(`https://api.nal.usda.gov/fdc/v1/foods/search?query=${query}&pageSize=20&dataType=Foundation,SR Legacy&api_key=${apiKey}`),
            fetch(`https://au.openfoodfacts.org/cgi/search.pl?search_terms=${query}&search_simple=1&action=process&json=1&page_size=20`)
        ]);
        if (usdaRes.status === 'fulfilled') {
            const data = await usdaRes.value.json();
            if(data.foods) data.foods.forEach(f => {
                const getNut = (...ids) => (f.foodNutrients.find(x => ids.includes(x.nutrientId)) || {}).value || 0;
                combinedResults.push({ name: f.description.replace(/, raw/gi, '').replace(/, cooked/gi, ''), desc: f.description, source: 'USDA', c: getNut(1008, 208, 2047), p: getNut(1003, 203), f: getNut(1004, 204), ch: getNut(1005, 205) });
            });
        }
        if (offRes.status === 'fulfilled') {
            const data = await offRes.value.json();
            if(data.products) data.products.forEach(p => {
                const c = p.nutriments['energy-kcal_100g'] || p.nutriments['energy-kcal_value'] || (p.nutriments['energy-kj_100g'] ? p.nutriments['energy-kj_100g'] / 4.184 : 0);
                combinedResults.push({ name: p.product_name, desc: p.product_name + (p.brands ? ` (${p.brands})` : ''), source: 'AU/Global', c: c || 0, p: p.nutriments.proteins_100g || 0, f: p.nutriments.fat_100g || 0, ch: p.nutriments.carbohydrates_100g || 0 });
            });
        }
    } catch(e) { console.log("Search error", e); }
    let validResults = combinedResults.filter(r => r.c > 5);
    if (validResults.length === 0) { resDiv.innerHTML = '<div style="padding:10px;">No results found.</div>'; return; }
    if (validResults.length > 1) {
        const subset = validResults.slice(0, 15);
        const count = subset.length;
        const avg = { name: `Smart Average: "${query}"`, desc: `Composite of ${count} Global & AU sources`, c: subset.reduce((sum, item) => sum + item.c, 0) / count, p: subset.reduce((sum, item) => sum + item.p, 0) / count, f: subset.reduce((sum, item) => sum + item.f, 0) / count, ch: subset.reduce((sum, item) => sum + item.ch, 0) / count, isAverage: true };
        validResults.unshift(avg);
    }
    resDiv.innerHTML = '';
    validResults.sort((a,b) => { if(a.isAverage) return -1; if(b.isAverage) return 1; return b.p - a.p; });
    validResults.forEach(f => {
        const div = document.createElement('div');
        div.className = 'food-item';
        div.style.flexDirection = "column"; div.style.alignItems = "flex-start";
        if (f.isAverage) { div.style.background = "linear-gradient(45deg, #2c2c2c, #3a3a3a)"; div.style.border = "1px solid var(--gold)"; div.style.marginBottom = "10px"; }
        div.innerHTML = `<div style="font-weight:bold; color:#fff; display:flex; justify-content:space-between; width:100%;"><span>${f.name}</span>${f.isAverage ? '<span style="color:var(--gold); font-size:0.8em;">‚≠ê QUICK ADD</span>' : `<span style="font-size:0.7em; color:#555; border:1px solid #333; padding:1px 4px; border-radius:4px;">${f.source}</span>`}</div><div style="font-size:0.75em; color:#aaa; margin-bottom:4px;">${f.desc}</div><div style="font-size:0.8em; color:#aaa; display:flex; gap:10px;"><span style="color:var(--sec);">‚ö° ${Math.round(f.c)}</span><span style="color:var(--primary);">ü•© ${Math.round(f.p)}g</span><span style="color:var(--warn);">üçö ${Math.round(f.ch)}g</span><span style="color:var(--danger);">ü•ë ${Math.round(f.f)}g</span></div>`;
        div.onclick = () => openFoodModal(f);
        resDiv.appendChild(div);
    });
}
</script>
</body>
</html>
