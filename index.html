<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1e1e1e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Nimble Shred V45 Enhanced - Complete Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --bg: #121212; --card: #1e1e1e; --primary: #BB86FC; --sec: #03DAC6; 
            --text: #fff; --gold: #FFD700; --danger: #CF6679; --warn: #FF9800; 
            --success: #00C853; --push-color: #FF6B6B; --pull-color: #4ECDC4; 
            --legs-color: #95E1D3; --cardio-color: #3498db; --nimble-color: #9b59b6; 
            --rest-color: #555;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg); color: var(--text); padding: 20px; 
            padding-bottom: 100px; -webkit-tap-highlight-color: transparent;
        }
        
        /* CONTAINERS */
        .container { max-width: 800px; margin: 0 auto; display: none; }
        .container.active { display: block; }
        .card { 
            background: var(--card); padding: 15px; border-radius: 12px; 
            margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); 
        }
        
        /* BUTTONS */
        .btn { 
            display: block; width: 100%; padding: 14px; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; 
            margin-top: 10px; font-size: 16px; transition: 0.2s; 
        }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-main { background: var(--sec); color: #000; }
        .btn-action { background: var(--primary); color: #000; }
        .btn-danger { background: var(--danger); color: #fff; }
        .btn-success { background: var(--success); color: #fff; }
        .btn-small { 
            padding: 8px 12px; font-size: 0.85em; width: auto; 
            display: inline-block; margin: 5px; 
        }
        
        /* INPUTS */
        input, select, textarea { 
            width: 100%; padding: 10px; background: #2c2c2c; 
            border: 1px solid #444; border-radius: 6px; color: #fff; 
            font-size: 16px; margin: 5px 0;
        }
        input:focus, select:focus, textarea:focus { 
            border-color: var(--sec); outline: none; 
        }
        
        /* LAYOUT */
        .row { display: flex; gap: 10px; align-items: center; }
        .row-wrap { display: flex; gap: 10px; flex-wrap: wrap; }
        
        /* NAVIGATION */
        .nav-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #1a1a1a; display: flex; justify-content: space-around; 
            padding: 12px 8px; border-top: 1px solid #333; z-index: 9000; 
            padding-bottom: max(12px, env(safe-area-inset-bottom));
        }
        .nav-btn { 
            background: none; color: #777; border: none; font-size: 0.7em; 
            display: flex; flex-direction: column; align-items: center; 
            gap: 3px; cursor: pointer; padding: 5px; transition: 0.2s; flex: 1;
        }
        .nav-btn.active { color: var(--sec); }
        .nav-icon { font-size: 1.4em; }
        
        /* CHIPS */
        .chip-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
        .chip { 
            padding: 8px 16px; background: #333; border: 2px solid #555; 
            border-radius: 20px; font-size: 0.85em; cursor: pointer; 
            color: #aaa; transition: all 0.2s; user-select: none;
        }
        .chip:hover { background: #444; border-color: var(--sec); }
        .chip.active { 
            background: var(--primary); color: #000; 
            border-color: var(--primary); font-weight: bold; 
        }
        
        /* PROGRESSIVE SETS */
        .exercise-card { 
            border-left: 4px solid var(--primary); 
            margin-bottom: 15px; position: relative; 
        }
        .set-completed { 
            background: linear-gradient(90deg, #1a4d2e 0%, #2d5f3d 100%); 
            padding: 10px; border-radius: 6px; margin: 5px 0; 
            border-left: 3px solid var(--success); 
            display: flex; justify-content: space-between;
        }
        .set-active { 
            background: #2c2c2c; padding: 12px; border-radius: 6px; 
            border: 2px solid var(--sec); margin: 8px 0; 
            box-shadow: 0 0 10px rgba(3,218,198,0.2);
        }
        .progression-badge { 
            background: var(--gold); color: #000; padding: 4px 8px; 
            border-radius: 12px; font-size: 0.75em; font-weight: bold; 
        }
        
        /* CALENDAR */
        .calendar-grid { 
            display: grid; grid-template-columns: repeat(7, 1fr); 
            gap: 8px; margin: 15px 0; 
        }
        .day-bubble { 
            background: #333; aspect-ratio: 1; border-radius: 12px; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; cursor: pointer; border: 2px solid #444; 
            padding: 8px; position: relative; transition: all 0.3s;
        }
        .day-bubble:hover { transform: translateY(-2px); }
        .day-bubble .day-icon { font-size: 1.8em; margin-bottom: 4px; }
        .day-bubble .day-letter { font-weight: bold; font-size: 0.75em; }
        .day-bubble .day-type { font-size: 0.65em; color: #aaa; }
        .day-bubble .day-check { 
            position: absolute; top: 4px; right: 4px; font-size: 1em; 
        }
        
        /* Workout type colors */
        .day-bubble.workout-type-push { 
            border-color: var(--push-color); 
            background: rgba(255,107,107,0.1); 
        }
        .day-bubble.workout-type-pull { 
            border-color: var(--pull-color); 
            background: rgba(78,205,196,0.1); 
        }
        .day-bubble.workout-type-legs { 
            border-color: var(--legs-color); 
            background: rgba(149,225,211,0.1); 
        }
        .day-bubble.workout-type-cardio { 
            border-color: var(--cardio-color); 
            background: rgba(52,152,219,0.1); 
        }
        .day-bubble.workout-type-nimble { 
            border-color: var(--nimble-color); 
            background: rgba(155,89,182,0.1); 
        }
        .day-bubble.workout-type-rest { 
            border-color: var(--rest-color); 
            background: rgba(85,85,85,0.1); 
        }
        
        /* EXERCISE BUILDER */
        .exercise-list-item { 
            padding: 12px; margin: 5px 0; background: #2c2c2c; 
            border-radius: 6px; cursor: pointer; 
            border-left: 3px solid #555; transition: all 0.2s;
        }
        .exercise-list-item:hover { 
            background: #333; border-left-color: var(--primary); 
            transform: translateX(5px);
        }
        .exercise-list-item.selected { 
            background: rgba(187,134,252,0.2); 
            border-left-color: var(--primary); 
        }
        
        /* ENCYCLOPEDIA */
        .encyclopedia-section { 
            margin: 15px 0; padding: 15px; 
            background: #1a1a1a; border-radius: 8px; 
        }
        .encyclopedia-section h4 { 
            color: var(--sec); margin-bottom: 8px; 
            font-size: 0.9em; text-transform: uppercase; 
        }
        .encyclopedia-section ul { list-style: none; padding: 0; }
        .encyclopedia-section li { 
            padding: 5px 0 5px 20px; position: relative; 
        }
        .encyclopedia-section li:before { 
            content: '‚ñ∏'; position: absolute; left: 0; color: var(--sec); 
        }
        .muscle-badge { 
            display: inline-block; background: var(--primary); 
            color: #000; padding: 3px 8px; border-radius: 12px; 
            font-size: 0.75em; margin: 3px; font-weight: bold;
        }
        .gif-container { 
            background: #000; border-radius: 8px; padding: 15px; 
            margin: 15px 0; text-align: center; min-height: 200px;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #333;
        }
        .gif-container img { 
            max-width: 100%; max-height: 300px; 
            border-radius: 6px; 
        }
        
        /* MODALS */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(0,0,0,0.95); z-index: 10000; 
            display: none; align-items: center; justify-content: center; 
            padding: 20px; overflow-y: auto;
        }
        .modal-overlay.active { display: flex; }
        .modal-content { 
            background: var(--card); border-radius: 12px; 
            padding: 20px; max-width: 600px; width: 100%; 
            max-height: 90vh; overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .modal-header { 
            display: flex; justify-content: space-between; 
            align-items: center; margin-bottom: 20px; 
            padding-bottom: 15px; border-bottom: 2px solid #333;
        }
        .modal-close { 
            background: var(--danger); color: white; border: none; 
            padding: 8px 16px; border-radius: 6px; cursor: pointer; 
        }
        
        /* SLIDER */
        input[type="range"] { 
            width: 100%; height: 8px; border-radius: 5px; 
            background: #333; outline: none; -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb { 
            -webkit-appearance: none; width: 20px; height: 20px; 
            border-radius: 50%; background: var(--sec); cursor: pointer; 
        }
        
        /* GIF SEARCH */
        .gif-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
            gap: 10px; 
            margin-top: 15px; 
        }
        .gif-item { 
            cursor: pointer; 
            border-radius: 8px; 
            overflow: hidden; 
            border: 2px solid transparent; 
            transition: all 0.2s; 
            aspect-ratio: 1;
        }
        .gif-item:hover { 
            border-color: var(--sec); 
            transform: scale(1.05); 
        }
        .gif-item img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        .gif-actions { 
            display: flex; 
            gap: 10px; 
            margin-top: 10px; 
        }
        
        /* GPS MAP */
        .gps-map { 
            width: 100%; 
            height: 300px; 
            background: #2c2c2c; 
            border-radius: 8px; 
            margin: 10px 0; 
            position: relative; 
            overflow: hidden; 
        }
        .gps-stats { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px; 
            margin: 10px 0; 
        }
        .gps-stat { 
            background: #2c2c2c; 
            padding: 12px; 
            border-radius: 8px; 
            text-align: center; 
        }
        .gps-stat-value { 
            font-size: 1.5em; 
            font-weight: bold; 
            color: var(--sec); 
        }
        .gps-stat-label { 
            font-size: 0.8em; 
            color: #aaa; 
            margin-top: 5px; 
        }
        
        /* WARMUP SEQUENCE */
        .warmup-exercise { 
            background: #2c2c2c; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0; 
            border-left: 3px solid var(--warn); 
        }
        .warmup-timer { 
            font-size: 2em; 
            font-weight: bold; 
            color: var(--sec); 
            text-align: center; 
            margin: 10px 0; 
        }
        
        /* AI COACH */
        .ai-coach-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            padding: 15px; 
            border-radius: 12px; 
            margin: 15px 0; 
        }
        .ai-coach-card.warning { 
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
        }
        .ai-coach-card.success { 
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
        }
        
        /* UTILITIES */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-muted { color: #aaa; font-size: 0.85em; }
        .mb-10 { margin-bottom: 10px; }
        .mt-10 { margin-top: 10px; }
    </style>
</head>
<body>

<!-- TODAY'S BANNER -->
<div id="todays-banner" class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: none;">
    <h3 style="margin-bottom: 10px;">üìÖ <span id="today-date"></span></h3>
    <div style="font-size: 1.1em; margin-bottom: 15px;">
        Planned: <span id="today-workout"></span>
    </div>
    <button class="btn btn-main" onclick="startTodaysWorkout()">‚ñ∂Ô∏è Start Workout</button>
</div>

<!-- COACH PAGE -->
<div class="container active" id="view-coach">
    <h2>üí™ Workout Coach</h2>
    
    <div class="card">
        <h3>Quick Start</h3>
        
        <div style="margin-bottom: 20px;">
            <label style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span>Exercises per workout:</span>
                <span style="color: var(--sec); font-weight: bold; font-size: 1.2em;" id="exercise-count-display">6</span>
            </label>
            <input 
                type="range" 
                id="exercise-count-slider" 
                min="4" 
                max="10" 
                value="6" 
                oninput="updateExerciseCount(this.value)"
                style="width: 100%;"
            >
            <div style="display: flex; justify-content: space-between; font-size: 0.75em; color: #888; margin-top: 4px;">
                <span>4 (Quick)</span>
                <span>10 (Full)</span>
            </div>
        </div>
        
        <div class="chip-container">
            <div class="chip" onclick="quickStartWorkout('push')">üí™ Push</div>
            <div class="chip" onclick="quickStartWorkout('pull')">üèãÔ∏è Pull</div>
            <div class="chip" onclick="quickStartWorkout('legs')">ü¶µ Legs</div>
            <div class="chip" onclick="quickStartWorkout('full')">üî• Full</div>
            <div class="chip" onclick="quickStartWorkout('nimble')">üßò Nimble</div>
        </div>
        <button class="btn btn-main" onclick="openCustomBuilder()">üõ†Ô∏è Custom Workout Builder</button>
        <button class="btn btn-action" onclick="generateRandomWorkout()">üé≤ Random Workout</button>
    </div>
    
    <div id="workout-interface" style="display:none;">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <h3>Active Session</h3>
            <button class="btn btn-danger btn-small" onclick="endWorkout()">End</button>
        </div>
        <div id="workout-list"></div>
    </div>
</div>

<!-- PLAN PAGE -->
<div class="container" id="view-plan">
    <h2>üìÖ Training Plan</h2>
    
    <div class="card">
        <div style="display:flex; justify-content:space-between; margin-bottom: 15px;">
            <div>
                <h3 id="phase-display">Week 1 - Foundation</h3>
                <div class="text-muted">
                    Adherence: <span id="adherence-display">0/6</span>
                </div>
            </div>
            <button class="btn-small btn-action" onclick="openPlanGenerator()">üîÑ New Plan</button>
        </div>
        <div class="calendar-grid" id="week-grid"></div>
    </div>
    
    <div id="ai-coach-suggestions"></div>
</div>

<!-- CARDIO PAGE -->
<div class="container" id="view-cardio">
    <h2>üö¥ Cardio Tracking</h2>
    
    <div class="card">
        <h3>üìç Live GPS Tracking</h3>
        <p class="text-muted" style="margin-bottom:10px;">Track your run or bike ride with live GPS</p>
        <select id="gps-activity-type" style="margin-bottom:10px;">
            <option value="run">üèÉ Running</option>
            <option value="bike">üö¥ Cycling</option>
            <option value="walk">üö∂ Walking</option>
        </select>
        <button class="btn btn-success" onclick="startGpsTracking()">üìç Start GPS Tracking</button>
    </div>
    
    <div class="card">
        <h3>Quick Log Cardio</h3>
        <label>Type:</label>
        <select id="cardio-type">
            <option value="run">üèÉ Run</option>
            <option value="bike">üö¥ Bike</option>
            <option value="swim">üèä Swim</option>
            <option value="walk">üö∂ Walk</option>
            <option value="row">üö£ Row</option>
        </select>
        <label>Duration (minutes):</label>
        <input type="number" id="cardio-duration" value="30" min="5">
        <label>Distance (km) - optional:</label>
        <input type="number" id="cardio-distance" placeholder="e.g. 5.5" step="0.1">
        <button class="btn btn-main" onclick="logCardioSession()">üíæ Log Cardio</button>
    </div>
    
    <div class="card">
        <h3>Recent Cardio</h3>
        <div id="cardio-history"></div>
    </div>
</div>

<!-- SETTINGS PAGE -->
<div class="container" id="view-settings">
    <h2>‚öôÔ∏è Settings</h2>
    
    <div class="card">
        <h3>üèãÔ∏è Equipment Available</h3>
        <div id="equipment-presets"></div>
    </div>
    
    <div class="card">
        <h3>üîä Voice Coach</h3>
        <label>
            <input type="checkbox" id="voice-enabled" checked onchange="saveVoiceSettings()"> 
            Enable Voice
        </label>
        <label style="margin-top: 10px; display: block;">Level:</label>
        <select id="voice-level" onchange="saveVoiceSettings()">
            <option value="silent">Silent</option>
            <option value="countdown">Countdown Only</option>
            <option value="standard" selected>Standard</option>
            <option value="motivational">Motivational</option>
        </select>
        <button class="btn btn-action" onclick="testVoice()">üéµ Test Voice</button>
    </div>
    

</div>

<!-- ENCYCLOPEDIA PAGE -->
<div class="container" id="view-encyclopedia">
    <h2>üìö Exercise Encyclopedia</h2>
    
    <div class="card">
        <input type="text" id="encyclopedia-search" placeholder="Search exercises..." 
               onkeyup="searchEncyclopedia()" style="margin-bottom: 10px;">
        
        <label>Filter by:</label>
        <div class="chip-container">
            <div class="chip active" onclick="filterEncyclopedia('all')">All</div>
            <div class="chip" onclick="filterEncyclopedia('Chest')">Chest</div>
            <div class="chip" onclick="filterEncyclopedia('Back')">Back</div>
            <div class="chip" onclick="filterEncyclopedia('Legs')">Legs</div>
            <div class="chip" onclick="filterEncyclopedia('Shoulders')">Shoulders</div>
            <div class="chip" onclick="filterEncyclopedia('Cable')">Cables</div>
            <div class="chip" onclick="filterEncyclopedia('Bodyweight')">Bodyweight</div>
        </div>
    </div>
    
    <div id="encyclopedia-list"></div>
</div>

<!-- NAVIGATION -->
<div class="nav-bar">
    <button class="nav-btn active" onclick="switchTab('coach')">
        <div class="nav-icon">üí™</div>Coach
    </button>
    <button class="nav-btn" onclick="switchTab('plan')">
        <div class="nav-icon">üìÖ</div>Plan
    </button>
    <button class="nav-btn" onclick="switchTab('cardio')">
        <div class="nav-icon">üö¥</div>Cardio
    </button>
    <button class="nav-btn" onclick="switchTab('encyclopedia')">
        <div class="nav-icon">üìö</div>Library
    </button>
    <button class="nav-btn" onclick="switchTab('settings')">
        <div class="nav-icon">‚öôÔ∏è</div>Settings
    </button>
</div>

<!-- CUSTOM BUILDER MODAL -->
<div class="modal-overlay" id="custom-builder-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üõ†Ô∏è Custom Workout Builder</h2>
            <button class="modal-close" onclick="closeCustomBuilder()">‚úï</button>
        </div>
        
        <div style="margin-bottom: 15px;">
            <label>Number of Exercises: <span id="exercise-count-display">6</span></label>
            <input type="range" id="exercise-count-slider" min="3" max="10" value="6" 
                   oninput="updateExerciseCount(this.value)">
        </div>
        
        <div style="margin-bottom: 15px;">
            <input type="text" id="builder-search" placeholder="Search exercises..." 
                   onkeyup="searchBuilderExercises()">
        </div>
        
        <div style="margin-bottom: 15px;">
            <label>Filter by:</label>
            <div class="chip-container">
                <div class="chip active" onclick="filterBuilder('all')">All</div>
                <div class="chip" onclick="filterBuilder('Chest')">Chest</div>
                <div class="chip" onclick="filterBuilder('Back')">Back</div>
                <div class="chip" onclick="filterBuilder('Legs')">Legs</div>
                <div class="chip" onclick="filterBuilder('Shoulders')">Shoulders</div>
            </div>
        </div>
        
        <div id="builder-exercise-list" style="max-height: 300px; overflow-y: auto;"></div>
        
        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #333;">
            <p class="text-muted">Selected: <span id="selected-count">0</span> exercises</p>
            <button class="btn btn-main" onclick="startCustomWorkout()">
                ‚ñ∂Ô∏è Start Custom Workout
            </button>
        </div>
    </div>
</div>

<!-- EXERCISE DETAIL MODAL -->
<div class="modal-overlay" id="exercise-detail-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="exercise-detail-name">Exercise Name</h2>
            <button class="modal-close" onclick="closeExerciseDetail()">‚úï</button>
        </div>
        <div id="exercise-detail-content"></div>
    </div>
</div>

<!-- GIF SEARCH MODAL -->
<div class="modal-overlay" id="gif-search-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üîç Search Exercise Images</h2>
            <button class="modal-close" onclick="closeGifSearch()">‚úï</button>
        </div>
        <div id="gif-search-content">
            <p class="text-muted" style="margin-bottom:15px;">
                Searching for: <strong id="gif-search-query"></strong>
            </p>
            <div id="gif-results" class="gif-grid"></div>
            <div id="gif-loading" style="text-align:center; padding:20px; display:none;">
                <p>üîÑ Loading images...</p>
            </div>
            <div id="gif-error" style="display:none; color:var(--danger); text-align:center; padding:20px;">
                <p>‚ö†Ô∏è Error loading images. Please check your API key or try again.</p>
            </div>
        </div>
    </div>
</div>

<!-- GPS TRACKING MODAL -->
<div class="modal-overlay" id="gps-tracking-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìç GPS Tracking</h2>
            <button class="modal-close" onclick="stopGpsTracking()">‚úï Stop</button>
        </div>
        <div id="gps-tracking-content">
            <div class="gps-stats">
                <div class="gps-stat">
                    <div class="gps-stat-value" id="gps-distance">0.00</div>
                    <div class="gps-stat-label">km</div>
                </div>
                <div class="gps-stat">
                    <div class="gps-stat-value" id="gps-pace">0:00</div>
                    <div class="gps-stat-label">min/km</div>
                </div>
                <div class="gps-stat">
                    <div class="gps-stat-value" id="gps-duration">00:00</div>
                    <div class="gps-stat-label">duration</div>
                </div>
            </div>
            <div class="gps-map" id="gps-map-container">
                <canvas id="gps-map-canvas" width="600" height="300"></canvas>
            </div>
            <div style="text-align:center; margin-top:15px;">
                <button class="btn btn-success" onclick="saveGpsRoute()">üíæ Save Route</button>
            </div>
        </div>
    </div>
</div>

<!-- WARMUP MODAL -->
<div class="modal-overlay" id="warmup-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üî• Warm-up Sequence</h2>
            <button class="modal-close" onclick="skipWarmup()">Skip</button>
        </div>
        <div id="warmup-content">
            <div class="warmup-timer" id="warmup-timer">60</div>
            <div class="warmup-exercise" id="warmup-current-exercise">
                <h3 id="warmup-exercise-name">Exercise Name</h3>
                <p class="text-muted" id="warmup-exercise-desc">Instructions</p>
            </div>
            <div style="text-align:center; margin-top:20px;">
                <button class="btn btn-action" id="warmup-next-btn" onclick="nextWarmupExercise()">Next Exercise</button>
            </div>
            <div class="text-muted" style="text-align:center; margin-top:10px;">
                Exercise <span id="warmup-progress">1/6</span>
            </div>
        </div>
    </div>
</div>

<!-- PLAN GENERATOR MODAL -->
<div class="modal-overlay" id="plan-generator-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Generate Training Plan</h2>
            <button class="modal-close" onclick="closePlanGenerator()">‚úï</button>
        </div>
        
        <div id="generator-step-1">
            <h3>Training Frequency</h3>
            <p class="text-muted">How many days per week?</p>
            <div class="chip-container">
                <div class="chip" onclick="selectFrequency(3)">3 Days</div>
                <div class="chip" onclick="selectFrequency(4)">4 Days</div>
                <div class="chip" onclick="selectFrequency(5)">5 Days</div>
                <div class="chip" onclick="selectFrequency(6)">6 Days</div>
            </div>
        </div>
        
        <div id="generator-step-2" style="display:none;">
            <h3>Training Focus</h3>
            <p class="text-muted">Balanced approach for sustainable fitness</p>
            <div class="chip-container">
                <div class="chip" onclick="selectGoal('balanced')">‚öñÔ∏è Balanced Performance</div>
                <div class="chip" onclick="selectGoal('vitality')">üßò Health & Vitality</div>
                <div class="chip" onclick="selectGoal('functional')">üéØ Functional Fitness</div>
            </div>
        </div>
        
        <div id="generator-step-3" style="display:none;">
            <h3>‚úÖ Plan Generated!</h3>
            <div id="plan-preview"></div>
            <button class="btn btn-main" onclick="acceptPlan()">Accept & Start</button>
            <button class="btn btn-action" onclick="regeneratePlan()">üîÑ Regenerate</button>
        </div>
    </div>
</div>

<script>
// ========================================
// EXERCISE DATABASE
// ========================================
function createEx(name, cat, equip, type, prep, exec, tips, benefits, muscles, setupF9) {
    return {
        name: name,
        cat: cat,
        equip: equip,
        type: type,
        guide: {
            prep: prep,
            exec: exec,
            tips: tips,
            benefits: benefits,
            muscles: muscles
        },
        setup: setupF9 || { arms: "N/A", pulleys: "N/A" }
    };
}

window.allExercises = [
  // ==================== CABLE CHEST (TORQUE F9) ====================
        createEx("Cable Chest Press", ["Chest"], "Cable", "Strength", 
            ["Set Arms to Wide (Pos 8-9). Pulleys at Chest Height.", "Grab handles and step forward into a split stance (one foot forward) for stability.", "Brace core and lean slightly forward, keeping spine neutral."],
            ["Press handles straight forward until arms are fully extended.", "Bring hands together at the center line.", "Slowly return elbows to a 45-degree angle (don't let them fly back behind shoulders)."],
            ["Don't flare elbows wide; keep them tucked.", "Keep shoulders down (depressed); don't shrug.", "Drive through the back leg."],
            ["Constant tension on pectorals throughout the rep.", "Reduced shoulder strain compared to bench press.", "High core activation for stability."],
            ["Pectoralis Major", "Triceps", "Front Delts"], {arms: "Wide (Pos 8-9)", pulleys: "Chest Height"}),

        createEx("Cable Chest Fly (High)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Top Position. Arms Wide.", "Step forward, lean torso 30¬∞ forward.", "Start with arms open wide, elbows slightly bent."],
            ["Fly hands down and together towards your waist.", "Imagine hugging a large tree trunk.", "Squeeze inner chest hard at the bottom.", "Control the return to the stretch position."],
            ["Don't turn it into a press; keep the elbow angle fixed.", "Keep chest proud, don't round shoulders forward."],
            ["Targets the lower (sternal) head of the chest.", "Excellent for creating the lower pec outline."],
            ["Lower Pectorals", "Anterior Delts"], {arms: "Wide", pulleys: "Top"}),

        createEx("Cable Chest Fly (Low)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Bottom Position. Arms Wide.", "Stand centrally with feet shoulder-width apart.", "Palms facing forward and up."],
            ["Scoop hands up and together to eye level.", "Focus on driving the elbows in and up.", "Squeeze the upper chest at the peak.", "Lower slowly to the starting position."],
            ["Don't swing your body to hoist the weight.", "Keep elbows soft (slightly bent) but rigid.", "Focus on the 'scoop' motion."],
            ["Targets the upper (clavicular) chest.", "Helps fill out the shelf of the chest."],
            ["Upper Pectorals", "Front Delts"], {arms: "Wide", pulleys: "Bottom"}),

        createEx("Cable Chest Fly (Mid)", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys to Chest Height. Arms Wide.", "Step forward into a split stance.", "Palms facing each other."],
            ["Bring hands together directly in front of your chest.", "Squeeze hard for 1 second at the touch point.", "Open arms wide until you feel a deep stretch across the pecs."],
            ["Retract shoulder blades on the negative.", "Don't lock out elbows at the end range."],
            ["Builds overall chest mass.", "Focuses on peak contraction."],
            ["Pectoralis Major"], {arms: "Wide", pulleys: "Chest Height"}),

        createEx("Single Arm Cable Chest Press", ["Chest"], "Cable", "Strength",
            ["Set Pulley to Chest Height.", "Adopt a split stance.", "Hold one handle at your chest."],
            ["Press straight out while keeping hips and shoulders perfectly square.", "Resist the rotation of your torso.", "Return slowly to the start."],
            ["Fight the urge to twist your body.", "Engage obliques heavily to stabilize."],
            ["Corrects strength imbalances.", "Massive anti-rotation core workout."],
            ["Pecs", "Obliques", "Triceps"], {arms: "Standard", pulleys: "Chest Height"}),

        createEx("Cable Crossover", ["Chest"], "Cable", "Muscle Build",
            ["Set Pulleys Top. Arms Wide.", "Step forward aggressively.", "Lean torso forward 45 degrees."],
            ["Bring hands down and across each other.", "Cross wrists at the bottom to maximize range of motion.", "Alternate which hand is on top each rep."],
            ["Focus on the inner chest squeeze.", "Keep the movement distinct from a press."],
            ["Creates inner chest definition.", "Maximum contraction at the bottom."],
            ["Inner Pectorals"], {arms: "Wide", pulleys: "Top"}),

        createEx("Cable Pullover (Bench)", ["Chest", "Lats"], "Cable", "Muscle Build",
            ["Set Pulley Mid/Low. Arms Narrow.", "Place bench perpendicular to machine.", "Lie on back, head near machine.", "Hold rope or bar."],
            ["Keeping arms straight, pull the weight from behind your head over to your hips.", "Squeeze chest and lats at the bottom.", "Slowly return weight behind head for a stretch."],
            ["Keep arms straight but not locked.", "Feel the deep stretch in your armpits."],
            ["Expands the ribcage.", "Hits both chest and lats effectively."],
            ["Serratus Anterior", "Lats", "Pecs"], {arms: "Narrow", pulleys: "Mid"}),

        // ==================== CABLE BACK (TORQUE F9) ====================
        createEx("Lat Pulldown (Standing)", ["Back"], "Cable", "Strength",
            ["Set Pulleys Top. Arms Narrow or Top.", "Kneel or squat down on the floor.", "Hold handles with palms facing forward."],
            ["Drive elbows down towards your back pockets.", "Squeeze lats hard at the bottom.", "Allow arms to stretch fully up at the top."],
            ["Think 'Elbows to pockets', not 'Hands to shoulders'.", "Keep chest proud.", "Don't round your back."],
            ["Builds back width (V-Taper).", "Safe vertical pull pattern."],
            ["Latissimus Dorsi", "Biceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Seated Cable Row", ["Back"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Narrow.", "Sit on floor or bench.", "Brace feet against machine frame if possible."],
            ["Pull handles into your stomach.", "Drive elbows back past your torso.", "Squeeze shoulder blades together."],
            ["Keep spine neutral and upright.", "Don't rock back and forth excessively."],
            ["Builds back thickness.", "Corrects posture."],
            ["Rhomboids", "Traps", "Lats"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Face Pulls", ["Back", "Shoulders"], "Cable", "Mobility",
            ["Set Pulley to Face Height. Use Rope.", "Grip rope with thumbs facing back.", "Staggered stance."],
            ["Pull the center of the rope to your forehead.", "Externally rotate hands back (like a double bicep pose).", "Squeeze rear delts."],
            ["Don't shrug shoulders up to ears.", "Lead with your wrists."],
            ["Essential for shoulder health.", "Strengthens rotator cuff."],
            ["Rear Delts", "Rotator Cuff"], {arms: "Narrow", pulleys: "Face Height"}),

        createEx("Straight Arm Pulldown", ["Back"], "Cable", "Muscle Build",
            ["Set Pulleys Top. Arms Top.", "Hinge hips slightly back.", "Keep arms straight out in front."],
            ["Push the bar/handles down to your thighs using your lats.", "Keep arms straight throughout.", "Squeeze armpits tight at the bottom."],
            ["Don't use triceps to push.", "Initiate movement with your lats."],
            ["Pure lat isolation.", "Great as a pre-exhaust."],
            ["Latissimus Dorsi"], {arms: "Top", pulleys: "Top"}),

        createEx("Single Arm Cable Row", ["Back"], "Cable", "Strength",
            ["Set Pulley Waist Height. Arms Standard.", "Adopt a split stance.", "Reach forward with the working arm."],
            ["Row elbow back tight to the body.", "Allow torso to rotate slightly forward on the stretch.", "Rotate back to neutral on the pull."],
            ["Get a deep stretch at the start.", "Hard contraction at the end."],
            ["Unilateral back growth.", "Core integration."],
            ["Lats", "Obliques"], {arms: "Standard", pulleys: "Waist Height"}),

        createEx("Cable Shrugs", ["Back", "Traps"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Stand centrally.", "Hold handles at sides."],
            ["Shrug shoulders straight up towards your ears.", "Hold for 1 second at the top.", "Lower fully to stretch traps."],
            ["Don't roll shoulders forward or back.", "Keep arms straight."],
            ["Builds trap size.", "Neck strength."],
            ["Trapezius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Rear Delt Fly", ["Back", "Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Eye Level. Arms Wide.", "Grab opposite cables (Left hand holds Right cable).", "Stand tall."],
            ["Pull arms apart horizontally until in line with body.", "Squeeze the back of your shoulders.", "Control the return."],
            ["Keep arms straight.", "Don't engage traps (keep shoulders down)."],
            ["Builds 3D Delts.", "Improves posture."],
            ["Posterior Delts"], {arms: "Wide", pulleys: "Eye Level"}),

        createEx("High Row (Rope)", ["Back"], "Cable", "Strength",
            ["Set Pulleys Top. Arms Narrow.", "Use Rope attachment.", "Step back and lean slightly."],
            ["Pull the rope towards your neck/chin.", "Drive elbows high and wide.", "Squeeze upper back."],
            ["Focus on the upper back, not the lats.", "Keep elbows flared."],
            ["Builds upper back thickness.", "Hits rear delts hard."],
            ["Rhomboids", "Rear Delts"], {arms: "Narrow", pulleys: "Top"}),

        // ==================== CABLE SHOULDERS ====================
        createEx("Cable Overhead Press", ["Shoulders"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Wide.", "Hold handles at shoulder height.", "Stand strong with core braced."],
            ["Press straight up overhead.", "Bring biceps by ears at the top.", "Lower with control to ear level."],
            ["Keep core tight.", "Don't arch your lower back."],
            ["Builds shoulder mass.", "Constant tension compared to dumbbells."],
            ["Anterior Delts", "Triceps"], {arms: "Wide", pulleys: "Low"}),

        createEx("Cable Lateral Raise", ["Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Cross cables (Left hand -> Right cable).", "Stand center."],
            ["Raise arms out to the sides.", "Stop at shoulder height.", "Lower slowly."],
            ["Lead with your elbows, not your hands.", "Imagine pouring a pitcher of water."],
            ["Builds side delt width.", "Creates caped shoulder look."],
            ["Lateral Delts"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Front Raise", ["Shoulders"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Face away from machine.", "Cable runs between legs."],
            ["Raise straight arms to the front.", "Stop at eye level.", "Lower with control."],
            ["No swinging.", "Keep chest up."],
            ["Isolates the front delt."],
            ["Anterior Delts"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable External Rotation", ["Shoulders", "Mobility"], "Cable", "Mobility",
            ["Set Pulley Elbow Height.", "Stand sideways.", "Elbow pinned to side (use a towel if needed)."],
            ["Rotate hand away from your body.", "Keep elbow glued to ribs.", "Return slowly."],
            ["Use very light weight.", "Focus on the small cuff muscles."],
            ["Rotator cuff health.", "Injury prevention."],
            ["Infraspinatus"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Internal Rotation", ["Shoulders", "Mobility"], "Cable", "Mobility",
            ["Set Pulley Elbow Height.", "Stand sideways.", "Elbow pinned to side."],
            ["Rotate hand inward towards your stomach.", "Keep elbow glued.", "Return."],
            ["Control the motion.", "Don't use chest to pull."],
            ["Subscapularis strength."],
            ["Subscapularis"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Upright Row", ["Shoulders", "Traps"], "Cable", "Muscle Build",
            ["Set Pulleys Low. Arms Low.", "Bar or Handles.", "Stand close."],
            ["Pull hands up body to chest.", "Elbows lead movement high.", "Lower."],
            ["Don't go too heavy.", "Watch wrists."],
            ["Side delts and Traps."],
            ["Lateral Delts", "Traps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Y-Raise", ["Back", "Shoulders"], "Cable", "Mobility",
            ["Set Pulleys Low. Arms Low.", "Cross cables.", "Stand tall."],
            ["Raise arms up and out into 'Y' shape.", "Squeeze lower traps.", "Lower slowly."],
            ["Thumbs up.", "Don't arch back."],
            ["Lower trap activation.", "Scapular health."],
            ["Lower Traps", "Side Delts"], {arms: "Low", pulleys: "Low"}),

        // ==================== CABLE ARMS ====================
        createEx("Tricep Pushdown (Rope)", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Pin elbows to your ribs.", "Hinge only at the elbow."],
            ["Push down forcefully.", "Spread the rope apart at the bottom.", "Return to 90 degrees."],
            ["Keep elbows locked in place.", "Squeeze triceps hard."],
            ["Targets the lateral head.", "Great for definition."],
            ["Triceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Tricep Pushdown (Bar)", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Use Straight Bar.", "Elbows pinned to sides."],
            ["Push straight down.", "Lockout arms fully.", "Return to chest height."],
            ["Go heavier than with rope.", "Keep wrists straight."],
            ["Overall tricep mass builder."],
            ["Triceps"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Overhead Cable Extension", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Mid/Top.", "Lean forward facing away from machine.", "Hold rope behind head."],
            ["Extend arms forward and overhead.", "Keep elbows by ears.", "Stretch back deeply."],
            ["The deep stretch is key here.", "Don't flare elbows too wide."],
            ["Targets the Long Head of the tricep.", "Adds arm size."],
            ["Triceps (Long Head)"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Cable Bicep Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Hold bar or handles.", "Stand tall."],
            ["Curl weight up to chin.", "Squeeze biceps.", "Lower fully."],
            ["Keep elbows slightly forward of hips.", "Don't lean back."],
            ["Constant tension curls."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Hammer Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Use Rope.", "Neutral grip (palms facing)."],
            ["Curl up towards shoulders.", "Thumbs lead the movement.", "Lower."],
            ["Focus on forearms and brachialis.", "No swinging."],
            ["Adds arm thickness and width."],
            ["Brachialis", "Forearms"], {arms: "Low", pulleys: "Low"}),

        createEx("Bayesian Curl", ["Arms", "Biceps"], "Cable", "Muscle Build",
            ["Set Pulley Low. Face away.", "Arm extended behind torso.", "Step forward."],
            ["Curl forward while keeping elbow back.", "Feel the deep stretch at start."],
            ["Unique stretch angle for hypertrophy.", "Keep shoulder stable."],
            ["Targets the long head via stretch."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Kickback", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Low.", "Bent over.", "No attachment."],
            ["Extend arm back.", "Squeeze hard.", "Bend elbow only."],
            ["Don't swing shoulder."],
            ["Peak contraction."],
            ["Triceps"], {arms: "Low", pulleys: "Low"}),

        createEx("Reverse Grip Pushdown", ["Arms", "Triceps"], "Cable", "Muscle Build",
            ["Set Pulley Top.", "Palms up (Supinated).", "Elbows pinned."],
            ["Push down.", "Squeeze."],
            ["Don't loose grip."],
            ["Medial head focus."],
            ["Triceps"], {arms: "Top", pulleys: "Top"}),

        // ==================== CABLE LEGS ====================
        createEx("Cable Squat", ["Legs"], "Cable", "Strength",
            ["Set Pulleys Low. Arms Narrow.", "Hold handles at shoulders (rack position).", "Stance shoulder width."],
            ["Squat down deep.", "Keep chest upright.", "Drive up through heels."],
            ["Safer on the back than barbell squats.", "Easy to bail if needed."],
            ["Quad focus with less spinal load."],
            ["Quads", "Glutes"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Pull-Through", ["Legs", "Glutes"], "Cable", "Strength",
            ["Set Pulley Low. Rope.", "Face away from machine.", "Hold rope between legs."],
            ["Hinge hips back towards machine.", "Feel hamstring stretch.", "Snap hips forward to stand."],
            ["It is a hinge, not a squat.", "Squeeze glutes hard at top.", "Don't pull with arms."],
            ["Best glute builder on cable.", "Teaches hip hinge."],
            ["Glutes", "Hamstrings"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable RDL", ["Legs", "Hamstrings"], "Cable", "Strength",
            ["Set Pulleys Low.", "Face machine.", "Hold handles at thighs."],
            ["Hinge hips back.", "Keep knees soft but fixed.", "Lower until back is parallel to floor."],
            ["Feel deep hamstring stretch.", "Drive hips forward to stand."],
            ["Posterior chain builder."],
            ["Hamstrings"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Lunge", ["Legs"], "Cable", "Strength",
            ["Set Pulleys Low.", "Hold handles.", "Step back into a lunge."],
            ["Drop back knee to floor.", "Drive up through front heel.", "Keep chest up."],
            ["Stability challenge.", "Keep knee in line with toe."],
            ["Unilateral leg strength."],
            ["Quads", "Glutes"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Kickback (Glute)", ["Legs", "Glutes"], "Cable", "Muscle Build",
            ["Set Pulley Low. Ankle strap.", "Face machine.", "Lean forward slightly."],
            ["Kick leg straight back and up.", "Squeeze glute at top.", "Return slowly."],
            ["Don't rotate hips open.", "Movement comes from hip, not back."],
            ["Glute isolation."],
            ["Glute Maximus"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Calf Raise", ["Legs", "Calves"], "Cable", "Muscle Build",
            ["Set Pulleys Low.", "Stand on a block or plate.", "Hold handles."],
            ["Lower heels to floor.", "Drive up onto toes.", "Squeeze hard."],
            ["Full range of motion is critical.", "Don't bounce."],
            ["Calf size and strength."],
            ["Calves"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Abductor", ["Legs", "Glutes"], "Cable", "Mobility",
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Leg furthest from machine."],
            ["Kick leg out to side.", "Control return."],
            ["Stabilize with other leg."],
            ["Side glute.", "Hip health."],
            ["Glute Medius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Adductor", ["Legs"], "Cable", "Mobility",
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Leg closest to machine."],
            ["Pull leg across body.", "Control return."],
            ["Balance key."],
            ["Inner thigh."],
            ["Adductors"], {arms: "Low", pulleys: "Low"}),

        // ==================== CABLE CORE ====================
        createEx("Cable Crunch", ["Core"], "Cable", "Muscle Build",
            ["Set Pulley Top. Rope.", "Kneel down facing machine.", "Hold rope at ears."],
            ["Curl spine down towards floor.", "Bring elbows to knees.", "Squeeze abs."],
            ["Don't hinge at the hips.", "Round the back like a shrimp."],
            ["Weighted abdominal hypertrophy."],
            ["Rectus Abdominis"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Woodchopper (High to Low)", ["Core"], "Cable", "Mobility",
            ["Set Pulley Top.", "Stand sideways.", "Grab handle with both hands."],
            ["Chop down and across body to opposite knee.", "Pivot back foot.", "Return slowly."],
            ["Explosive down, controlled up.", "Keep arms straight."],
            ["Oblique power.", "Rotational strength."],
            ["Obliques"], {arms: "Narrow", pulleys: "Top"}),

        createEx("Pallof Press", ["Core"], "Cable", "Strength",
            ["Set Pulley Chest Height.", "Stand sideways.", "Hold handle at chest."],
            ["Press handle straight out.", "Hold for 2-3 seconds.", "Return to chest."],
            ["Resist the rotation pulling you in.", "Keep shoulders square."],
            ["The ultimate anti-rotation exercise.", "Spine health."],
            ["Core Stabilizers"], {arms: "Narrow", pulleys: "Chest Height"}),

        createEx("Cable Side Bend", ["Core"], "Cable", "Mobility",
            ["Set Pulley Low. Stand sideways to the machine.", "Hold the handle in one hand, arm hanging straight down.", "Feet shoulder-width apart."],
            ["Lean your torso away from the machine, crunching the oblique.", "Return to neutral, resisting the pull.", "Do not lean forward or back."],
            ["Focus on the ribcage moving towards the hip.", "Keep the arm straight; don't pull with the bicep."],
            ["Isolates the obliques.", "Strengthens the lateral core."],
            ["Obliques"], {arms: "Low", pulleys: "Low"}),

        createEx("Woodchopper (Low to High)", ["Core"], "Cable", "Mobility",
            ["Set Pulley Low.", "Stand sideways.", "Hands on handle."],
            ["Rotate up across body.", "Pivot foot.", "Return."],
            ["Full rotation."],
            ["Functional core."],
            ["Obliques"], {arms: "Narrow", pulleys: "Low"}),

        // ==================== DUMBBELLS (DETAILED) ====================
        createEx("Dumbbell Bench Press", ["Chest"], "Dumbbell", "Strength",
            ["Lie on a flat bench with 5 points of contact (head, shoulders, butt, left foot, right foot).", "Hold dumbbells at chest level, palms facing forward.", "Retract shoulder blades."],
            ["Press dumbbells straight up to full lockout.", "Lower slowly (3 seconds) until hands are level with chest.", "Elbows should be at a 45-degree angle to body."],
            ["Drive feet into the floor.", "Do not bounce the weights at the bottom.", "Keep wrists straight."],
            ["Builds chest mass.", "Requires more stabilizer muscle than barbell."],
            ["Pectoralis Major", "Triceps", "Front Delts"]),

        createEx("Dumbbell Incline Press", ["Chest"], "Dumbbell", "Strength",
            ["Set bench to 30 or 45 degrees.", "Kick dumbbells up to shoulders using knees.", "Palms forward."],
            ["Press straight up towards the ceiling.", "Lower slowly to upper chest level.", "Keep elbows tucked, not flared."],
            ["Keep head on the bench.", "Squeeze pecs at the top."],
            ["Targets the 'shelf' of the upper chest.", "Less stress on rotator cuff than flat bench."],
            ["Upper Pectorals", "Front Delts"]),

        createEx("Dumbbell Fly", ["Chest"], "Dumbbell", "Muscle Build",
            ["Lie on a flat bench.", "Hold dumbbells above chest, palms facing each other (neutral grip).", "Slight bend in elbows."],
            ["Lower arms out to sides in a wide arc.", "Feel a deep stretch across the chest.", "Squeeze back to the top like hugging a barrel."],
            ["Don't go below shoulder level if it hurts.", "Keep the elbow bend constant."],
            ["Expands the chest.", "Isolates the pecs without tricep involvement."],
            ["Pectoralis Major"]),

        createEx("Dumbbell Shoulder Press", ["Shoulders"], "Dumbbell", "Strength",
            ["Sit on a bench with back support.", "Bring dumbbells to shoulder height, palms forward.", "Feet flat on floor."],
            ["Press straight up overhead until arms lock out.", "Lower slowly until thumbs touch ear level.", "Keep core tight."],
            ["Do not arch your lower back aggressively.", "Push head slightly forward at the top."],
            ["Primary mass builder for shoulders.", "Full range of motion."],
            ["Deltoids", "Triceps"]),

        createEx("Arnold Press", ["Shoulders"], "Dumbbell", "Strength",
            ["Sit upright.", "Start with dumbbells in front of face, palms facing you (supinated).", "Elbows tucked."],
            ["Press up while rotating palms outward.", "Finish at the top with palms facing forward.", "Reverse the rotation on the way down."],
            ["Smooth, controlled rotation is key.", "Don't rush the twist."],
            ["Hits all 3 heads of the deltoid.", "Increases time under tension."],
            ["Anterior Delts", "Lateral Delts", "Rear Delts"]),

        createEx("Lateral Raise", ["Shoulders"], "Dumbbell", "Muscle Build",
            ["Stand tall with dumbbells at sides.", "Slight bend in elbows.", "Lean forward 5 degrees."],
            ["Raise arms out to the sides until parallel with floor.", "Think about lifting with your elbows, not hands.", "Lower slowly."],
            ["Don't swing the body.", "Pinkies should be slightly higher than thumbs (pouring water)."],
            ["Creates shoulder width (the 'Cap').", "Isolates the side delt."],
            ["Lateral Delts"]),

        createEx("Front Raise", ["Shoulders"], "Dumbbell", "Muscle Build",
            ["Stand tall, dumbbells resting on thighs.", "Palms facing thighs (pronated)."],
            ["Raise dumbbells straight to the front until eye level.", "Lower with control.", "Keep arms straight."],
            ["Do not use hip drive to swing weight up.", "Keep chest proud."],
            ["Isolates the front of the shoulder.", "Improves pressing stability."],
            ["Anterior Delts"]),

        createEx("Dumbbell Row", ["Back"], "Dumbbell", "Strength",
            ["Place one knee and same-side hand on a bench.", "Back flat like a table.", "Hold dumbbell in free hand."],
            ["Row the dumbbell up towards your hip pocket.", "Drive elbow back past torso.", "Lower to a full stretch."],
            ["Don't rotate your spine to lift the weight.", "Pull with the elbow, not the bicep."],
            ["Builds back thickness.", "Corrects strength imbalances."],
            ["Latissimus Dorsi", "Rhomboids", "Biceps"]),

        createEx("Dumbbell Pullover", ["Back"], "Dumbbell", "Muscle Build",
            ["Lie perpendicular across a bench (upper back on bench).", "Hold one dumbbell with both hands overhead.", "Hips low."],
            ["Lower the weight behind your head with slight elbow bend.", "Feel a massive stretch in lats/ribs.", "Pull back over to chest."],
            ["Keep hips low to maximize stretch.", "Don't turn it into a tricep extension."],
            ["Expands the ribcage.", "Targets lats and serratus anterior."],
            ["Latissimus Dorsi", "Serratus Anterior"]),

        createEx("Goblet Squat", ["Legs"], "Dumbbell", "Strength",
            ["Hold one dumbbell vertically against your chest.", "Cup the top end in your palms.", "Stance shoulder-width."],
            ["Squat down deep, elbows tracking inside knees.", "Keep chest proud and upright.", "Drive up through heels."],
            ["Don't let the chest collapse forward.", "Keep heels glued to the floor."],
            ["Excellent for learning squat form.", "Builds legs and core."],
            ["Quadriceps", "Glutes", "Core"]),

        createEx("Dumbbell Lunge", ["Legs"], "Dumbbell", "Strength",
            ["Hold dumbbells at sides (suitcase carry).", "Stand tall."],
            ["Step forward with one leg.", "Drop back knee until it hovers 1 inch off floor.", "Push back to start position."],
            ["Keep torso upright.", "Ensure front knee doesn't cave inward."],
            ["Unilateral leg strength.", "Improves balance and hip stability."],
            ["Quadriceps", "Glutes", "Hamstrings"]),

        createEx("Bulgarian Split Squat", ["Legs"], "Dumbbell", "Strength",
            ["Place rear foot laces-down on a bench.", "Hop front foot out.", "Hold dumbbells at sides."],
            ["Squat down until rear knee is near floor.", "Drive up through the front heel.", "Keep torso slightly forward."],
            ["Keep the weight on the front leg.", "This exercise is painful but highly effective."],
            ["The king of single-leg builders.", "Fixes imbalances."],
            ["Glutes", "Quadriceps"]),

        createEx("Romanian Deadlift (DB)", ["Legs"], "Dumbbell", "Strength",
            ["Hold dumbbells in front of thighs.", "Feet hip-width apart.", "Knees slightly soft but fixed."],
            ["Hinge hips backward (close car door with butt).", "Slide dumbbells down legs.", "Feel hamstring stretch.", "Snap hips forward."],
            ["Keep back perfectly flat.", "Do not squat the weight down."],
            ["Builds the posterior chain.", "Hamstring mass."],
            ["Hamstrings", "Glutes", "Lower Back"]),

        createEx("Dumbbell Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Stand tall, dumbbells at sides, palms forward.", "Chest up."],
            ["Curl weight up to shoulders.", "Squeeze biceps hard.", "Lower all the way down."],
            ["Keep elbows fixed in space at your sides.", "Do not swing."],
            ["Classic bicep mass builder."],
            ["Biceps"]),

        createEx("Hammer Curl", ["Arms"], "Dumbbell", "Muscle Build",
            ["Stand tall, palms facing your body (Neutral Grip)."],
            ["Curl weight up, touching thumb to shoulder.", "Lower with control."],
            ["Do not use momentum.", "Keep elbows pinned."],
            ["Targets the side of the arm (brachialis) and forearm.", "Adds arm thickness."],
            ["Brachialis", "Forearms"]),

        createEx("Tricep Kickback", ["Arms"], "Dumbbell", "Muscle Build",
            ["Bent over on a bench (row position).", "Elbow high and pinned to side."],
            ["Extend arm straight back until locked out.", "Hold for 1s.", "Bend elbow back to 90 degrees."],
            ["Do not let the elbow drop during the set.", "Use light weight and focus on the squeeze."],
            ["Isolates the tricep long head.", "Good finishing move."],
            ["Triceps"]),

        createEx("Skull Crusher (DB)", ["Arms"], "Dumbbell", "Muscle Build",
            ["Lie on a bench.", "Arms extended straight up.", "Neutral grip."],
            ["Bend elbows to lower dumbbells beside your ears.", "Extend back up to ceiling.", "Keep elbows pointing up."],
            ["Don't move shoulders, only elbows.", "Feel the deep stretch."],
            ["Mass builder for triceps."],
            ["Triceps"]),

        createEx("Farmers Walk", ["Core", "Traps"], "Dumbbell", "Strength",
            ["Hold heavy dumbbells at sides.", "Stand tall, shoulders back."],
            ["Walk for distance or time.", "Prevent body from swaying.", "Grip the handles tight."],
            ["Keep head neutral.", "Steps should be controlled."],
            ["Total body stability.", "Grip strength and trap size."],
            ["Core", "Forearms", "Traps"]),

        createEx("Zottman Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Stand tall with DBs.", "Curl up with palms facing UP."],
            ["At the top, rotate wrists so palms face DOWN.", "Lower slowly with palms down."],
            ["Control the rotation.", "Keep elbows pinned."],
            ["Hits biceps on the way up, forearms on the way down."],
            ["Biceps", "Brachioradialis"]),

        createEx("Concentration Curl", ["Arms", "Biceps"], "Dumbbell", "Muscle Build",
            ["Sit on bench, legs wide.", "Hold one DB.", "Rest elbow against inner thigh."],
            ["Curl weight up towards chest.", "Squeeze at peak.", "Lower slowly."],
            ["Do not swing the body.", "Pure isolation."],
            ["Builds the 'peak' of the bicep."],
            ["Biceps"]),

        createEx("DB Floor Press", ["Chest"], "Dumbbell", "Strength",
            ["Lie on the floor with DBs.", "Knees bent, feet flat."],
            ["Press DBs up.", "Lower until triceps lightly touch the floor.", "Pause for 1s."],
            ["Don't bounce elbows off the floor.", "Explode up."],
            ["Builds lockout strength.", "Shoulder-safe pressing option."],
            ["Triceps", "Pectorals"]),

        createEx("Renegade Row", ["Back", "Core"], "Dumbbell", "Strength",
            ["Get into high plank position holding DBs on floor.", "Feet wide for balance."],
            ["Row one DB to hip while balancing on the other.", "Alternate sides.", "Keep hips level."],
            ["Fight the rotation of the hips.", "Keep core super tight."],
            ["Full body tension.", "Anti-rotation strength."],
            ["Latissimus Dorsi", "Core", "Obliques"]),

        createEx("DB Step Up", ["Legs"], "Dumbbell", "Strength",
            ["Stand in front of a box or bench.", "Hold DBs at sides."],
            ["Step one foot entirely on the box.", "Drive through the heel to stand up.", "Control the descent."],
            ["Don't push off the bottom leg.", "Keep torso upright."],
            ["Unilateral leg strength.", "Glute focus."],
            ["Glutes", "Quadriceps"]),

        createEx("DB Shrugs", ["Back", "Traps"], "Dumbbell", "Muscle Build",
            ["Hold heavy DBs at sides.", "Stand tall."],
            ["Shrug shoulders straight up to ears.", "Hold for 1s.", "Lower fully."],
            ["Do not roll shoulders.", "Movement is vertical."],
            ["Upper trap size."],
            ["Upper Traps"]),

        createEx("Seated Calf Raise", ["Legs", "Calves"], "Dumbbell", "Muscle Build",
            ["Sit on a bench.", "Place toes on a block/plate.", "Hold heavy DBs vertically on knees."],
            ["Raise heels as high as possible.", "Lower heels to floor for a stretch.", "High reps."],
            ["Targets the soleus muscle.", "Adds width to the calf."],
            ["Soleus"]),

        // ==================== BODYWEIGHT (DETAILED) ====================
        createEx("Push-ups", ["Chest"], "Bodyweight", "Calisthenics",
            ["High plank position.", "Hands directly under shoulders.", "Glutes and core tight."],
            ["Lower chest to floor.", "Elbows at 45 degree angle.", "Push back up to lockout."],
            ["No sagging hips.", "Keep neck neutral."],
            ["Chest endurance.", "Core stability."],
            ["Pectoralis Major", "Triceps", "Core"]),

        createEx("Pull-ups", ["Back"], "Bodyweight", "Calisthenics",
            ["Overhand grip (palms away).", "Hands slightly wider than shoulders.", "Dead hang."],
            ["Pull chin over the bar.", "Drive elbows down.", "Lower under control."],
            ["No kipping/swinging.", "Engage lats first."],
            ["The king of back exercises.", "Builds width."],
            ["Latissimus Dorsi", "Biceps"]),

        createEx("Chin-ups", ["Back"], "Bodyweight", "Calisthenics",
            ["Underhand grip (palms to face).", "Hands shoulder width."],
            ["Pull chest to the bar.", "Squeeze biceps at top.", "Lower fully."],
            ["Easier than pullups.", "Hits biceps harder."],
            ["Arm size.", "Back strength."],
            ["Biceps", "Latissimus Dorsi"]),

        createEx("Dips", ["Chest", "Triceps"], "Bodyweight", "Calisthenics",
            ["Support yourself on parallel bars.", "Shoulders down and back."],
            ["Lower until shoulders are below elbows (90 deg).", "Push back up.", "Lean forward for chest, upright for triceps."],
            ["Don't shrug shoulders.", "Control the descent."],
            ["The squat of the upper body.", "Mass builder."],
            ["Pectoralis Major", "Triceps"]),

        createEx("Bodyweight Squat", ["Legs"], "Bodyweight", "Calisthenics",
            ["Feet shoulder width.", "Arms out for balance."],
            ["Squat deep, hips below knees.", "Keep knees out.", "Stand up."],
            ["Keep heels down.", "Chest up."],
            ["Leg endurance.", "Mobility."],
            ["Quadriceps", "Glutes"]),

        createEx("Lunge (BW)", ["Legs"], "Bodyweight", "Calisthenics",
            ["Step forward.", "Drop back knee to floor.", "Push back to start."],
            ["Keep torso upright.", "Don't let front knee cave in."],
            ["Balance training.", "Leg endurance."],
            ["Quadriceps", "Glutes"]),

        createEx("Glute Bridge", ["Legs", "Glutes"], "Bodyweight", "Calisthenics",
            ["Lie on back.", "Knees bent, feet flat near butt."],
            ["Drive hips to ceiling.", "Squeeze glutes hard at top.", "Lower."],
            ["Don't arch lower back.", "Drive through heels."],
            ["Glute activation.", "Fixes sitting posture."],
            ["Glute Maximus"]),

        createEx("Plank", ["Core"], "Bodyweight", "Calisthenics",
            ["Forearms on floor.", "Toes on floor.", "Body in straight line."],
            ["Hold.", "Squeeze glutes and abs maximally.", "Breathe."],
            ["Don't let hips sag.", "Don't pike butt up."],
            ["Total core stability."],
            ["Transverse Abdominis"]),

        createEx("Side Plank", ["Core"], "Bodyweight", "Calisthenics",
            ["Lie on side.", "Support on one elbow."],
            ["Lift hips off floor.", "Hold straight line.", "Switch sides."],
            ["Don't let hips rotate forward."],
            ["Oblique stability.", "Spine health."],
            ["Obliques", "Quadratus Lumborum"]),

        createEx("Mountain Climbers", ["Core"], "Bodyweight", "Calisthenics",
            ["Pushup position."],
            ["Drive knees to chest alternately.", "Run in place.", "Keep hips low."],
            ["Don't bounce hips up and down.", "Keep shoulders over hands."],
            ["Cardio core.", "Calorie burn."],
            ["Core", "Cardio"]),

        createEx("Burpees", ["Full Body"], "Bodyweight", "Calisthenics",
            ["Stand.", "Drop to chest on floor.", "Jump feet in.", "Jump up clap."],
            ["Explosive movement.", "Full range of motion."],
            ["Pace yourself.", "Land softly."],
            ["Conditioning.", "Metabolic hit."],
            ["Full Body"]),

        createEx("Hanging Leg Raise", ["Core"], "Bodyweight", "Calisthenics",
            ["Hang from bar.", "Body straight."],
            ["Lift legs to L shape (straight legs) or tuck knees.", "Lower slowly.", "Avoid swinging."],
            ["Compress abs.", "Don't use momentum."],
            ["Lower abs.", "Hip flexor strength."],
            ["Rectus Abdominis", "Hip Flexors"]),

        createEx("Pike Push-up", ["Shoulders"], "Bodyweight", "Calisthenics",
            ["Start in pushup position.", "Walk feet in until hips are high (V shape)."],
            ["Lower head towards floor.", "Push back up/back."],
            ["Mimics an overhead press.", "Keep elbows tucked."],
            ["Shoulder strength without weights."],
            ["Deltoids", "Triceps"]),

        createEx("Pistol Squat", ["Legs"], "Bodyweight", "Strength",
            ["Stand on one leg.", "Extend other leg forward.", "Arms out for balance."],
            ["Squat down on standing leg.", "Go as deep as possible.", "Drive back up."],
            ["Keep heel planted.", "Use a box/bench for regression if needed."],
            ["Mastery of leg strength.", "Balance."],
            ["Quadriceps", "Glutes", "Stabilizers"]),

        createEx("Nordic Curl", ["Legs", "Hamstrings"], "Bodyweight", "Strength",
            ["Kneel on pad.", "Anchor feet under something heavy (or partner)."],
            ["Lower torso forward slowly using hamstrings.", "Control the fall as long as possible.", "Catch yourself with hands."],
            ["Push back up to start.", "Keep hips extended (no hinge)."],
            ["Bulletproofs hamstrings.", "Prevents injury."],
            ["Hamstrings"]),

        createEx("Inverted Row", ["Back"], "Bodyweight", "Calisthenics",
            ["Set a bar at waist height.", "Lie under bar.", "Grab wide."],
            ["Pull chest to bar.", "Keep body in straight plank line.", "Lower slow."],
            ["Squeeze shoulder blades together.", "Don't sag hips."],
            ["Horizontal pull.", "Back thickness."],
            ["Latissimus Dorsi", "Rhomboids"]),

        createEx("Handstand Hold", ["Shoulders"], "Bodyweight", "Calisthenics",
            ["Place hands near wall.", "Kick up so heels touch wall.", "Arms locked."],
            ["Push floor away aggressively.", "Squeeze glutes and abs.", "Hold."],
            ["Look between hands.", "Breathe."],
            ["Overhead stability.", "Shoulder strength."],
            ["Deltoids", "Triceps"]),

        createEx("Calf Raise (BW)", ["Legs", "Calves"], "Bodyweight", "Calisthenics",
            ["Stand on edge of step.", "Heels hanging off.", "Hold wall for balance."],
            ["Drive up onto toes.", "Hold squeeze.", "Lower into deep stretch."],
            ["Full range of motion is key.", "Don't bounce."],
            ["Ankle strength.", "Calf size."],
            ["Gastrocnemius"]),

        // ==================== MOBILITY & WARMUP (DETAILED) ====================
        createEx("Cat-Cow", ["Core"], "Bodyweight", "Mobility",
            ["Start on hands and knees (Tabletop).", "Neutral spine."],
            ["Arch back up towards ceiling (Cat) and exhale.", "Sag belly down towards floor (Cow) and inhale.", "Look up."],
            ["Move with your breath.", "Articulate each vertebrae."],
            ["Spine health.", "Warmup."],
            ["Spine"]),

        createEx("Dead Bug", ["Core"], "Bodyweight", "Mobility",
            ["Lie on back.", "Arms and legs in air (90 degrees).", "Back flat on floor."],
            ["Lower opposite arm and leg towards floor.", "Keep lower back glued to floor.", "Return."],
            ["If back arches, don't go as low.", "Breathe out as you extend."],
            ["Core control.", "Anti-extension."],
            ["Core", "Hip Flexors"]),

        createEx("Thoracic Extension", ["Back"], "Bodyweight", "Mobility",
            ["Place foam roller on upper back.", "Hips on floor."],
            ["Lean back over roller.", "Hands behind head for support.", "Open chest."],
            ["Relax into the stretch.", "Move roller up/down spine."],
            ["Fixes desk posture.", "Shoulder mobility."],
            ["Thoracic Spine"]),

        createEx("World's Greatest Stretch", ["Full Body"], "Bodyweight", "Mobility", 
            ["Start in a high plank position.", "Step left foot outside left hand.", "Keep back leg straight and strong."],
            ["Rotate left arm up to ceiling, looking at hand.", "Bring elbow down toward floor inside foot.", "Switch sides."],
            ["Move slowly and deliberately.", "Breathe deep into the tight spots."],
            ["Opens hips, t-spine, and ankles.", "The ultimate warmup."],
            ["Hips", "Thoracic Spine", "Hamstrings"]),

        createEx("90/90 Hip Switch", ["Legs"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Front leg bent 90¬∞ in front, back leg 90¬∞ to side.", "Torso upright."],
            ["Rotate hips to switch leg positions to the other side.", "Keep heels driven into the floor.", "Try not to use hands for support."],
            ["Stay tall through the spine.", "Move from the hips, not the lower back."],
            ["Internal and external hip rotation.", "Unlocks tight hips."],
            ["Glutes", "Hip Rotators"]),

        createEx("Shoulder Dislocates", ["Shoulders"], "Bodyweight", "Mobility", 
            ["Hold a broomstick or band with a very wide grip.", "Arms straight."],
            ["Raise arms over head and behind back.", "Touch lower back/glutes.", "Return over head to front."],
            ["Do not bend elbows.", "Shrug shoulders at the top if needed."],
            ["Shoulder girdle mobility.", "Chest opener."],
            ["Shoulders", "Pecs"]),

        createEx("Wall Slides", ["Shoulders"], "Bodyweight", "Mobility", 
            ["Stand with back against a wall.", "Feet 6 inches away.", "Press lower back, head, elbows, and wrists into wall."],
            ["Slide arms up into a 'W' then 'Y' shape.", "Maintain contact with wall at all times.", "Slide back down."],
            ["Don't let lower back arch.", "Tuck chin."],
            ["Scapular control.", "Posture correction."],
            ["Lower Traps", "External Rotators"]),

        createEx("Deep Squat Hold", ["Legs"], "Bodyweight", "Mobility", 
            ["Stand shoulder width.", "Hold a weight plate for counterbalance if needed."],
            ["Squat as deep as anatomically possible.", "Keep heels flat.", "Chest up."],
            ["Hold for 30-60 seconds.", "Use elbows to push knees out."],
            ["Ankle mobility.", "Hip opening."],
            ["Hips", "Ankles"]),

        createEx("Couch Stretch", ["Legs"], "Bodyweight", "Mobility", 
            ["Place knee against base of a wall/couch.", "Shin vertical up the wall.", "Other foot lunges forward."],
            ["Squeeze glute of the back leg.", "Raise torso upright.", "Hold."],
            ["Don't hyperextend lower back.", "Squeeze abs."],
            ["Fixes tight hip flexors from sitting.", "Quad stretch."],
            ["Hip Flexors", "Quads"]),

        createEx("Bird Dog", ["Core"], "Bodyweight", "Mobility", 
            ["Start on hands and knees (Tabletop).", "Neutral spine."],
            ["Reach opposite arm and leg straight out.", "Hold for 3s.", "Switch sides."],
            ["Imagine balancing a glass of water on your back.", "Don't rotate hips."],
            ["Core stability.", "Anti-rotation."],
            ["Core", "Glutes", "Shoulders"]),

        // ==================== CABLE VARIATIONS (TORQUE F9 DETAILED) ====================
        createEx("Cable Front Squat", ["Legs"], "Cable", "Strength", 
            ["Set Pulleys Low. Arms Narrow.", "Hold bar/handles at collarbone (rack position).", "Elbows high."],
            ["Squat deep.", "Keep torso vertical.", "Drive up."],
            ["Core works hard to stay upright.", "Fight the pull forward."],
            ["Quad dominance.", "Core strength."],
            ["Quadriceps", "Core"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Zercher Squat", ["Legs"], "Cable", "Strength", 
            ["Set Pulleys Low. Arms Narrow.", "Hold straight bar in crooks of elbows.", "Hands clasped."],
            ["Squat down.", "Keep bar close to body.", "Drive up."],
            ["Brutal on core and upper back.", "Bicep isometric."],
            ["Upper back strength.", "Leg drive."],
            ["Quadriceps", "Upper Back"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Donkey Kick", ["Legs", "Glutes"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Ankle strap.", "Hands on machine for support.", "Bent over."],
            ["Keep knee bent 90¬∞.", "Drive heel up to ceiling.", "Squeeze."],
            ["Don't extend knee.", "Movement comes from hip."],
            ["Upper glute focus.", "Shelf builder."],
            ["Glute Maximus"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Standing Cable Row", ["Back"], "Cable", "Strength", 
            ["Set Pulleys Mid. Arms Mid.", "Squat stance.", "Reach forward."],
            ["Row handles to ribs.", "Stand up slightly as you pull (dynamic).", "Sink back on return."],
            ["Use legs to stabilize.", "Fluid motion."],
            ["Functional pulling.", "Athleticism."],
            ["Latissimus Dorsi", "Legs", "Core"], {arms: "Mid", pulleys: "Mid"}),

        createEx("Lying Cable Curl", ["Arms", "Biceps"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short Bar.", "Lie on back.", "Feet braced on machine."],
            ["Curl bar to forehead/chin.", "Keep elbows fixed.", "Lower."],
            ["Strict isolation.", "No cheating."],
            ["Bicep peaks.", "Form strictness."],
            ["Biceps"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable French Press", ["Arms", "Triceps"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Rope/Bar.", "Bench/Kneel facing away.", "Arms overhead."],
            ["Bend elbows to lower weight behind head.", "Extend to ceiling.", "Keep elbows close."],
            ["Deep stretch.", "Long head focus."],
            ["Tricep size.", "Overhead strength."],
            ["Triceps (Long Head)"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Hip Abduction (Standing)", ["Legs"], "Cable", "Mobility", 
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Outer leg attached."],
            ["Lift leg out to side.", "Keep toes forward.", "Return."],
            ["Don't lean away.", "Use glute medius."],
            ["Hip stability.", "Glute shape."],
            ["Glute Medius"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Hip Adduction (Standing)", ["Legs"], "Cable", "Mobility", 
            ["Set Pulley Low. Ankle strap.", "Stand sideways.", "Inner leg attached."],
            ["Pull leg across body.", "Squeeze inner thigh.", "Return."],
            ["Balance on outer leg."],
            ["Adductor strength.", "Injury prevention."],
            ["Adductors"], {arms: "Low", pulleys: "Low"}),

        createEx("Cable Wrist Curl", ["Arms"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short bar.", "Sit on bench/floor.", "Forearms on knees."],
            ["Curl wrists up.", "Squeeze.", "Lower."],
            ["Range of motion is small."],
            ["Forearm size.", "Grip."],
            ["Flexors"], {arms: "Narrow", pulleys: "Low"}),

        createEx("Cable Reverse Wrist Curl", ["Arms"], "Cable", "Muscle Build", 
            ["Set Pulley Low. Short bar.", "Palms facing down."],
            ["Extend wrists up.", "Hold.", "Lower."],
            ["Burn is high."],
            ["Top of forearm.", "Elbow health."],
            ["Extensors"], {arms: "Narrow", pulleys: "Low"}),

        // ==================== PART 3: CARDIO, CORE & VARIATIONS (FINAL 40) ====================
        
        // --- ABS & CORE ---
        createEx("Russian Twist", ["Core"], "Bodyweight", "Calisthenics", 
            ["Sit on floor.", "Lean back 45 deg.", "Feet off floor."],
            ["Rotate torso left.", "Touch floor.", "Rotate right."],
            ["Control the twist.", "Oblique focus."],
            ["Rotational core strength."],
            ["Obliques"]),
        createEx("Bicycle Crunch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Hands behind head."],
            ["Elbow to opposite knee.", "Extend other leg."],
            ["Slow and controlled.", "Don't pull neck."],
            ["Full abdominal wall."],
            ["Rectus Abdominis", "Obliques"]),
        createEx("Flutter Kicks", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Hands under butt.", "Legs straight."],
            ["Kick legs up and down.", "Keep lower back pressed down."],
            ["Small range of motion."],
            ["Lower abs endurance."],
            ["Lower Abs"]),
        createEx("V-Ups", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie flat.", "Arms overhead."],
            ["Lift arms and legs to touch toes.", "Body forms V."],
            ["Explosive up.", "Control down."],
            ["Advanced core strength."],
            ["Rectus Abdominis"]),
        createEx("Reverse Crunch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "Knees bent 90 deg."],
            ["Curl hips off floor.", "Knees to chest.", "Lower."],
            ["Don't use momentum.", "Focus on hips curling."],
            ["Lower ab isolation."],
            ["Lower Abs"]),
        createEx("Plank Jack", ["Core", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Plank position."],
            ["Jump feet wide.", "Jump feet together."],
            ["Keep hips level."],
            ["Core conditioning."],
            ["Core"]),
        createEx("Toe Touch", ["Core"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "Legs straight up."],
            ["Crunch up to touch toes.", "Lower."],
            ["Keep legs vertical."],
            ["Upper abs."],
            ["Upper Abs"]),

        // --- PUSHUP VARIATIONS ---
        createEx("Diamond Push-up", ["Arms", "Chest"], "Bodyweight", "Calisthenics", 
            ["Hands form diamond shape.", "Under sternum."],
            ["Lower chest to hands.", "Push up."],
            ["Keep elbows tucked."],
            ["Tricep mass."],
            ["Triceps", "Inner Chest"]),
        createEx("Wide Grip Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Hands wider than shoulders."],
            ["Lower down.", "Push up."],
            ["Less tricep, more chest."],
            ["Outer chest."],
            ["Pectoralis Major"]),
        createEx("Decline Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Feet on bench/chair.", "Hands on floor."],
            ["Push up motion."],
            ["Harder variation."],
            ["Upper chest focus."],
            ["Upper Pecs"]),
        createEx("Incline Push-up", ["Chest"], "Bodyweight", "Calisthenics", 
            ["Hands on bench.", "Feet on floor."],
            ["Push up motion."],
            ["Easier variation."],
            ["Lower chest."],
            ["Lower Pecs"]),
        createEx("Scapular Push-up", ["Back", "Shoulders"], "Bodyweight", "Mobility", 
            ["Plank position.", "Arms locked straight."],
            ["Squeeze shoulder blades together.", "Push them apart."],
            ["Tiny range of motion.", "Straight arms."],
            ["Shoulder health."],
            ["Serratus Anterior"]),

        // --- LEG VARIATIONS ---
        createEx("Sumo Squat (DB)", ["Legs"], "Dumbbell", "Strength", 
            ["Wide stance.", "Toes out.", "Hold DB between legs."],
            ["Squat deep.", "Knees track over toes."],
            ["Upright torso."],
            ["Inner thigh focus."],
            ["Adductors", "Quads"]),
        createEx("Curtsy Lunge", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Stand tall."],
            ["Step leg behind and across.", "Lunge down."],
            ["Hip stability."],
            ["Glute medius."],
            ["Glutes"]),
        createEx("Side Lunge", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Step wide to side.", "Keep other leg straight."],
            ["Sit hips back on bent leg.", "Return."],
            ["Inner thigh stretch."],
            ["Lateral movement."],
            ["Adductors", "Quads"]),
        createEx("Single Leg Glute Bridge", ["Legs", "Glutes"], "Bodyweight", "Calisthenics", 
            ["Lie back.", "One leg up.", "One foot flat."],
            ["Drive hip up.", "Squeeze glute.", "Lower."],
            ["Don't twist hips."],
            ["Glute isolation."],
            ["Glutes"]),
        createEx("Good Morning (BW)", ["Legs"], "Bodyweight", "Mobility", 
            ["Hands behind head.", "Knees soft."],
            ["Hinge hips back.", "Back flat.", "Stand up."],
            ["Feel hamstring stretch."],
            ["Hinge pattern practice."],
            ["Hamstrings", "Lower Back"]),

        // --- CARDIO & PLYO ---
        createEx("Jumping Jacks", ["Cardio"], "Bodyweight", "Calisthenics", 
            ["Stand tall."],
            ["Jump feet wide, hands up.", "Jump back."],
            ["Rhythmic."],
            ["Warmup."],
            ["Full Body"]),
        createEx("High Knees", ["Cardio"], "Bodyweight", "Calisthenics", 
            ["Run in place."],
            ["Drive knees to waist height."],
            ["Fast pace."],
            ["Heart rate."],
            ["Legs", "Cardio"]),
        createEx("Jump Squat", ["Legs", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Squat down."],
            ["Explode up.", "Jump off floor.", "Land soft."],
            ["Power."],
            ["Leg power."],
            ["Quads"]),
        createEx("Skater Hops", ["Cardio", "Legs"], "Bodyweight", "Calisthenics", 
            ["Hop sideways to one foot.", "Swing other leg behind."],
            ["Explode back to other side."],
            ["Lateral power."],
            ["Athleticism."],
            ["Glutes", "Cardio"]),
        createEx("Jumping Lunge", ["Legs", "Cardio"], "Bodyweight", "Calisthenics", 
            ["Lunge position."],
            ["Jump and switch legs in air.", "Land in lunge."],
            ["Advanced."],
            ["Leg burn."],
            ["Quads", "Cardio"]),
        createEx("Box Jump", ["Legs"], "Bodyweight", "Calisthenics", 
            ["Stand before box."],
            ["Jump onto box.", "Stand tall.", "Step down."],
            ["Explosive hips."],
            ["Power."],
            ["Quads", "Glutes"]),

        // --- BACK & ARM VARIATIONS ---
        createEx("Superman", ["Back"], "Bodyweight", "Calisthenics", 
            ["Lie on stomach.", "Arms forward."],
            ["Lift arms and legs off floor.", "Hold.", "Lower."],
            ["Squeeze lower back."],
            ["Posterior chain."],
            ["Lower Back", "Glutes"]),
        createEx("Swimmers", ["Back"], "Bodyweight", "Calisthenics", 
            ["Lie on stomach."],
            ["Paddle opposite arm/leg up and down."],
            ["Keep off floor."],
            ["Endurance."],
            ["Lower Back"]),
        createEx("Bench Dip", ["Arms", "Triceps"], "Bodyweight", "Calisthenics", 
            ["Hands on bench behind you.", "Legs straight out."],
            ["Lower hips.", "Push up."],
            ["Don't go too deep."],
            ["Tricep burnout."],
            ["Triceps"]),
        createEx("Close Grip Push-up", ["Arms", "Triceps"], "Bodyweight", "Calisthenics", 
            ["Hands inside shoulder width."],
            ["Elbows rub ribs.", "Push up."],
            ["Tricep focus."],
            ["Arm size."],
            ["Triceps"]),
        createEx("Plate Pinch", ["Arms"], "Free Weight", "Strength", 
            ["Hold weight plates in fingertips."],
            ["Walk or hold for time."],
            ["Don't use thumbs if possible."],
            ["Forearm strength."],
            ["Forearms"]),
        createEx("Svend Press", ["Chest"], "Free Weight", "Strength", 
            ["Stand.", "Squeeze plate between palms at chest."],
            ["Press out.", "Keep squeezing hard.", "Return."],
            ["Inner chest activation."],
            ["Isometric squeeze."],
            ["Inner Pecs"]),
        
        // --- FINAL CABLE VARIATIONS ---
        createEx("Cable Curl (Behind Back)", ["Arms", "Biceps"], "Cable", "Muscle Build", 
            ["Set Low. Face away.", "One hand handle."],
            ["Arm behind body.", "Curl forward."],
            ["Stretch focus."],
            ["Bicep length."],
            ["Biceps"], {arms: "Low", pulleys: "Low"}),
        createEx("Cable Row (Wide Grip)", ["Back"], "Cable", "Strength", 
            ["Set Low. Wide bar.", "Sit."],
            ["Row to upper abs.", "Elbows wide."],
            ["Upper back focus."],
            ["Width."],
            ["Rear Delts", "Rhomboids"], {arms: "Narrow", pulleys: "Low"}),
        createEx("Standing Cable Crunch", ["Core"], "Cable", "Muscle Build", 
            ["Set High. Rope.", "Face away."],
            ["Crunch forward.", "Elbows to chest."],
            ["Standing abs."],
            ["Core."],
            ["Abs"], {arms: "Narrow", pulleys: "Top"}),
        // ==================== NIMBLE / LONGEVITY / FLOW (NEW 25) ====================
        
        // --- ANIMAL FLOW & GROUND ---
        createEx("Bear Crawl", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Hands and knees.", "Knees hover 1 inch off floor."], ["Crawl forward opposite hand/foot.", "Keep back flat."], ["Imagine a glass of water on your back."], ["Shoulder stability.", "Core."], ["Core", "Shoulders"]),
        createEx("Crab Walk", ["Nimble", "Shoulders"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Hands behind hips.", "Lift hips."], ["Walk backwards/forwards."], ["Open chest.", "Squeeze glutes."], ["Posterior chain.", "Shoulder mobility."], ["Triceps", "Glutes"]),
        createEx("Kick Through", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Bear crawl position."], ["Rotate hips.", "Kick leg through to side.", "Lift opposite hand."], ["Pivot on foot."], ["Rotational agility."], ["Obliques", "Hips"]),
        createEx("Beast Reach", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Loaded Beast (Child's pose but knees off floor)."], ["Wave forward into plank.", "Drive one knee to elbow.", "Return."], ["Flow smoothly."], ["Spine wave."], ["Spine", "Core"]),
        createEx("Duck Walk", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Deep squat position."], ["Walk forward staying low."], ["Keep chest up.", "Heels can lift."], ["Ankle mobility.", "Hip strength."], ["Quads", "Ankles"]),

        // --- JOINT BULLETPROOFING ---
        createEx("Tibialis Raise", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Lean butt against wall.", "Legs straight out."], ["Lift toes to shins.", "Lower."], ["Feel burn in shins."], ["Bulletproof knees.", "Shin splint help."], ["Tibialis Anterior"]),
        createEx("ATG Split Squat", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Long lunge stance."], ["Push front knee WAY over toe.", "Back leg straight."], ["Cover calf with hamstring."], ["Ankle/Hip mobility."], ["VMO", "Hip Flexors"]),
        createEx("Lu Raise", ["Nimble", "Shoulders"], "Dumbbell", "Mobility", 
            ["Light plates/DBs.", "Stand tall."], ["Lateral raise ALL the way overhead.", "Touch plates at top."], ["Control down."], ["Full scapular movement."], ["Side Delts", "Traps"]),
        createEx("Powell Raise", ["Nimble", "Shoulders"], "Dumbbell", "Strength", 
            ["Lie on side.", "Top arm holds DB."], ["Raise straight arm to vertical."], ["Control down across chest."], ["Scapular health."], ["Rear Delts", "Rhomboids"]),
        createEx("Wrist Rocks", ["Nimble", "Arms"], "Bodyweight", "Mobility", 
            ["Hands and knees.", "Fingers forward/back/side."], ["Rock weight gently over wrists."], ["Elbows locked."], ["Wrist prep for pushups."], ["Forearms"]),
        createEx("Dead Hang", ["Nimble", "Back"], "Bodyweight", "Strength", 
            ["Grab pullup bar."], ["Hang completely loose.", "Relax shoulders."], ["Deep breaths."], ["Spine decompression.", "Grip."], ["Lats", "Forearms"]),

        // --- DYNAMIC MOBILITY ---
        createEx("Cossack Squat", ["Nimble", "Legs"], "Bodyweight", "Mobility", 
            ["Wide stance.", "Toes out."], ["Squat to ONE side.", "Other leg straight, toe up."], ["Stay low, switch sides."], ["Hip mobility.", "Groin."], ["Adductors", "Quads"]),
        createEx("Jefferson Curl", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Stand tall.", "Hold light weight (optional)."], ["Tuck chin.", "Roll down one vertebrae at a time.", "Reach floor."], ["Roll up slow."], ["Spine articulation."], ["Spine", "Hamstrings"]),
        createEx("Scorpion Stretch", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Lie on stomach.", "Arms wide."], ["Kick one leg up and over to opposite hand."], ["Touch floor."], ["Dynamic hip/spine twist."], ["Hips", "Spine"]),
        createEx("Inchworm", ["Nimble", "Core"], "Bodyweight", "Mobility", 
            ["Stand.", "Hinge to floor."], ["Walk hands out to plank.", "Walk feet to hands."], ["Keep legs straight."], ["Hamstring stretch."], ["Hamstrings", "Shoulders"]),
        createEx("Thoracic Bridge", ["Nimble", "Back"], "Bodyweight", "Mobility", 
            ["Sit on floor.", "Hands behind."], ["Drive hips up.", "Reach one arm overhead and across."], ["Look at hand."], ["T-Spine opener."], ["Spine", "Glutes"]),

        // --- AGILITY & PROPRIOCEPTION ---
        createEx("Single Leg RDL (BW)", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Stand on one leg."], ["Hinge forward.", "Extend back leg straight."], ["Body creates 'T' shape.", "Return."], ["Balance.", "Hamstring."], ["Hamstrings", "Glutes"]),
        createEx("Lateral Bounds", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Stand on right leg."], ["Jump laterally to left leg.", "Stick the landing."], ["Pause.", "Jump back."], ["Lateral power.", "Stability."], ["Glutes", "Adductors"]),
        createEx("Dot Drill", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Imagine 5 dots (dice 5)."], ["Hop feet between dots fast."], ["pattern variations."], ["Fast feet."], ["Calves", "Coordination"]),
        createEx("Tuck Jumps", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Stand tall."], ["Jump high.", "Tuck knees to chest."], ["Land soft.", "Repeat fast."], ["Explosive power."], ["Quads", "Core"]),
        createEx("A-Skips", ["Nimble", "Cardio"], "Bodyweight", "Plyo", 
            ["Skip forward."], ["Drive knee high.", "Drive opposite arm."], ["Rhythm and bounce."], ["Sprinting mechanics."], ["Hip Flexors", "Calves"]),

        // --- ISOMETRIC & TENDON ---
        createEx("Horse Stance Hold", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Wide stance.", "Squat until thighs parallel."], ["Back vertical.", "Knees out."], ["Hold for time."], ["Mental toughness.", "Hips."], ["Quads", "Adductors"]),
        createEx("Reverse Plank", ["Nimble", "Core"], "Bodyweight", "Strength", 
            ["Sit legs straight.", "Hands behind hips."], ["Drive hips to ceiling.", "Straight line."], ["Squeeze glutes."], ["Posterior chain."], ["Lower Back", "Glutes"]),
        createEx("Copenhagen Plank", ["Nimble", "Legs"], "Bodyweight", "Strength", 
            ["Side plank.", "Top leg on bench.", "Bottom leg floating."], ["Hold."], ["Brutal inner thigh work."], ["Groin health."], ["Adductors"]),
        createEx("L-Sit (Tuck)", ["Nimble", "Core"], "Bodyweight", "Calisthenics", 
            ["Hands on floor/parallettes."], ["Press down.", "Lift butt and knees off floor."], ["Hold tuck."], ["Core compression."], ["Abs", "Hip Flexors"])
]; // END EXERCISE DATA
</script>

<script>
// 1. SAFETY CHECK
if(typeof window.allExercises === 'undefined') {
    alert("CRITICAL ERROR: Exercise list failed to load. Check for syntax errors (missing commas/quotes) in your list.");
    window.allExercises = []; // Prevent total crash
}


// ========================================
// GLOBAL STATE
// ========================================
let appState = {
    currentWorkout: null,
    currentSetIndex: {},
    activePlan: null,
    equipment: 'home',
    voiceEnabled: true,
    voiceLevel: 'standard',
    selectedExercises: [],
    exerciseCount: 6,
    builderFilter: 'all'
};

// ========================================
// INITIALIZATION
// ========================================
window.onload = () => {
    loadAppState();
    renderPlanCalendar();
    renderEquipmentPresets();
    updateTodaysBanner();
    renderEncyclopedia();
    updateSettingsUI();
};

function loadAppState() {
    const saved = localStorage.getItem('nimbleState_v45');
    if(saved) {
        try {
            appState = {...appState, ...JSON.parse(saved)};
        } catch(e) {}
    }
    if(!appState.activePlan) {
        appState.activePlan = createDefaultPlan();
    }
}

function saveAppState() {
    localStorage.setItem('nimbleState_v45', JSON.stringify(appState));
}

function createDefaultPlan() {
    return {
        name: '5-Day Balanced',
        frequency: 5,
        schedule: {0:'rest',1:'push',2:'cardio',3:'pull',4:'rest',5:'legs',6:'nimble'},
        week: 1,
        phase: 'Foundation'
    };
}

// ========================================
// NAVIGATION
// ========================================
function switchTab(tab) {
    document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    
    const container = document.getElementById('view-' + tab);
    if(container) container.classList.add('active');
    
    if(event?.target) {
        const btn = event.target.closest('.nav-btn');
        if(btn) btn.classList.add('active');
    }
    
    if(tab === 'plan') renderPlanCalendar();
    if(tab === 'cardio') loadCardioHistory();
    if(tab === 'encyclopedia') renderEncyclopedia();
    if(tab === 'settings') updateSettingsUI();
}

// ========================================
// WORKOUT GENERATION
// ========================================
function quickStartWorkout(type) {
    const exercises = generateWorkoutByType(type, appState.exerciseCount);
    
    // Store workout type for warmup
    appState.currentWorkoutType = type;
    appState.currentWorkout = exercises;
    appState.currentSetIndex = {};
    saveAppState();
    
    // Start warmup for push/pull/legs workouts
    if(['push', 'pull', 'legs'].includes(type.toLowerCase())) {
        startWarmup(type);
        renderWorkout(exercises);
    } else {
        startWorkout(exercises);
    }
}

function updateExerciseCount(value) {
    appState.exerciseCount = parseInt(value);
    document.getElementById('exercise-count-display').textContent = value;
    saveAppState();
}

function generateRandomWorkout() {
    const types = ['push', 'pull', 'legs'];
    const randomType = types[Math.floor(Math.random() * types.length)];
    quickStartWorkout(randomType);
}

function generateWorkoutByType(type, count = 6) {
    let filtered = window.allExercises.filter(ex => {
        if(type === 'push') return ex.cat.some(c => ['Chest','Shoulders','Triceps'].includes(c));
        if(type === 'pull') return ex.cat.some(c => ['Back','Lats','Biceps'].includes(c));
        if(type === 'legs') return ex.cat.some(c => ['Legs','Quads','Hamstrings','Glutes'].includes(c));
        if(type === 'nimble') return ex.cat.includes('Nimble') || ex.type === 'Mobility';
        if(type === 'full') return true;
        return true;
    });
    
    // Apply equipment filter
    filtered = filterExercisesByEquipment(filtered);
    
    // Shuffle and take count
    filtered.sort(() => 0.5 - Math.random());
    return filtered.slice(0, count);
}

function filterExercisesByEquipment(exercises) {
    const presets = {
        home: ['Cable', 'Dumbbell', 'Bodyweight', 'Bench', 'Bands'],
        hotel: ['Bodyweight', 'Bands'],
        gym: ['All']
    };
    
    const available = presets[appState.equipment] || presets.gym;
    if(available.includes('All')) return exercises;
    
    return exercises.filter(ex => 
        available.includes(ex.equip) || ex.equip === 'Bodyweight'
    );
}

function startWorkout(exercises) {
    appState.currentWorkout = exercises;
    appState.currentSetIndex = {};
    saveAppState();
    
    document.getElementById('workout-interface').style.display = 'block';
    document.getElementById('workout-interface').scrollIntoView({behavior:'smooth'});
    
    renderWorkout(exercises);
    speak('Workout started! Let\'s get it done!');
}

// ========================================
// PROGRESSIVE SET DISPLAY
// ========================================
function renderWorkout(exercises) {
    const container = document.getElementById('workout-list');
    container.innerHTML = '';
    
    exercises.forEach((ex, idx) => {
        const card = document.createElement('div');
        card.className = 'card exercise-card';
        
        const progression = getProgression(ex.name);
        const setsCompleted = appState.currentSetIndex[ex.name] || 0;
        const setData = getTodaysSetData(ex.name);
        
        let html = `
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <div>
                    <h3 style="margin:0;">${ex.name}</h3>
                    <div class="text-muted">${ex.cat.join(', ')} ‚Ä¢ ${ex.equip}</div>
                </div>
                <div style="text-align:right;">
                    ${progression.suggest ? `<div class="progression-badge">${progression.suggest}</div>` : ''}
                    <button class="btn-small btn-action" onclick="viewExerciseDetails('${ex.name.replace(/'/g,"\\'")}')">
                        ‚ÑπÔ∏è
                    </button>
                </div>
            </div>
        `;
        
        if(progression.lastWorkout) {
            html += `<div style="background:#1a1a1a; padding:8px; border-radius:6px; margin-bottom:10px; font-size:0.85em;">
                üìä Last: ${progression.lastWorkout.weight} lbs √ó ${progression.lastWorkout.reps.join(',')} reps
            </div>`;
        }
        
        // Completed sets
        for(let i = 0; i < setsCompleted; i++) {
            const set = setData[i];
            if(set) {
                html += `<div class="set-completed">
                    <span>‚úÖ Set ${i+1}: ${set.weight} lbs √ó ${set.reps} reps</span>
                </div>`;
            }
        }
        
        // Current set
        if(setsCompleted < 3) {
            const suggestedWeight = progression.suggestedWeight || 100;
            html += `
                <div class="set-active">
                    <strong>Set ${setsCompleted + 1} of 3</strong>
                    <div class="row" style="margin-top:10px;">
                        <div style="flex:1;">
                            <small class="text-muted">Weight (lbs)</small>
                            <input type="number" id="weight-${idx}" value="${suggestedWeight}" step="5">
                        </div>
                        <div style="flex:1;">
                            <small class="text-muted">Reps</small>
                            <input type="number" id="reps-${idx}" value="10" step="1">
                        </div>
                    </div>
                    <button class="btn btn-main" onclick="logSet('${ex.name.replace(/'/g,"\\'")}', ${idx})">
                        ‚úì Log Set
                    </button>
                </div>
            `;
        } else {
            html += `<div style="text-align:center; padding:15px; background:#1a4d2e; border-radius:6px;">
                ‚úÖ Exercise Complete!
            </div>`;
        }
        
        card.innerHTML = html;
        container.appendChild(card);
    });
    
    // Check if all complete
    const allDone = exercises.every(ex => (appState.currentSetIndex[ex.name] || 0) >= 3);
    if(allDone) {
        const btn = document.createElement('button');
        btn.className = 'btn btn-success';
        btn.textContent = 'üéâ Workout Complete!';
        btn.onclick = finishWorkout;
        container.appendChild(btn);
    }
}

function logSet(exerciseName, idx) {
    const weight = parseFloat(document.getElementById(`weight-${idx}`).value);
    const reps = parseInt(document.getElementById(`reps-${idx}`).value);
    
    if(!weight || !reps) {
        alert('Enter weight and reps');
        return;
    }
    
    // Save to history
    saveSetToHistory(exerciseName, {weight, reps, date: new Date().toISOString()});
    
    // Increment counter
    if(!appState.currentSetIndex[exerciseName]) appState.currentSetIndex[exerciseName] = 0;
    appState.currentSetIndex[exerciseName]++;
    
    saveAppState();
    renderWorkout(appState.currentWorkout);
    speak('Set logged!');
}

function saveSetToHistory(name, setData) {
    const today = new Date().toISOString().split('T')[0];
    let history = JSON.parse(localStorage.getItem('exerciseHistory')) || {};
    if(!history[name]) history[name] = [];
    history[name].push({...setData, sessionDate: today});
    localStorage.setItem('exerciseHistory', JSON.stringify(history));
}

function getTodaysSetData(name) {
    const today = new Date().toISOString().split('T')[0];
    const history = JSON.parse(localStorage.getItem('exerciseHistory')) || {};
    return (history[name] || []).filter(s => s.sessionDate === today);
}

function getProgression(name) {
    const history = JSON.parse(localStorage.getItem('exerciseHistory')) || {};
    const exerciseHistory = history[name] || [];
    
    if(exerciseHistory.length < 3) return {lastWorkout:null, suggest:null, suggestedWeight:100};
    
    const today = new Date().toISOString().split('T')[0];
    const past = exerciseHistory.filter(s => s.sessionDate !== today);
    
    if(past.length < 3) return {lastWorkout:null, suggest:null, suggestedWeight:100};
    
    // Get last 3 sets
    const lastSession = past.slice(-3);
    const avgWeight = lastSession.reduce((sum,s) => sum + s.weight, 0) / 3;
    const avgReps = lastSession.reduce((sum,s) => sum + s.reps, 0) / 3;
    
    let suggested = avgWeight;
    let hint = null;
    
    if(avgReps >= 10) {
        suggested = avgWeight + 5;
        hint = '+5 lbs';
    }
    
    return {
        lastWorkout: {weight: avgWeight, reps: lastSession.map(s => s.reps)},
        suggest: hint,
        suggestedWeight: Math.round(suggested)
    };
}

function endWorkout() {
    if(confirm('End workout early?')) {
        document.getElementById('workout-interface').style.display = 'none';
        appState.currentWorkout = null;
        appState.currentSetIndex = {};
        saveAppState();
    }
}

function finishWorkout() {
    const today = new Date().getDay();
    markDayCompleted(today);
    
    document.getElementById('workout-interface').style.display = 'none';
    appState.currentWorkout = null;
    appState.currentSetIndex = {};
    saveAppState();
    
    alert('Workout saved! Great job! üí™');
    speak('Workout complete! Great work!');
}

function markDayCompleted(dayIndex) {
    const date = getDateForDay(dayIndex);
    let completed = JSON.parse(localStorage.getItem('completedWorkouts')) || {};
    completed[date] = true;
    localStorage.setItem('completedWorkouts', JSON.stringify(completed));
    renderPlanCalendar();
}

function getDateForDay(dayIndex) {
    const today = new Date();
    const diff = dayIndex - today.getDay();
    const target = new Date(today);
    target.setDate(today.getDate() + diff);
    return target.toISOString().split('T')[0];
}

// ========================================
// CUSTOM WORKOUT BUILDER
// ========================================
function openCustomBuilder() {
    appState.selectedExercises = [];
    document.getElementById('custom-builder-modal').classList.add('active');
    renderBuilderExerciseList();
    updateSelectedCount();
}

function closeCustomBuilder() {
    document.getElementById('custom-builder-modal').classList.remove('active');
}

function updateExerciseCount(value) {
    appState.exerciseCount = parseInt(value);
    document.getElementById('exercise-count-display').textContent = value;
    saveAppState();
}

function searchBuilderExercises() {
    renderBuilderExerciseList();
}

function filterBuilder(category) {
    appState.builderFilter = category;
    
    document.querySelectorAll('#custom-builder-modal .chip').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
    
    renderBuilderExerciseList();
}

function renderBuilderExerciseList() {
    const container = document.getElementById('builder-exercise-list');
    const searchTerm = document.getElementById('builder-search').value.toLowerCase();
    
    let exercises = window.allExercises;
    
    // Apply filter
    if(appState.builderFilter !== 'all') {
        exercises = exercises.filter(ex => 
            ex.cat.includes(appState.builderFilter) || ex.equip === appState.builderFilter
        );
    }
    
    // Apply search
    if(searchTerm) {
        exercises = exercises.filter(ex => ex.name.toLowerCase().includes(searchTerm));
    }
    
    // Apply equipment
    exercises = filterExercisesByEquipment(exercises);
    
    container.innerHTML = '';
    exercises.slice(0, 50).forEach(ex => {
        const div = document.createElement('div');
        div.className = 'exercise-list-item';
        if(appState.selectedExercises.some(e => e.name === ex.name)) {
            div.classList.add('selected');
        }
        
        div.innerHTML = `
            <div style="display:flex; justify-content:space-between;">
                <div>
                    <strong>${ex.name}</strong><br>
                    <small class="text-muted">${ex.cat.join(', ')} ‚Ä¢ ${ex.equip}</small>
                </div>
                <button class="btn-small btn-action" onclick="event.stopPropagation(); viewExerciseDetails('${ex.name.replace(/'/g,"\\'")}')">
                    ‚ÑπÔ∏è
                </button>
            </div>
        `;
        
        div.onclick = () => toggleExerciseSelection(ex);
        container.appendChild(div);
    });
}

function toggleExerciseSelection(exercise) {
    const index = appState.selectedExercises.findIndex(e => e.name === exercise.name);
    
    if(index > -1) {
        appState.selectedExercises.splice(index, 1);
    } else {
        if(appState.selectedExercises.length < appState.exerciseCount) {
            appState.selectedExercises.push(exercise);
        } else {
            alert(`Maximum ${appState.exerciseCount} exercises selected`);
            return;
        }
    }
    
    renderBuilderExerciseList();
    updateSelectedCount();
}

function updateSelectedCount() {
    const countEl = document.getElementById('selected-count');
    if(countEl) {
        countEl.textContent = appState.selectedExercises.length;
    }
}

function startCustomWorkout() {
    if(appState.selectedExercises.length === 0) {
        alert('Select at least one exercise');
        return;
    }
    
    closeCustomBuilder();
    startWorkout(appState.selectedExercises);
}

// ========================================
// EXERCISE ENCYCLOPEDIA
// ========================================
function renderEncyclopedia() {
    const container = document.getElementById('encyclopedia-list');
    if(!container) return;
    
    const searchTerm = document.getElementById('encyclopedia-search')?.value.toLowerCase() || '';
    
    let exercises = window.allExercises;
    
    if(searchTerm) {
        exercises = exercises.filter(ex => ex.name.toLowerCase().includes(searchTerm));
    }
    
    container.innerHTML = '';
    exercises.slice(0, 30).forEach(ex => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.cursor = 'pointer';
        card.onclick = () => viewExerciseDetails(ex.name);
        
        card.innerHTML = `
            <h3 style="margin:0 0 5px 0;">${ex.name}</h3>
            <div class="text-muted">${ex.cat.join(', ')} ‚Ä¢ ${ex.equip} ‚Ä¢ ${ex.type}</div>
        `;
        
        container.appendChild(card);
    });
}

function searchEncyclopedia() {
    renderEncyclopedia();
}

function filterEncyclopedia(category) {
    document.querySelectorAll('#view-encyclopedia .chip').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
    
    const container = document.getElementById('encyclopedia-list');
    let exercises = window.allExercises;
    
    if(category !== 'all') {
        exercises = exercises.filter(ex => 
            ex.cat.includes(category) || ex.equip === category
        );
    }
    
    container.innerHTML = '';
    exercises.slice(0, 30).forEach(ex => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.cursor = 'pointer';
        card.onclick = () => viewExerciseDetails(ex.name);
        
        card.innerHTML = `
            <h3 style="margin:0 0 5px 0;">${ex.name}</h3>
            <div class="text-muted">${ex.cat.join(', ')} ‚Ä¢ ${ex.equip} ‚Ä¢ ${ex.type}</div>
        `;
        
        container.appendChild(card);
    });
}

function viewExerciseDetails(exerciseName) {
    const exercise = window.allExercises.find(ex => ex.name === exerciseName);
    if(!exercise) return;
    
    document.getElementById('exercise-detail-name').textContent = exercise.name;
    
    const content = document.getElementById('exercise-detail-content');
    let html = `
        <div class="text-muted" style="margin-bottom:15px;">
            ${exercise.cat.join(', ')} ‚Ä¢ ${exercise.equip} ‚Ä¢ ${exercise.type}
        </div>
    `;
    
    // GIF/Image placeholder
    const gifUrl = localStorage.getItem(`gif_${exercise.name}`);
    if(gifUrl) {
        html += `
            <div class="gif-container">
                <img src="${gifUrl}" alt="${exercise.name}">
            </div>
            <div class="gif-actions">
                <button class="btn-small btn-action" onclick="openGifSearch('${exercise.name.replace(/'/g,"\\'")}')">üîç Replace Image</button>
                <button class="btn-small btn-danger" onclick="removeExerciseGif('${exercise.name.replace(/'/g,"\\'")}')">üóëÔ∏è Remove</button>
            </div>
        `;
    } else {
        html += `
            <div class="gif-container">
                <div>
                    <p class="text-muted">No image added yet</p>
                </div>
            </div>
            <div class="gif-actions">
                <button class="btn-small btn-success" onclick="openGifSearch('${exercise.name.replace(/'/g,"\\'")}')">üîç Search Images</button>
                <label class="btn-small btn-action">
                    üì§ Upload Image
                    <input type="file" accept="image/*" onchange="uploadExerciseGif('${exercise.name.replace(/'/g,"\\'")}', event)" style="display:none;">
                </label>
            </div>
        `;
    }
    
    // Preparation
    if(exercise.guide.prep && exercise.guide.prep.length > 0) {
        html += `
            <div class="encyclopedia-section">
                <h4>üéØ PREPARATION</h4>
                <ul>
                    ${exercise.guide.prep.map(p => `<li>${p}</li>`).join('')}
                </ul>
            </div>
        `;
    }
    
    // Execution
    if(exercise.guide.exec && exercise.guide.exec.length > 0) {
        html += `
            <div class="encyclopedia-section">
                <h4>‚ñ∂Ô∏è EXECUTION</h4>
                <ul>
                    ${exercise.guide.exec.map(e => `<li>${e}</li>`).join('')}
                </ul>
            </div>
        `;
    }
    
    // Tips
    if(exercise.guide.tips && exercise.guide.tips.length > 0) {
        html += `
            <div class="encyclopedia-section">
                <h4>üí° TIPS</h4>
                <ul>
                    ${exercise.guide.tips.map(t => `<li>${t}</li>`).join('')}
                </ul>
            </div>
        `;
    }
    
    // Benefits
    if(exercise.guide.benefits && exercise.guide.benefits.length > 0) {
        html += `
            <div class="encyclopedia-section">
                <h4>‚ú® BENEFITS</h4>
                <ul>
                    ${exercise.guide.benefits.map(b => `<li>${b}</li>`).join('')}
                </ul>
            </div>
        `;
    }
    
    // Muscles
    if(exercise.guide.muscles && exercise.guide.muscles.length > 0) {
        html += `
            <div class="encyclopedia-section">
                <h4>üí™ TARGET MUSCLES</h4>
                <div>
                    ${exercise.guide.muscles.map(m => `<span class="muscle-badge">${m}</span>`).join('')}
                </div>
            </div>
        `;
    }
    
    // Setup (if Torque F9)
    if(exercise.setup && (exercise.setup.arms !== 'N/A' || exercise.setup.pulleys !== 'N/A')) {
        html += `
            <div class="encyclopedia-section">
                <h4>üîß TORQUE F9 SETUP</h4>
                <p><strong>Arms:</strong> ${exercise.setup.arms}</p>
                <p><strong>Pulleys:</strong> ${exercise.setup.pulleys}</p>
            </div>
        `;
    }
    
    content.innerHTML = html;
    document.getElementById('exercise-detail-modal').classList.add('active');
}

function closeExerciseDetail() {
    document.getElementById('exercise-detail-modal').classList.remove('active');
}

function uploadExerciseGif(exerciseName, event) {
    const file = event.target.files[0];
    if(!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        localStorage.setItem(`gif_${exerciseName}`, e.target.result);
        viewExerciseDetails(exerciseName); // Refresh
        speak('GIF uploaded');
    };
    reader.readAsDataURL(file);
}

// ========================================
// PLAN CALENDAR
// ========================================
function renderPlanCalendar() {
    const grid = document.getElementById('week-grid');
    if(!grid) return;
    
    grid.innerHTML = '';
    const plan = appState.activePlan;
    const days = ['S','M','T','W','T','F','S'];
    
    days.forEach((letter, idx) => {
        const type = plan.schedule[idx] || 'rest';
        const bubble = document.createElement('div');
        bubble.className = `day-bubble workout-type-${type}`;
        bubble.onclick = () => editDay(idx);
        
        const icon = {push:'üí™',pull:'üèãÔ∏è',legs:'ü¶µ',cardio:'üö¥',nimble:'üßò',rest:'üò¥'}[type] || 'üî•';
        const completed = isDayCompleted(idx);
        
        bubble.innerHTML = `
            <div class="day-icon">${icon}</div>
            <div class="day-letter">${letter}</div>
            <div class="day-type">${type.substring(0,4)}</div>
            ${completed ? '<div class="day-check">‚úÖ</div>' : ''}
        `;
        
        grid.appendChild(bubble);
    });
    
    updatePhaseDisplay();
    updateAiCoach(); // Update AI coach suggestions
}

function editDay(idx) {
    const plan = appState.activePlan;
    const types = ['rest','push','pull','legs','cardio','nimble'];
    const current = types.indexOf(plan.schedule[idx]);
    plan.schedule[idx] = types[(current + 1) % types.length];
    saveAppState();
    renderPlanCalendar();
}

function isDayCompleted(idx) {
    const date = getDateForDay(idx);
    const completed = JSON.parse(localStorage.getItem('completedWorkouts')) || {};
    return completed[date] === true;
}

function updatePhaseDisplay() {
    const el = document.getElementById('phase-display');
    if(el) el.textContent = `Week ${appState.activePlan.week} - ${appState.activePlan.phase}`;
    
    const plan = appState.activePlan;
    let done = 0, total = 0;
    
    for(let i = 0; i < 7; i++) {
        if(plan.schedule[i] !== 'rest') {
            total++;
            if(isDayCompleted(i)) done++;
        }
    }
    
    const adherence = document.getElementById('adherence-display');
    if(adherence) adherence.textContent = `${done}/${total}`;
}

// ========================================
// PLAN GENERATOR
// ========================================
let planData = {};

function openPlanGenerator() {
    planData = {};
    document.getElementById('plan-generator-modal').classList.add('active');
    showGenStep(1);
}

function closePlanGenerator() {
    document.getElementById('plan-generator-modal').classList.remove('active');
}

function showGenStep(step) {
    for(let i = 1; i <= 3; i++) {
        const el = document.getElementById(`generator-step-${i}`);
        if(el) el.style.display = i === step ? 'block' : 'none';
    }
}

function selectFrequency(days) {
    planData.frequency = days;
    event.target.classList.add('active');
    setTimeout(() => showGenStep(2), 300);
}

function selectGoal(goal) {
    planData.goal = goal;
    event.target.classList.add('active');
    
    // Generate plan based on holistic focus
    const schedules = {
        3: {0:'rest',1:'push',2:'rest',3:'pull',4:'rest',5:'legs',6:'rest'},
        4: {0:'rest',1:'push',2:'pull',3:'rest',4:'legs',5:'nimble',6:'rest'},
        5: {0:'rest',1:'push',2:'cardio',3:'pull',4:'rest',5:'legs',6:'nimble'},
        6: {0:'cardio',1:'push',2:'pull',3:'cardio',4:'legs',5:'nimble',6:'rest'}
    };
    
    // Goal descriptions for 40+ men
    const goalNames = {
        balanced: 'Balanced Performance',
        vitality: 'Health & Vitality',
        functional: 'Functional Fitness'
    };
    
    appState.activePlan = {
        name: `${planData.frequency}-Day ${goalNames[planData.goal] || 'Training'}`,
        frequency: planData.frequency,
        schedule: schedules[planData.frequency],
        week: 1,
        phase: 'Foundation' // Better than 'volume' for 40+
    };
    
    // Show preview
    const preview = document.getElementById('plan-preview');
    const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    let html = '<div style="margin:15px 0;">';
    dayNames.forEach((name, idx) => {
        const type = appState.activePlan.schedule[idx];
        const icon = {push:'üí™',pull:'üèãÔ∏è',legs:'ü¶µ',cardio:'üö¥',nimble:'üßò',rest:'üò¥'}[type];
        html += `<div style="padding:8px; background:#2c2c2c; margin:5px 0; border-radius:6px;">
            ${icon} <strong>${name}:</strong> ${type}
        </div>`;
    });
    html += '</div>';
    preview.innerHTML = html;
    
    setTimeout(() => showGenStep(3), 300);
}

function acceptPlan() {
    saveAppState();
    closePlanGenerator();
    renderPlanCalendar();
    speak('Plan activated!');
}

function regeneratePlan() {
    showGenStep(1);
}

// ========================================
// TODAY'S BANNER
// ========================================
function updateTodaysBanner() {
    const banner = document.getElementById('todays-banner');
    if(!banner) return;
    
    const plan = appState.activePlan;
    const today = new Date();
    const dayIdx = today.getDay();
    const type = plan.schedule[dayIdx];
    
    if(type === 'rest' || isDayCompleted(dayIdx)) {
        banner.style.display = 'none';
        return;
    }
    
    document.getElementById('today-date').textContent = 
        today.toLocaleDateString('en-US', {weekday:'long', month:'short', day:'numeric'});
    
    const icon = {push:'üí™',pull:'üèãÔ∏è',legs:'ü¶µ',cardio:'üö¥',nimble:'üßò'}[type];
    document.getElementById('today-workout').textContent = `${icon} ${type.toUpperCase()}`;
    
    banner.style.display = 'block';
}

function startTodaysWorkout() {
    const dayIdx = new Date().getDay();
    const type = appState.activePlan.schedule[dayIdx];
    quickStartWorkout(type);
}

// ========================================
// CARDIO TRACKING
// ========================================
function logCardioSession() {
    const type = document.getElementById('cardio-type').value;
    const duration = parseInt(document.getElementById('cardio-duration').value);
    const distance = parseFloat(document.getElementById('cardio-distance').value) || null;
    
    const session = {
        type: type,
        duration: duration,
        distance: distance,
        date: new Date().toISOString()
    };
    
    let history = JSON.parse(localStorage.getItem('cardioHistory')) || [];
    history.push(session);
    localStorage.setItem('cardioHistory', JSON.stringify(history));
    
    // Mark day completed
    markDayCompleted(new Date().getDay());
    
    alert('Cardio logged! üö¥');
    speak('Cardio session logged');
    loadCardioHistory();
}

function loadCardioHistory() {
    const container = document.getElementById('cardio-history');
    if(!container) return;
    
    const history = JSON.parse(localStorage.getItem('cardioHistory')) || [];
    
    if(history.length === 0) {
        container.innerHTML = '<p class="text-muted">No cardio sessions yet</p>';
        return;
    }
    
    container.innerHTML = '';
    history.slice(-10).reverse().forEach(session => {
        const div = document.createElement('div');
        div.style.padding = '10px';
        div.style.borderBottom = '1px solid #333';
        
        const date = new Date(session.date).toLocaleDateString();
        const icon = {run:'üèÉ',bike:'üö¥',swim:'üèä',walk:'üö∂',row:'üö£'}[session.type];
        
        div.innerHTML = `
            <strong>${icon} ${session.type}</strong><br>
            <small class="text-muted">
                ${date} ‚Ä¢ ${session.duration} min${session.distance ? ` ‚Ä¢ ${session.distance} km` : ''}
            </small>
        `;
        
        container.appendChild(div);
    });
}

// ========================================
// EQUIPMENT SETTINGS
// ========================================
function renderEquipmentPresets() {
    const container = document.getElementById('equipment-presets');
    if(!container) return;
    
    const presets = [
        {key:'home', name:'üè† Home Gym', desc:'Cables, Dumbbells, Bench'},
        {key:'hotel', name:'üè® Hotel/Travel', desc:'Bodyweight & Bands'},
        {key:'gym', name:'üí™ Full Gym', desc:'All Equipment'}
    ];
    
    container.innerHTML = '';
    presets.forEach(preset => {
        const div = document.createElement('div');
        div.className = 'preset-card';
        div.setAttribute('data-preset', preset.key);
        if(appState.equipment === preset.key) div.classList.add('active');
        
        div.innerHTML = `
            <strong>${preset.name}</strong><br>
            <small class="text-muted">${preset.desc}</small>
        `;
        
        div.onclick = () => activatePreset(preset.key);
        container.appendChild(div);
    });
}

function activatePreset(key) {
    appState.equipment = key;
    saveAppState();
    
    document.querySelectorAll('.preset-card').forEach(c => c.classList.remove('active'));
    document.querySelector(`[data-preset="${key}"]`).classList.add('active');
    
    speak(`Switched to ${key} equipment`);
}

function updateSettingsUI() {
    if(document.getElementById('voice-enabled')) {
        document.getElementById('voice-enabled').checked = appState.voiceEnabled;
        document.getElementById('voice-level').value = appState.voiceLevel;
    }
    
    // Update exercise count slider
    if(document.getElementById('exercise-count-slider')) {
        const count = appState.exerciseCount || 6;
        document.getElementById('exercise-count-slider').value = count;
        document.getElementById('exercise-count-display').textContent = count;
    }
}

// ========================================
// VOICE SYSTEM
// ========================================
function speak(message) {
    if(!appState.voiceEnabled || appState.voiceLevel === 'silent') return;
    if(!window.speechSynthesis) return;
    
    const utterance = new SpeechSynthesisUtterance(message);
    window.speechSynthesis.speak(utterance);
}

function saveVoiceSettings() {
    appState.voiceEnabled = document.getElementById('voice-enabled').checked;
    appState.voiceLevel = document.getElementById('voice-level').value;
    saveAppState();
}

function testVoice() {
    speak('Voice test. Five, four, three, two, one. Well done!');
}
// ========================================
// DIRECT GOOGLE IMAGE SEARCH (No API Required)
// ========================================
let currentGifExercise = null;

function openGifSearch(exerciseName) {
    currentGifExercise = exerciseName;
    
    // Optimized query for male animations and anatomy
    const searchQuery = `male animated ${exerciseName} muscle anatomy form gif`;
    
    // Forces Google to show Animated Image results
    const googleImageUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}&tbm=isch&tbs=itp:animated`;
    
    // Opens search in a new tab
    window.open(googleImageUrl, '_blank');
    
    speak(`Opening Google Images for ${exerciseName}`);
    
    closeGifSearch();
}

function closeGifSearch() {
    const modal = document.getElementById('gif-search-modal');
    if (modal) modal.classList.remove('active');
    currentGifExercise = null;
}

function removeExerciseGif(exerciseName) {
    if(confirm(`Remove image for ${exerciseName}?`)) {
        localStorage.removeItem(`gif_${exerciseName}`);
        speak('Image removed');
        viewExerciseDetails(exerciseName);
    }
}

// ========================================
// GPS TRACKING FEATURE
// ========================================
let gpsWatchId = null;
let gpsRoute = [];
let gpsStartTime = null;
let gpsInterval = null;
let gpsTotalDistance = 0;

function startGpsTracking() {
    if(!navigator.geolocation) {
        alert('GPS not supported on this device');
        return;
    }
    
    const activityType = document.getElementById('gps-activity-type').value;
    
    gpsRoute = [];
    gpsTotalDistance = 0;
    gpsStartTime = Date.now();
    
    document.getElementById('gps-tracking-modal').classList.add('active');
    document.getElementById('gps-distance').textContent = '0.00';
    document.getElementById('gps-pace').textContent = '0:00';
    document.getElementById('gps-duration').textContent = '00:00';
    
    gpsWatchId = navigator.geolocation.watchPosition(
        updateGpsPosition,
        (error) => {
            console.error('GPS error:', error);
            alert('Unable to access GPS. Please enable location services.');
            stopGpsTracking();
        },
        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
    );
    
    gpsInterval = setInterval(updateGpsDuration, 1000);
    speak(`GPS tracking started for ${activityType}`);
}

function updateGpsPosition(position) {
    const newPoint = {
        lat: position.coords.latitude,
        lng: position.coords.longitude,
        timestamp: Date.now()
    };
    
    if(gpsRoute.length > 0) {
        const lastPoint = gpsRoute[gpsRoute.length - 1];
        const distance = calculateDistance(lastPoint.lat, lastPoint.lng, newPoint.lat, newPoint.lng);
        gpsTotalDistance += distance;
        
        document.getElementById('gps-distance').textContent = gpsTotalDistance.toFixed(2);
        
        const durationMinutes = (Date.now() - gpsStartTime) / 60000;
        if(gpsTotalDistance > 0) {
            const pace = durationMinutes / gpsTotalDistance;
            const paceMin = Math.floor(pace);
            const paceSec = Math.floor((pace - paceMin) * 60);
            document.getElementById('gps-pace').textContent = `${paceMin}:${paceSec.toString().padStart(2, '0')}`;
        }
    }
    
    gpsRoute.push(newPoint);
    drawGpsRoute();
}

function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Earth radius in km
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

function updateGpsDuration() {
    const duration = Date.now() - gpsStartTime;
    const minutes = Math.floor(duration / 60000);
    const seconds = Math.floor((duration % 60000) / 1000);
    document.getElementById('gps-duration').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function drawGpsRoute() {
    const canvas = document.getElementById('gps-map-canvas');
    const ctx = canvas.getContext('2d');
    
    if(gpsRoute.length < 2) return;
    
    // Clear canvas
    ctx.fillStyle = '#2c2c2c';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Find bounds
    const lats = gpsRoute.map(p => p.lat);
    const lngs = gpsRoute.map(p => p.lng);
    const minLat = Math.min(...lats);
    const maxLat = Math.max(...lats);
    const minLng = Math.min(...lngs);
    const maxLng = Math.max(...lngs);
    
    const latRange = maxLat - minLat || 0.001;
    const lngRange = maxLng - minLng || 0.001;
    
    // Draw route
    ctx.strokeStyle = '#03DAC6';
    ctx.lineWidth = 3;
    ctx.beginPath();
    
    gpsRoute.forEach((point, i) => {
        const x = ((point.lng - minLng) / lngRange) * (canvas.width - 40) + 20;
        const y = canvas.height - (((point.lat - minLat) / latRange) * (canvas.height - 40) + 20);
        
        if(i === 0) {
            ctx.moveTo(x, y);
        } else {
            ctx.lineTo(x, y);
        }
    });
    
    ctx.stroke();
    
    // Draw start point
    const startX = ((gpsRoute[0].lng - minLng) / lngRange) * (canvas.width - 40) + 20;
    const startY = canvas.height - (((gpsRoute[0].lat - minLat) / latRange) * (canvas.height - 40) + 20);
    ctx.fillStyle = '#00C853';
    ctx.beginPath();
    ctx.arc(startX, startY, 6, 0, 2 * Math.PI);
    ctx.fill();
    
    // Draw end point
    const lastPoint = gpsRoute[gpsRoute.length - 1];
    const endX = ((lastPoint.lng - minLng) / lngRange) * (canvas.width - 40) + 20;
    const endY = canvas.height - (((lastPoint.lat - minLat) / latRange) * (canvas.height - 40) + 20);
    ctx.fillStyle = '#CF6679';
    ctx.beginPath();
    ctx.arc(endX, endY, 6, 0, 2 * Math.PI);
    ctx.fill();
}

function stopGpsTracking() {
    if(gpsWatchId) {
        navigator.geolocation.clearWatch(gpsWatchId);
        gpsWatchId = null;
    }
    if(gpsInterval) {
        clearInterval(gpsInterval);
        gpsInterval = null;
    }
    document.getElementById('gps-tracking-modal').classList.remove('active');
}

function saveGpsRoute() {
    if(gpsRoute.length < 2) {
        alert('Not enough GPS data to save');
        return;
    }
    
    const activityType = document.getElementById('gps-activity-type').value;
    const duration = (Date.now() - gpsStartTime) / 60000;
    
    const routeData = {
        type: activityType,
        date: new Date().toISOString(),
        distance: parseFloat(gpsTotalDistance.toFixed(2)),
        duration: Math.floor(duration),
        route: gpsRoute,
        pace: duration / gpsTotalDistance
    };
    
    // Save to cardio history
    let cardioHistory = JSON.parse(localStorage.getItem('cardioHistory') || '[]');
    cardioHistory.unshift(routeData);
    localStorage.setItem('cardioHistory', JSON.stringify(cardioHistory));
    
    speak(`${activityType} saved: ${gpsTotalDistance.toFixed(2)} kilometers`);
    stopGpsTracking();
    renderCardioHistory();
}

// ========================================
// WARMUP SEQUENCES FEATURE
// ========================================
const warmupSequences = {
    push: [
        { name: 'Arm Circles', duration: 60, desc: 'Large circles forward and backward' },
        { name: 'Shoulder CARs', duration: 60, desc: 'Controlled articular rotations' },
        { name: 'Band Pull-Aparts', duration: 45, desc: 'Light resistance band' },
        { name: 'Push-up Plus', duration: 45, desc: 'Scapular protraction focus' },
        { name: 'Chest Openers', duration: 45, desc: 'Dynamic stretching' },
        { name: 'Wrist Rolls', duration: 30, desc: 'Both directions' }
    ],
    pull: [
        { name: 'Dead Hangs', duration: 45, desc: 'Active shoulder engagement' },
        { name: 'Scapular Shrugs', duration: 60, desc: 'On bar or rings' },
        { name: 'Band Face Pulls', duration: 45, desc: 'Light resistance' },
        { name: 'Cat-Cow Stretch', duration: 60, desc: 'Spine mobility' },
        { name: 'Thoracic Rotations', duration: 45, desc: 'Both sides' },
        { name: 'Wrist Flexion/Extension', duration: 30, desc: 'Gentle stretches' }
    ],
    legs: [
        { name: 'Leg Swings', duration: 60, desc: 'Front to back, side to side' },
        { name: 'Hip CARs', duration: 60, desc: 'Controlled hip circles' },
        { name: 'Bodyweight Squats', duration: 45, desc: 'Full range of motion' },
        { name: 'Walking Lunges', duration: 45, desc: 'Dynamic stretching' },
        { name: 'Ankle Rolls', duration: 30, desc: 'Both directions' },
        { name: 'Glute Bridges', duration: 45, desc: 'Activation focus' }
    ]
};

let warmupTimer = null;
let warmupCurrentIndex = 0;
let warmupTimeLeft = 0;
let warmupWorkoutType = '';

function startWarmup(workoutType) {
    const type = workoutType.toLowerCase();
    if(!warmupSequences[type]) {
        // Skip warmup for workout types without sequences
        continueToWorkout();
        return;
    }
    
    warmupWorkoutType = type;
    warmupCurrentIndex = 0;
    document.getElementById('warmup-modal').classList.add('active');
    showWarmupExercise(0);
}

function showWarmupExercise(index) {
    const sequence = warmupSequences[warmupWorkoutType];
    if(index >= sequence.length) {
        completeWarmup();
        return;
    }
    
    const exercise = sequence[index];
    warmupCurrentIndex = index;
    warmupTimeLeft = exercise.duration;
    
    document.getElementById('warmup-exercise-name').textContent = exercise.name;
    document.getElementById('warmup-exercise-desc').textContent = exercise.desc;
    document.getElementById('warmup-timer').textContent = warmupTimeLeft;
    document.getElementById('warmup-progress').textContent = `${index + 1}/${sequence.length}`;
    
    speak(`${exercise.name}. ${exercise.duration} seconds`);
    
    if(warmupTimer) clearInterval(warmupTimer);
    warmupTimer = setInterval(() => {
        warmupTimeLeft--;
        document.getElementById('warmup-timer').textContent = warmupTimeLeft;
        
        if(warmupTimeLeft <= 3 && warmupTimeLeft > 0) {
            speak(warmupTimeLeft.toString());
        }
        
        if(warmupTimeLeft <= 0) {
            clearInterval(warmupTimer);
            nextWarmupExercise();
        }
    }, 1000);
}

function nextWarmupExercise() {
    if(warmupTimer) clearInterval(warmupTimer);
    showWarmupExercise(warmupCurrentIndex + 1);
}

function skipWarmup() {
    if(warmupTimer) clearInterval(warmupTimer);
    document.getElementById('warmup-modal').classList.remove('active');
    continueToWorkout();
}

function completeWarmup() {
    if(warmupTimer) clearInterval(warmupTimer);
    document.getElementById('warmup-modal').classList.remove('active');
    speak('Warmup complete! Ready to train');
    continueToWorkout();
}

function continueToWorkout() {
    // The workout is already loaded, just make sure it's visible
    document.getElementById('workout-interface').style.display = 'block';
}

// ========================================
// AI COACH ANALYTICS
// ========================================
function updateAiCoach() {
    const container = document.getElementById('ai-coach-suggestions');
    if(!container) return;
    
    const completedWorkouts = JSON.parse(localStorage.getItem('completedWorkouts') || '{}');
    const plan = JSON.parse(localStorage.getItem('currentPlan') || '[]');
    
    // Calculate this week's data
    const today = new Date();
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - today.getDay());
    
    let workoutsThisWeek = 0;
    let plannedThisWeek = 0;
    let consecutiveDays = 0;
    let lastWorkoutDate = null;
    
    for(let i = 0; i < 7; i++) {
        const date = new Date(startOfWeek);
        date.setDate(startOfWeek.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        
        if(completedWorkouts[dateStr]) {
            workoutsThisWeek++;
            if(!lastWorkoutDate || (date - lastWorkoutDate) / (1000*60*60*24) === 1) {
                consecutiveDays++;
            }
            lastWorkoutDate = date;
        }
        
        if(plan[i] && plan[i] !== 'rest') {
            plannedThisWeek++;
        }
    }
    
    const adherenceRate = plannedThisWeek > 0 ? (workoutsThisWeek / plannedThisWeek) * 100 : 0;
    
    let html = '';
    
    // Generate AI coach message
    if(adherenceRate >= 80) {
        html += `
            <div class="ai-coach-card success">
                <h3>üéØ Excellent Progress!</h3>
                <p>Adherence: <strong>${adherenceRate.toFixed(0)}%</strong> (${workoutsThisWeek}/${plannedThisWeek} workouts)</p>
                <p style="margin-top:10px;">You're crushing it! Your consistency is outstanding. Keep up this momentum!</p>
            </div>
        `;
    } else if(adherenceRate >= 50) {
        html += `
            <div class="ai-coach-card">
                <h3>üí™ Good Work!</h3>
                <p>Adherence: <strong>${adherenceRate.toFixed(0)}%</strong> (${workoutsThisWeek}/${plannedThisWeek} workouts)</p>
                <p style="margin-top:10px;">You're making solid progress. Try to hit all planned workouts for maximum results!</p>
            </div>
        `;
    } else if(plannedThisWeek > 0) {
        html += `
            <div class="ai-coach-card warning">
                <h3>‚ö†Ô∏è Need More Consistency</h3>
                <p>Adherence: <strong>${adherenceRate.toFixed(0)}%</strong> (${workoutsThisWeek}/${plannedThisWeek} workouts)</p>
                <p style="margin-top:10px;">You've missed several workouts this week. Remember: consistency beats intensity!</p>
            </div>
        `;
    }
    
    // Overtraining detection
    if(workoutsThisWeek >= 6 && consecutiveDays >= 6) {
        html += `
            <div class="ai-coach-card warning">
                <h3>üõë Recovery Check</h3>
                <p>You've trained ${consecutiveDays} days in a row.</p>
                <p style="margin-top:10px;">Consider taking a rest day soon to prevent overtraining and optimize recovery.</p>
            </div>
        `;
    }
    
    // Streak tracking
    if(consecutiveDays >= 3) {
        html += `
            <div class="ai-coach-card success">
                <h3>üî• ${consecutiveDays} Day Streak!</h3>
                <p>Amazing consistency! Remember to balance intensity with recovery.</p>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// ========================================
// UTILITY FUNCTIONS
// ========================================
function capitalizeFirst(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

</script>
</body>
</html>
